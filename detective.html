<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia: Detective - Role Assigner</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d3561 0%, #3e2753 50%, #4a2c5e 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* RTL Support for Farsi */
        body.rtl {
            direction: rtl;
            font-family: Tahoma, 'Segoe UI', Arial, sans-serif;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            padding: 30px;
            animation: fadeIn 0.5s ease-in;
            position: relative;
            margin-top: 80px;
        }

        .back-home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 2000;
            cursor: pointer;
        }

        .back-home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Language Toggle Button */
        .language-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 4000;
        }

        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        h1 {
            text-align: center;
            color: #1a1a2e;
            margin-bottom: 40px;
            font-size: 2em;
            margin-top: 20px;
            position: relative;
            padding-bottom: 20px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 2px;
            background: linear-gradient(90deg, #e94560 0%, #f093fb 50%, #e94560 100%);
            border-radius: 1px;
            box-shadow: 0 2px 10px rgba(233, 69, 96, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .info-badge {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
        }

        .roles-section {
            margin-top: 30px;
        }

        .role-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.rtl .role-card {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .role-card:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        body.rtl .role-card:hover {
            transform: translateX(-5px);
        }

        .role-card.mafia {
            border-left-color: #f5576c;
        }

        body.rtl .role-card.mafia {
            border-right-color: #f5576c;
        }

        .role-card.citizen {
            border-left-color: #4facfe;
        }

        body.rtl .role-card.citizen {
            border-right-color: #4facfe;
        }

        .player-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: 700;
            margin-right: 15px;
        }

        body.rtl .player-number {
            margin-right: 0;
            margin-left: 15px;
        }

        .role-card.mafia .player-number {
            background: #f5576c;
        }

        .role-card.citizen .player-number {
            background: #4facfe;
        }

        .role-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .role-description {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
            line-height: 1.6;
        }

        .close-game-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 20px;
            width: 70px;
            height: 36px;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(245, 87, 108, 0.3);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-game-btn:hover {
            background: #e04560;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.5);
        }

        #gameCounter {
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
            text-align: center;
            padding: 10px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
            overflow-y: auto;
        }

        .hidden {
            display: none !important;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
            margin-top: 50px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            margin: 0;
            color: white;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-body h3 {
            color: #1a1a2e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .modal-body h3:first-child {
            margin-top: 0;
        }

        .modal-body h4 {
            color: #333;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .modal-body p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .modal-body ul {
            color: #666;
            line-height: 2;
            padding-left: 25px;
            margin-bottom: 15px;
        }

        body.rtl .modal-body ul {
            padding-left: 0;
            padding-right: 25px;
        }

        .role-help {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        body.rtl .role-help {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .role-help.mafia {
            border-left-color: #f5576c;
        }

        body.rtl .role-help.mafia {
            border-right-color: #f5576c;
        }

        .role-help.citizen {
            border-left-color: #4facfe;
        }

        body.rtl .role-help.citizen {
            border-right-color: #4facfe;
        }

        .team-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .team-badge.mafia {
            background: #f5576c;
            color: white;
        }

        .team-badge.citizen {
            background: #4facfe;
            color: white;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin-top: 70px;
            }

            h1 {
                font-size: 1.5em;
            }

            .language-toggle,
            .back-home-btn {
                padding: 8px 15px;
                font-size: 0.8em;
                top: 15px;
            }

            .language-toggle {
                right: 15px;
            }

            .back-home-btn {
                left: 15px;
            }

            .close-game-btn {
                width: 60px;
                height: 32px;
                font-size: 1.1em;
            }

            .close-btn {
                width: 36px;
                height: 36px;
                font-size: 1.3em;
            }

            .modal-body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Global Language Toggle (Fixed Position) -->
    <button class="language-toggle" onclick="toggleLanguage()">
        <span id="langButtonText">ŸÅÿßÿ±ÿ≥€å</span>
    </button>

    <!-- Back to Home Button (Fixed Position) -->
    <a href="index.html" class="back-home-btn">
        <span>üè†</span>
        <span id="backHomeText">Back to Home</span>
    </a>

    <div class="container">
        <div id="setupSection">
            <h1 id="mainTitle">üïµÔ∏è Mafia: Detective üîé</h1>

            <div class="input-section" style="margin-bottom: 20px;">
                <label for="playerCount" style="display: block; color: #333; margin-bottom: 10px; font-weight: 600; font-size: 1.1em;">
                    <span id="playerCountLabel">Number of Players (6-20):</span>
                </label>
                <input type="number" id="playerCount" min="6" max="20" value="11" placeholder="Enter number of players"
                       style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1.1em; transition: all 0.3s ease;"
                       oninput="updatePlayerInfo()"
                       onfocus="this.style.borderColor='#e94560'; this.style.boxShadow='0 0 0 3px rgba(233, 69, 96, 0.1)';"
                       onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none';">
                <p class="error hidden" id="errorMsg" style="color: #ee3d72; font-size: 0.9em; margin-top: 10px; text-align: center;"></p>
            </div>

            <div class="info-badge" id="playerInfo">
                11 Players: 3 Mafia ‚Ä¢ 8 Citizens
            </div>

            <button class="btn" onclick="startGame()">
                <span id="assignBtn">üé≤ Assign Roles</span>
            </button>
            <button class="btn btn-secondary" onclick="showHelp()">
                <span id="howToPlayBtn">üìñ How to Play</span>
            </button>
            <button class="btn btn-secondary" onclick="showFeedback()">
                <span id="feedbackBtn">üí¨ Feedback</span>
            </button>
            <div id="gameCounter">Games Played Worldwide: Loading...</div>
        </div>

        <div id="gameSection" class="hidden">
            <button class="close-game-btn" onclick="cancelGame()" title="Cancel and start over">‚úï</button>
            
            <div class="roles-section">
                <div id="rolesContainer"></div>
            </div>

            <button class="btn btn-secondary hidden" id="newGameBtn" onclick="resetGame()">
                <span id="newGameText">üîÑ New Game</span>
            </button>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="helpTitle">üìñ How to Play - Mafia: Detective</h2>
                <button class="close-btn" onclick="closeHelp()">‚úï</button>
            </div>
            <div class="modal-body" id="helpContent">
                <!-- Content will be populated by JavaScript based on language -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="feedbackTitle">üí¨ Send Feedback</h2>
                <button class="close-btn" onclick="closeFeedback()">‚úï</button>
            </div>
            <div class="modal-body">
                <p id="feedbackIntro" style="color: #666; margin-bottom: 20px;">Have questions, suggestions, or ideas to improve the game? We'd love to hear from you!</p>
                
                <form id="feedbackForm" onsubmit="submitFeedback(event)">
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackName" id="nameLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Name (Optional)</label>
                        <input type="text" id="feedbackName" placeholder="Your name" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackEmail" id="emailLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Email (Optional)</label>
                        <input type="email" id="feedbackEmail" placeholder="your.email@example.com" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackMessage" id="messageLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Message *</label>
                        <textarea id="feedbackMessage" required placeholder="Share your thoughts..." 
                                  style="width: 100%; min-height: 150px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <p id="feedbackStatus" class="hidden" style="padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-weight: 600;"></p>
                    
                    <button type="submit" class="btn" id="submitFeedbackBtn">
                        <span id="sendBtn">üì§ Send Feedback</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmTitle" style="font-size: 1.3em;">‚ö†Ô∏è Cancel Game?</h2>
            </div>
            <div class="modal-body">
                <p id="confirmText" style="font-size: 1.1em; text-align: center; margin-bottom: 20px;">
                    Are you sure you want to cancel this game and start over?
                </p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" style="flex: 1;" onclick="confirmCancel()">
                        <span id="yesBtn">Yes, Cancel</span>
                    </button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="closeConfirm()">
                        <span id="noBtn">No, Continue</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBSTuzqrJ0ik2CTfKq0GOc7lEVUYtxCX0E",
            authDomain: "spy-game-12f96.firebaseapp.com",
            databaseURL: "https://spy-game-12f96-default-rtdb.firebaseio.com",
            projectId: "spy-game-12f96",
            storageBucket: "spy-game-12f96.firebasestorage.app",
            messagingSenderId: "22301781663",
            appId: "1:22301781663:web:23f31448a872e41203fcaa",
            measurementId: "G-DE4QRR88RH"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        const EMAILJS_PUBLIC_KEY = 'qw_grGhV3it_4-RwE';
        const EMAILJS_SERVICE_ID = 'service_f65c74d';
        const EMAILJS_TEMPLATE_ID = 'template_gna5het';
        
        try {
            emailjs.init(EMAILJS_PUBLIC_KEY);
        } catch (error) {
            console.error("EmailJS initialization error:", error);
        }

        // Language System
        let currentLang = localStorage.getItem('language') || 'fa';

        const translations = {
            en: {
                mainTitle: 'üïµÔ∏è Mafia: Detective üîé',
                playerCountLabel: 'Number of Players (6-20):',
                playerInfo: '11 Players: 3 Mafia ‚Ä¢ 8 Citizens',
                assignBtn: 'üé≤ Assign Roles',
                howToPlayBtn: 'üìñ How to Play',
                feedbackBtn: 'üí¨ Feedback',
                newGameText: 'üîÑ New Game',
                langButtonText: 'ŸÅÿßÿ±ÿ≥€å',
                helpTitle: 'üìñ How to Play - Mafia: Detective',
                feedbackTitle: 'üí¨ Send Feedback',
                feedbackIntro: 'Have questions, suggestions, or ideas to improve the game? We\'d love to hear from you!',
                nameLabel: 'Name (Optional)',
                emailLabel: 'Email (Optional)',
                messageLabel: 'Message *',
                sendBtn: 'üì§ Send Feedback',
                confirmTitle: '‚ö†Ô∏è Cancel Game?',
                confirmText: 'Are you sure you want to cancel this game and start over?',
                yesBtn: 'Yes, Cancel',
                noBtn: 'No, Continue',
                playerLabel: 'Player',
                showRoleBtn: 'üé≠ Show My Role',
                sawRoleBtn: '‚úÖ I Saw My Role',
                allAssigned: 'All Roles Assigned!',
                gameBegin: 'The game can now begin. Good luck!',
                gamesPlayed: 'Games Played Worldwide:'
            },
            fa: {
                mainTitle: 'üïµÔ∏è ŸÖÿßŸÅ€åÿß: ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ üîé',
                playerCountLabel: 'ÿ™ÿπÿØÿßÿØ ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ (€∂-€≤€∞):',
                playerInfo: '€±€± ÿ®ÿßÿ≤€å⁄©ŸÜ: €≥ ŸÖÿßŸÅ€åÿß - €∏ ÿ¥Ÿáÿ±ŸàŸÜÿØ',
                assignBtn: 'üé≤ ÿ™ÿÆÿµ€åÿµ ŸÜŸÇÿ¥‚ÄåŸáÿß',
                howToPlayBtn: 'üìñ ÿ¢ŸÖŸàÿ≤ÿ¥ ÿ®ÿßÿ≤€å',
                feedbackBtn: 'üí¨ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                newGameText: 'üîÑ ÿ®ÿßÿ≤€å ÿ¨ÿØ€åÿØ',
                langButtonText: 'English',
                helpTitle: 'üìñ ÿ¢ŸÖŸàÿ≤ÿ¥ ÿ®ÿßÿ≤€å - ŸÖÿßŸÅ€åÿß: ÿ®ÿßÿ≤Ÿæÿ±ÿ≥',
                feedbackTitle: 'üí¨ ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                feedbackIntro: 'ÿ≥ŸàÿßŸÑÿå Ÿæ€åÿ¥ŸÜŸáÿßÿØ €åÿß ÿß€åÿØŸá‚Äåÿß€å ÿ®ÿ±ÿß€å ÿ®Ÿáÿ®ŸàÿØ ÿ®ÿßÿ≤€å ÿØÿßÿ±€åÿØÿü ÿÆŸàÿ¥ÿ≠ÿßŸÑ ŸÖ€å‚Äåÿ¥Ÿà€åŸÖ ŸÜÿ∏ÿ±ÿ™ÿßŸÜ ÿ±ÿß ÿ®ÿ¥ŸÜŸà€åŸÖ!',
                nameLabel: 'ŸÜÿßŸÖ (ÿßÿÆÿ™€åÿßÿ±€å)',
                emailLabel: 'ÿß€åŸÖ€åŸÑ (ÿßÿÆÿ™€åÿßÿ±€å)',
                messageLabel: 'Ÿæ€åÿßŸÖ *',
                sendBtn: 'üì§ ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                confirmTitle: '‚ö†Ô∏è ŸÑÿ∫Ÿà ÿ®ÿßÿ≤€åÿü',
                confirmText: 'ÿ¢€åÿß ŸÖÿ∑ŸÖÿ¶ŸÜ Ÿáÿ≥ÿ™€åÿØ ⁄©Ÿá ŸÖ€å‚ÄåÿÆŸàÿßŸá€åÿØ ÿß€åŸÜ ÿ®ÿßÿ≤€å ÿ±ÿß ŸÑÿ∫Ÿà ⁄©ŸÜ€åÿØ Ÿà ÿßÿ≤ ŸÜŸà ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØÿü',
                yesBtn: 'ÿ®ŸÑŸáÿå ŸÑÿ∫Ÿà ⁄©ŸÜ',
                noBtn: 'ÿÆ€åÿ±ÿå ÿßÿØÿßŸÖŸá ÿ®ÿØŸá',
                playerLabel: 'ÿ®ÿßÿ≤€å⁄©ŸÜ',
                showRoleBtn: 'üé≠ ŸÜŸÖÿß€åÿ¥ ŸÜŸÇÿ¥ ŸÖŸÜ',
                sawRoleBtn: '‚úÖ ŸÜŸÇÿ¥ŸÖ ÿ±ÿß ÿØ€åÿØŸÖ',
                allAssigned: 'ŸáŸÖŸá ŸÜŸÇÿ¥‚ÄåŸáÿß ÿ™ÿÆÿµ€åÿµ ÿØÿßÿØŸá ÿ¥ÿØ!',
                gameBegin: 'ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ÿ±Ÿàÿπ ÿ¥ŸàÿØ. ŸÖŸàŸÅŸÇ ÿ®ÿßÿ¥€åÿØ!',
                gamesPlayed: 'ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿßŸÜÿ¨ÿßŸÖ ÿ¥ÿØŸá ÿØÿ± ÿ≥ÿ±ÿßÿ≥ÿ± ÿ¨ŸáÿßŸÜ:'
            }
        };

        // Role definitions for Detective scenario
        const roles = {
            en: {
                // Mafia Team
                godfather: {
                    name: 'Mafia Boss',
                    team: 'mafia',
                    description: 'You are the Mafia Boss. You decide who to shoot each night. Detective investigations always show you as innocent. You can use "Yakuza Trading" once - sacrifice one mafia member to recruit a Simple Citizen or Iron Body to your team. Sniper cannot kill you.',
                    class: 'mafia'
                },
                nato: {
                    name: 'NATO',
                    team: 'mafia',
                    description: 'You are NATO. Once per game, guess a player\'s exact role. If correct, they are eliminated during the next day regardless of protection. When you use this ability, mafia cannot shoot that night. You can only use this ability once.',
                    class: 'mafia'
                },
                shayad: {
                    name: 'Fraud (Shayad)',
                    team: 'mafia',
                    description: 'You are the Fraud. Your goal is to find the Detective. You use your ability every night to investigate one player. You can investigate the same person for 2 consecutive nights. If you find the Detective, all mafia members will show as innocent in their investigations.',
                    class: 'mafia'
                },
                simpleMafia: {
                    name: 'Simple Mafia',
                    team: 'mafia',
                    description: 'You are a Simple Mafia member. You have no special night ability but help the Boss decide who to eliminate. During the day, try to deflect suspicion from your team.',
                    class: 'mafia'
                },
                // Citizens Team
                doctor: {
                    name: 'Doctor (Pezeshk)',
                    team: 'citizen',
                    description: 'You are the Doctor. Each night, save one person from night attacks. You can only save yourself twice during the entire game. You can save others unlimited times.',
                    class: 'citizen'
                },
                detective: {
                    name: 'Detective (Karagah)',
                    team: 'citizen',
                    description: 'You are the Detective. Each night, investigate one player to learn if they are mafia. The Mafia Boss always shows as innocent. If Fraud finds you, all mafia will show as innocent in your investigations.',
                    class: 'citizen'
                },
                ironBody: {
                    name: 'Iron Body (Rooyin-tan)',
                    team: 'citizen',
                    description: 'You are Iron Body. You cannot be killed by night shots, but can be eliminated by day voting. If the Mafia Boss successfully trades with you, you will join the mafia team.',
                    class: 'citizen'
                },
                sniper: {
                    name: 'Sniper',
                    team: 'citizen',
                    description: 'You are the Sniper. You have one shot for the entire game. If you shoot a citizen by mistake, you are eliminated instead. You can kill any mafia member except the Boss. Your shot will fail if the Doctor saves your target that same night.',
                    class: 'citizen'
                },
                investigator: {
                    name: 'Investigator (Mohagheg)',
                    team: 'citizen',
                    description: 'You are the Investigator. Each night (except introduction night), link yourself to one player. If you are eliminated and were linked to NATO or Fraud, they are eliminated with you. Only your last night\'s link counts.',
                    class: 'citizen'
                },
                interrogator: {
                    name: 'Interrogator',
                    team: 'citizen',
                    description: 'You are the Interrogator. Once per game, choose 2 players for interrogation. Each defends themselves twice (30 seconds each). You can then decide: if you proceed, everyone must vote between those 2 - highest votes is eliminated with role revealed. If one is shot that night, your ability returns.',
                    class: 'citizen'
                },
                citizen: {
                    name: 'Simple Citizen',
                    team: 'citizen',
                    description: 'You are a Simple Citizen. You have no special abilities, but your voice and vote are crucial. Be careful - if Mafia Boss trades and you\'re selected, you may join the mafia team!',
                    class: 'citizen'
                }
            },
            fa: {
                // ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß
                godfather: {
                    name: 'ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß Ÿáÿ≥ÿ™€åÿØ. ÿßŸÜÿ™ÿÆÿßÿ® ÿ¥ÿßÿ™ ÿ¥ÿ® ÿ®ÿß ÿ¥ŸÖÿßÿ≥ÿ™. ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá ŸáŸÖ€åÿ¥Ÿá ÿ®ÿ±ÿß€å ÿ¥ŸÖÿß ŸÖŸÜŸÅ€å ÿßÿ≥ÿ™. €å⁄© ÿ®ÿßÿ± ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ "ÿ≥ŸàÿØÿß⁄Øÿ±€å" ⁄©ŸÜ€åÿØ - €å⁄© ŸÖÿßŸÅ€åÿß ÿ±ÿß ŸÅÿØÿß ⁄©ŸÜ€åÿØ Ÿà €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá €åÿß ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ ÿ±ÿß ÿ®Ÿá ÿ™€åŸÖ ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ. ÿßÿ≥ŸÜÿß€åŸæÿ± ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ŸÖÿß ÿ±ÿß ÿ®⁄©ÿ¥ÿØ.',
                    class: 'mafia'
                },
                nato: {
                    name: 'ŸÜÿßÿ™Ÿà',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ŸÜÿßÿ™Ÿà Ÿáÿ≥ÿ™€åÿØ. €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ŸÜŸÇÿ¥ ÿØŸÇ€åŸÇ €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿßÿ≤ ÿ®ÿßÿ≤€å ÿÆÿßÿ±ÿ¨ ŸÖ€å‚Äåÿ¥ŸàÿØ ÿ®ÿØŸàŸÜ ÿ™Ÿàÿ¨Ÿá ÿ®Ÿá ŸÖÿ≠ÿßŸÅÿ∏ÿ™. ÿ¥ÿ®€å ⁄©Ÿá ŸÜÿßÿ™Ÿà€å€å ŸÖ€å‚Äå⁄©ŸÜ€åÿØÿå ŸÖÿßŸÅ€åÿß ÿ≠ŸÇ ÿ¥ÿßÿ™ ŸÜÿØÿßÿ±ÿØ. ŸÅŸÇÿ∑ €å⁄© ÿ®ÿßÿ± ŸÇÿßÿ®ŸÑ ÿßÿ≥ÿ™ŸÅÿßÿØŸá.',
                    class: 'mafia'
                },
                shayad: {
                    name: 'ÿ¥€åÿßÿØ',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ÿ¥€åÿßÿØ Ÿáÿ≥ÿ™€åÿØ. ŸáÿØŸÅÿ™ÿßŸÜ Ÿæ€åÿØÿß ⁄©ÿ±ÿØŸÜ ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá ÿßÿ≥ÿ™. Ÿáÿ± ÿ¥ÿ® ÿßÿ≤ ŸÇÿßÿ®ŸÑ€åÿ™ ÿÆŸàÿØ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜ€åÿØ Ÿà €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ŸÖ€å‚Äå⁄©ŸÜ€åÿØ. ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿØÿ± €≤ ÿ¥ÿ® Ÿæ€åÿßŸæ€å €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá ÿ±ÿß Ÿæ€åÿØÿß ⁄©ŸÜ€åÿØÿå ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ŸáŸÖŸá ŸÖÿßŸÅ€åÿßŸáÿß ÿ®ÿ±ÿß€å ÿßŸà ŸÖŸÜŸÅ€å ŸÖ€å‚Äåÿ¥ŸàÿØ.',
                    class: 'mafia'
                },
                simpleMafia: {
                    name: 'ŸÖÿßŸÅ€åÿß ÿ≥ÿßÿØŸá',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß €å⁄© ŸÖÿßŸÅ€åÿß ÿ≥ÿßÿØŸá Ÿáÿ≥ÿ™€åÿØ. ÿØÿ± ÿ¥ÿ® ŸÜŸÇÿ¥ ÿÆÿßÿµ€å ŸÜÿØÿßÿ±€åÿØ ÿßŸÖÿß ÿ®Ÿá ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿØÿ± ÿ™ÿµŸÖ€åŸÖ‚Äå⁄Ø€åÿ±€å ⁄©ŸÖ⁄© ŸÖ€å‚Äå⁄©ŸÜ€åÿØ. ÿØÿ± ÿ±Ÿàÿ≤ÿå ÿ≥ÿπ€å ⁄©ŸÜ€åÿØ ÿ¥⁄© ÿ±ÿß ÿßÿ≤ ÿ™€åŸÖÿ™ÿßŸÜ ÿ®ÿ±ÿØÿßÿ±€åÿØ.',
                    class: 'mafia'
                },
                // ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ
                doctor: {
                    name: 'Ÿæÿ≤ÿ¥⁄©',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß Ÿæÿ≤ÿ¥⁄© Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßÿ≤ ÿ≠ŸÖŸÑÿßÿ™ ÿ¥ÿ®ÿßŸÜŸá ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ. ŸÅŸÇÿ∑ ÿØŸà ÿ®ÿßÿ± ÿØÿ± ⁄©ŸÑ ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿÆŸàÿØÿ™ÿßŸÜ ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ. ÿØ€å⁄Øÿ±ÿßŸÜ ÿ±ÿß ÿ®€å‚ÄåŸÖÿ≠ÿØŸàÿØ€åÿ™ ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ.',
                    class: 'citizen'
                },
                detective: {
                    name: '⁄©ÿßÿ±ÿ¢⁄ØÿßŸá',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® ÿßÿ≤ €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ÿ®⁄Ø€åÿ±€åÿØ ⁄©Ÿá ŸÖÿßŸÅ€åÿßÿ≥ÿ™ €åÿß ÿÆ€åÿ±. ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ŸáŸÖ€åÿ¥Ÿá ŸÖŸÜŸÅ€å ÿßÿ≥ÿ™. ÿß⁄Øÿ± ÿ¥€åÿßÿØ ÿ¥ŸÖÿß ÿ±ÿß Ÿæ€åÿØÿß ⁄©ŸÜÿØÿå ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ŸáŸÖŸá ŸÖÿßŸÅ€åÿßŸáÿß ÿ®ÿ±ÿß€å ÿ¥ŸÖÿß ŸÖŸÜŸÅ€å ŸÖ€å‚Äåÿ¥ŸàÿØ.',
                    class: 'citizen'
                },
                ironBody: {
                    name: 'ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ Ÿáÿ≥ÿ™€åÿØ. ÿ®ÿß ÿ¥ÿßÿ™ ÿ¥ÿ® ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå ÿßŸÖÿß ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ±Ÿàÿ≤ ÿßÿ≤ ÿ®ÿßÿ≤€å ÿÆÿßÿ±ÿ¨ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ. ÿß⁄Øÿ± ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿ®ÿß ÿ¥ŸÖÿß ÿ≥ŸàÿØÿß⁄Øÿ±€å ŸÖŸàŸÅŸÇ ÿØÿßÿ¥ÿ™Ÿá ÿ®ÿßÿ¥ÿØÿå ÿ®Ÿá ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸæ€åŸàŸÜÿØ€åÿØ.',
                    class: 'citizen'
                },
                sniper: {
                    name: 'ÿßÿ≥ŸÜÿß€åŸæÿ±',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ÿßÿ≥ŸÜÿß€åŸæÿ± Ÿáÿ≥ÿ™€åÿØ. ÿØÿ± ⁄©ŸÑ ÿ®ÿßÿ≤€å €å⁄© ÿ™€åÿ± ÿØÿßÿ±€åÿØ. ÿß⁄Øÿ± ÿ®Ÿá ÿßÿ¥ÿ™ÿ®ÿßŸá ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ€å ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØÿå ÿÆŸàÿØÿ™ÿßŸÜ ÿßÿ≤ ÿ®ÿßÿ≤€å ÿÆÿßÿ±ÿ¨ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ. ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ Ÿáÿ± ŸÖÿßŸÅ€åÿß€å€å ÿ®Ÿá ÿ¨ÿ≤ ÿ±ÿ¶€åÿ≥ ÿ±ÿß ÿ®⁄©ÿ¥€åÿØ. ÿß⁄Øÿ± Ÿæÿ≤ÿ¥⁄© ŸáŸÖÿßŸÜ ÿ¥ÿ® ŸáÿØŸÅÿ™ÿßŸÜ ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸáÿØÿå ÿ™€åÿ±ÿ™ÿßŸÜ ÿ®€å‚Äåÿßÿ´ÿ± ÿßÿ≥ÿ™.',
                    class: 'citizen'
                },
                investigator: {
                    name: 'ŸÖÿ≠ŸÇŸÇ',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ŸÖÿ≠ŸÇŸÇ Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® (ÿ®Ÿá ÿ¨ÿ≤ ÿ¥ÿ® ŸÖÿπÿßÿ±ŸÅŸá) ÿÆŸàÿØ ÿ±ÿß ÿ®Ÿá €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ Ÿæ€åŸàŸÜÿØ ÿØŸá€åÿØ. ÿß⁄Øÿ± ÿ≠ÿ∞ŸÅ ÿ¥Ÿà€åÿØ Ÿà ÿ®Ÿá ŸÜÿßÿ™Ÿà €åÿß ÿ¥€åÿßÿØ Ÿæ€åŸàŸÜÿØ ÿ≤ÿØŸá ÿ®ÿßÿ¥€åÿØÿå ÿ¢ŸÜ‚ÄåŸáÿß ŸÜ€åÿ≤ ÿ®ÿß ÿ¥ŸÖÿß ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ. ŸÅŸÇÿ∑ Ÿæ€åŸàŸÜÿØ ÿ¥ÿ® ŸÇÿ®ŸÑ ÿ≠ÿ≥ÿßÿ® ŸÖ€å‚Äåÿ¥ŸàÿØ.',
                    class: 'citizen'
                },
                interrogator: {
                    name: 'ÿ®ÿßÿ≤Ÿæÿ±ÿ≥',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ Ÿáÿ≥ÿ™€åÿØ. €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€åÿå €≤ ŸÜŸÅÿ± ÿ±ÿß ÿ®ÿ±ÿß€å ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ. Ÿáÿ± ⁄©ÿØÿßŸÖ €≤ ÿ®ÿßÿ± €≥€∞ ÿ´ÿßŸÜ€åŸá ÿØŸÅÿßÿπ ŸÖ€å‚Äå⁄©ŸÜŸÜÿØ. ÿ≥Ÿæÿ≥ ÿ™ÿµŸÖ€åŸÖ ÿ®⁄Ø€åÿ±€åÿØ: ÿß⁄Øÿ± ÿßÿØÿßŸÖŸá ÿØŸá€åÿØÿå ŸáŸÖŸá ÿ®ÿß€åÿØ ÿ®€åŸÜ ÿ¢ŸÜ €≤ ŸÜŸÅÿ± ÿ±ÿß€å ÿØŸáŸÜÿØ - ÿ®ÿßŸÑÿßÿ™ÿ±€åŸÜ ÿ±ÿß€å ÿ®ÿß ÿßÿπŸÑÿßŸÖ ŸÜŸÇÿ¥ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿß⁄Øÿ± €å⁄©€å ÿ¥ÿ® ÿ¥ÿßÿ™ ÿ¥ŸàÿØÿå ÿ™ŸàÿßŸÜÿß€å€å‚Äåÿ™ÿßŸÜ ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ.',
                    class: 'citizen'
                },
                citizen: {
                    name: 'ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá Ÿáÿ≥ÿ™€åÿØ. ÿ™ŸàÿßŸÜÿß€å€å ÿÆÿßÿµ€å ŸÜÿØÿßÿ±€åÿØÿå ÿßŸÖÿß ÿµÿØÿß Ÿà ÿ±ÿ£€å ÿ¥ŸÖÿß ÿ≠€åÿßÿ™€å ÿßÿ≥ÿ™. ŸÖÿ±ÿßŸÇÿ® ÿ®ÿßÿ¥€åÿØ - ÿß⁄Øÿ± ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿ≥ŸàÿØÿß⁄Øÿ±€å ⁄©ŸÜÿØ Ÿà ÿ¥ŸÖÿß ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜÿØÿå ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿ®Ÿá ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ÿ®Ÿæ€åŸàŸÜÿØ€åÿØ!',
                    class: 'citizen'
                }
            }
        };

        let currentPlayerIndex = 0;
        let playerRoles = [];
        let gameCountIncremented = false;

        function calculateTeamSize(playerCount) {
            // Detective scenario: 6-20 players
            // Scales roles based on player count
            
            let godfather = 0;
            let nato = 0;
            let shayad = 0;
            let simpleMafia = 0;
            
            let doctor = 0;
            let detective = 0;
            let ironBody = 0;
            let sniper = 0;
            let investigator = 0;
            let interrogator = 0;
            let citizen = 0;
            
            // Small games (6-9): Limited special roles
            if (playerCount === 6) {
                // 2 mafia vs 4 citizens
                godfather = 1; shayad = 1;
                doctor = 1; detective = 1; sniper = 1; citizen = 1;
            }
            else if (playerCount === 7) {
                // 2 mafia vs 5 citizens
                godfather = 1; shayad = 1;
                doctor = 1; detective = 1; sniper = 1; investigator = 1; citizen = 1;
            }
            else if (playerCount === 8) {
                // 2 mafia vs 6 citizens
                godfather = 1; shayad = 1;
                doctor = 1; detective = 1; ironBody = 1; sniper = 1; investigator = 1; citizen = 1;
            }
            else if (playerCount === 9) {
                // 3 mafia vs 6 citizens
                godfather = 1; nato = 1; shayad = 1;
                doctor = 1; detective = 1; ironBody = 1; sniper = 1; investigator = 1; citizen = 1;
            }
            // Medium games (10-15): Full special roles
            else if (playerCount >= 10) {
                godfather = 1; nato = 1; shayad = 1;
                doctor = 1; detective = 1; ironBody = 1; sniper = 1; investigator = 1; interrogator = 1;
                
                if (playerCount === 10) {
                    citizen = 1;
                }
                else if (playerCount <= 12) {
                    citizen = playerCount - 9; // 9 special roles
                }
                else if (playerCount <= 14) {
                    simpleMafia = 1;
                    citizen = playerCount - 10;
                }
                else if (playerCount === 15) {
                    simpleMafia = 2;
                    citizen = playerCount - 11;
                }
                // Large games (16-20): More simple roles
                else if (playerCount >= 16) {
                    // Maintain roughly 30% mafia
                    const totalMafia = Math.floor(playerCount * 0.3);
                    simpleMafia = totalMafia - 3; // 3 special mafia (Boss, NATO, Fraud)
                    citizen = playerCount - 9 - simpleMafia; // 6 special citizens + interrogator
                }
            }
            
            const totalMafiaCount = godfather + nato + shayad + simpleMafia;
            const totalCitizensCount = playerCount - totalMafiaCount;
            
            return {
                godfather: godfather,
                nato: nato,
                shayad: shayad,
                simpleMafia: simpleMafia,
                doctor: doctor,
                detective: detective,
                ironBody: ironBody,
                sniper: sniper,
                investigator: investigator,
                interrogator: interrogator,
                citizen: citizen,
                totalMafia: totalMafiaCount,
                totalCitizens: totalCitizensCount
            };
        }

        function updatePlayerInfo() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const errorMsg = document.getElementById('errorMsg');
            
            if (!playerCount || playerCount < 6 || playerCount > 20) {
                errorMsg.textContent = currentLang === 'en' 
                    ? 'Please enter a number between 6 and 20' 
                    : 'ŸÑÿ∑ŸÅÿßŸã ÿπÿØÿØ€å ÿ®€åŸÜ €∂ ÿ™ÿß €≤€∞ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            
            const teamSize = calculateTeamSize(playerCount);
            const playerInfoEl = document.getElementById('playerInfo');
            
            if (currentLang === 'en') {
                playerInfoEl.textContent = `${playerCount} Players: ${teamSize.totalMafia} Mafia ‚Ä¢ ${teamSize.totalCitizens} Citizens`;
            } else {
                // Convert numbers to Farsi
                const persianDigits = ['€∞', '€±', '€≤', '€≥', '€¥', '€µ', '€∂', '€∑', '€∏', '€π'];
                const toFarsi = (num) => String(num).split('').map(d => persianDigits[parseInt(d)]).join('');
                playerInfoEl.textContent = `${toFarsi(playerCount)} ÿ®ÿßÿ≤€å⁄©ŸÜ: ${toFarsi(teamSize.totalMafia)} ŸÖÿßŸÅ€åÿß - ${toFarsi(teamSize.totalCitizens)} ÿ¥Ÿáÿ±ŸàŸÜÿØ`;
            }
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'fa' : 'en';
            localStorage.setItem('language', currentLang);
            updateLanguage();
        }

        function updateLanguage() {
            const t = translations[currentLang];
            document.body.className = currentLang === 'fa' ? 'rtl' : '';
            
            // Update all UI text
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('playerCountLabel').textContent = t.playerCountLabel;
            updatePlayerInfo();
            document.getElementById('assignBtn').textContent = t.assignBtn;
            document.getElementById('howToPlayBtn').textContent = t.howToPlayBtn;
            document.getElementById('feedbackBtn').textContent = t.feedbackBtn;
            document.getElementById('newGameText').textContent = t.newGameText;
            document.getElementById('langButtonText').textContent = t.langButtonText;
            document.getElementById('helpTitle').textContent = t.helpTitle;
            document.getElementById('feedbackTitle').textContent = t.feedbackTitle;
            document.getElementById('feedbackIntro').textContent = t.feedbackIntro;
            document.getElementById('nameLabel').textContent = t.nameLabel;
            document.getElementById('emailLabel').textContent = t.emailLabel;
            document.getElementById('messageLabel').textContent = t.messageLabel;
            document.getElementById('sendBtn').textContent = t.sendBtn;
            document.getElementById('confirmTitle').textContent = t.confirmTitle;
            document.getElementById('confirmText').textContent = t.confirmText;
            document.getElementById('yesBtn').textContent = t.yesBtn;
            document.getElementById('noBtn').textContent = t.noBtn;
            
            // Update help content
            updateHelpContent();
            
            // If game is in progress, refresh the current screen
            if (playerRoles.length > 0 && !document.getElementById('gameSection').classList.contains('hidden')) {
                refreshCurrentGameScreen();
            }
        }

        function refreshCurrentGameScreen() {
            if (currentPlayerIndex >= playerRoles.length) {
                const t = translations[currentLang];
                const rolesContainer = document.getElementById('rolesContainer');
                rolesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üéâ</div>
                        <h2 style="color: #333; margin-bottom: 15px;">${t.allAssigned}</h2>
                        <p style="color: #666; font-size: 1.1em;">${t.gameBegin}</p>
                    </div>
                `;
                return;
            }
            
            const roleRevealArea = document.getElementById('roleRevealArea');
            if (roleRevealArea && roleRevealArea.innerHTML.trim() !== '') {
                const roleKey = playerRoles[currentPlayerIndex];
                const role = roles[currentLang][roleKey];
                const t = translations[currentLang];
                
                let teamBadge = '';
                let teamColor = '';
                if (role.team === 'mafia') {
                    teamBadge = currentLang === 'en' ? 'üòà Mafia Team' : 'üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß';
                    teamColor = '#ee3d72';
                } else if (role.team === 'citizen') {
                    teamBadge = currentLang === 'en' ? 'üòá Citizens Team' : 'üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ';
                    teamColor = '#4facfe';
                }
                
                roleRevealArea.innerHTML = `
                    <div class="role-card ${role.class}" style="margin-bottom: 20px; cursor: default;">
                        <div style="text-align: ${currentLang === 'fa' ? 'right' : 'left'};">
                            <div style="display: inline-block; background: ${teamColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; font-weight: 600;">
                                ${teamBadge}
                            </div>
                            <div class="role-name" style="font-size: 1.8em; margin-bottom: 15px;">
                                ${role.name}
                            </div>
                            <div class="role-description" style="font-size: 1.05em; line-height: 1.8;">
                                ${role.description}
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="nextPlayer()" style="margin-top: 20px;">${t.sawRoleBtn}</button>
                `;
            } else {
                const instructionBox = document.getElementById('instructionBox');
                const showRoleBtn = document.getElementById('showRoleBtn');
                if (instructionBox && showRoleBtn) {
                    const t = translations[currentLang];
                    instructionBox.innerHTML = `
                        <div style="font-size: 2.5em; margin-bottom: 15px;">üë§</div>
                        <h2 style="color: #333; margin-bottom: 10px;">${t.playerLabel} ${currentPlayerIndex + 1}</h2>
                        <p style="color: #666;">${currentLang === 'en' ? 'Click the button below to see your role' : 'ÿ±Ÿà€å ÿØ⁄©ŸÖŸá ÿ≤€åÿ± ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ŸÜŸÇÿ¥ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ®€åŸÜ€åÿØ'}</p>
                    `;
                    showRoleBtn.innerHTML = t.showRoleBtn;
                }
            }
        }

        function updateHelpContent() {
            const helpContent = document.getElementById('helpContent');
            
            if (currentLang === 'en') {
                helpContent.innerHTML = `
                    <h3>üéØ Game Overview</h3>
                    <p>Mafia: Detective is a social deduction game for 6-20 players. The game scales automatically based on player count, introducing the Interrogator role (10+ players) and special investigation mechanics.</p>
                    <p><strong>Small Games (6-9):</strong> Limited special roles - Boss, Fraud vs core citizens</p>
                    <p><strong>Standard Setup (11 players):</strong> 3 Mafia vs 8 Citizens - full special roles</p>
                    <p><strong>Large Games (16-20):</strong> More simple roles added while maintaining ~30% mafia ratio</p>
                    
                    <h3>üåô Game Flow</h3>
                    <ul>
                        <li><strong>Night Phase:</strong> Roles wake in order - Investigator, Mafia Team, Fraud, Detective, Sniper, Doctor, Interrogator</li>
                        <li><strong>Day Phase:</strong> Discussion and voting to eliminate suspects</li>
                        <li><strong>Interrogation:</strong> When activated, 2 players defend themselves, then all vote between them</li>
                    </ul>

                    <h3>üòà Mafia Team</h3>
                    
                    <div class="role-help mafia">
                        <h4>üëî Mafia Boss</h4>
                        <p><strong>Night Shoot:</strong> Decides who the mafia eliminates each night</p>
                        <p><strong>Hidden Identity:</strong> Always appears innocent to Detective investigations</p>
                        <p><strong>Yakuza Trading:</strong> Once per game (only while Boss is alive), sacrifice one mafia member to recruit a Simple Citizen or Iron Body to the mafia team. Narrator announces: "Mafia team wants to negotiate"</p>
                        <p><strong>Immunity:</strong> Cannot be killed by Sniper</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üí£ NATO</h4>
                        <p><strong>Role Guess:</strong> Once per game, guess a player's exact role. If correct, they are eliminated the next day regardless of protection</p>
                        <p><strong>Trade-off:</strong> The night NATO uses this ability, mafia cannot shoot anyone</p>
                        <p><strong>One-time Use:</strong> This ability can only be used once in the entire game</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üé≠ Fraud (Shayad)</h4>
                        <p><strong>Goal:</strong> Find the Detective</p>
                        <p><strong>Investigation:</strong> Each night, investigate one player. Can use ability every night. Can investigate the same person for 2 consecutive nights</p>
                        <p><strong>Success Effect:</strong> If Detective is found, all mafia members will appear innocent in Detective's investigations</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üòà Simple Mafia</h4>
                        <p><strong>Role:</strong> No special night ability</p>
                        <p><strong>Task:</strong> Help the team during discussions and deflect suspicion</p>
                    </div>

                    <h3>üòá Citizens Team</h3>
                    
                    <div class="role-help citizen">
                        <h4>üíâ Doctor (Pezeshk)</h4>
                        <p><strong>Save:</strong> Each night, protect one person from attacks</p>
                        <p><strong>Self-Save:</strong> Can save yourself only 2 times total during the game</p>
                        <p><strong>Others:</strong> Unlimited saves for other players</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üîç Detective (Karagah)</h4>
                        <p><strong>Investigation:</strong> Each night, check if one player is mafia</p>
                        <p><strong>Boss Exception:</strong> Mafia Boss always shows as innocent</p>
                        <p><strong>Compromised:</strong> If Fraud finds you, all mafia members will show as innocent</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üõ°Ô∏è Iron Body (Rooyin-tan)</h4>
                        <p><strong>Immunity:</strong> Cannot be killed by night shots</p>
                        <p><strong>Weakness:</strong> Can be eliminated by day voting</p>
                        <p><strong>Trading Target:</strong> If Mafia Boss successfully trades with you, you join the mafia team</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üéØ Sniper</h4>
                        <p><strong>Single Shot:</strong> One shot for the entire game</p>
                        <p><strong>Penalty:</strong> If you shoot a citizen by mistake, you are eliminated instead</p>
                        <p><strong>Limitation:</strong> Cannot kill the Mafia Boss, but can kill other mafia members</p>
                        <p><strong>Doctor Interaction:</strong> If Doctor saves your target that night, your shot fails</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üìã Investigator (Mohagheg)</h4>
                        <p><strong>Link:</strong> Each night (except introduction), link yourself to one player</p>
                        <p><strong>Effect:</strong> If you are eliminated (by vote or night shot) and were linked to NATO or Fraud, they die with you</p>
                        <p><strong>Important:</strong> Only your most recent link counts (from the night before your death)</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üïµÔ∏è Interrogator</h4>
                        <p><strong>Interrogation:</strong> Once per game, select 2 players for interrogation</p>
                        <p><strong>Process:</strong> If both players are alive the next day, after announcing night deaths:
                            <ul>
                                <li>Each player defends themselves twice (30 seconds each, alternating)</li>
                                <li>No likes/dislikes during their defense</li>
                                <li>After defenses, Interrogator decides: continue or cancel</li>
                                <li>If continued: everyone must vote between the 2 players</li>
                                <li>Highest votes is eliminated with role revealed</li>
                                <li>If equal votes: both stay in game</li>
                            </ul>
                        </p>
                        <p><strong>Special Cases:</strong></p>
                        <ul>
                            <li>If Interrogator is shot the night before interrogation, process still happens</li>
                            <li>If one selected player is shot that night, ability returns to Interrogator</li>
                            <li>If Interrogator cancels in noon phase, cannot use ability again</li>
                        </ul>
                    </div>

                    <div class="role-help citizen">
                        <h4>üë§ Simple Citizen</h4>
                        <p><strong>Role:</strong> No special abilities</p>
                        <p><strong>Task:</strong> Discussion, voting, and helping identify mafia</p>
                        <p><strong>Risk:</strong> Can be recruited by Mafia Boss through Yakuza Trading</p>
                    </div>

                    <h3>üéÆ Special Mechanics</h3>
                    
                    <h4>ü§ù Yakuza Trading (Sudagari)</h4>
                    <ul>
                        <li>Only while Mafia Boss is alive, once per game</li>
                        <li>Narrator announces loudly: "Mafia team wants to negotiate"</li>
                        <li>Boss sacrifices one mafia member and points to someone to recruit</li>
                        <li>Success: If target is Simple Citizen or Iron Body, they join mafia that night</li>
                        <li>Failure: If target is any other role, mafia member is lost with no replacement</li>
                        <li>If only Boss remains, can sacrifice himself to attempt recruitment</li>
                    </ul>

                    <h4>‚öñÔ∏è Interrogation Process</h4>
                    <ul>
                        <li>Interrogator selects 2 players one night</li>
                        <li>If both alive next day, interrogation begins after death announcements</li>
                        <li>Each player gets 2 turns of 30 seconds to defend</li>
                        <li>Interrogator decides: proceed or cancel</li>
                        <li>If proceeding: mandatory vote between the 2 players</li>
                        <li>Eliminated player's role is revealed</li>
                    </ul>

                    <h3>üèÜ Win Conditions</h3>
                    <ul>
                        <li><strong>Mafia Wins:</strong> When mafia members equal or outnumber citizens</li>
                        <li><strong>Citizens Win:</strong> When all mafia members are eliminated</li>
                    </ul>

                    <h3>üí° Strategy Tips</h3>
                    <ul>
                        <li><strong>Mafia Boss:</strong> Save Yakuza Trading for crucial moments</li>
                        <li><strong>Fraud:</strong> Finding the Detective cripples citizen investigations</li>
                        <li><strong>Interrogator:</strong> Use your power wisely - you only get one shot</li>
                        <li><strong>Investigator:</strong> Link to suspected mafia to take them down with you</li>
                        <li><strong>Iron Body:</strong> Don't reveal yourself - you're a trading target!</li>
                    </ul>
                `;
            } else {
                helpContent.innerHTML = `
                    <h3>üéØ ŸÖÿπÿ±ŸÅ€å ÿ®ÿßÿ≤€å</h3>
                    <p>ŸÖÿßŸÅ€åÿß: ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ €å⁄© ÿ®ÿßÿ≤€å ÿßÿ≥ÿ™ŸÜÿ™ÿßÿ¨ ÿßÿ¨ÿ™ŸÖÿßÿπ€å ÿ®ÿ±ÿß€å €∂-€≤€∞ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ≥ÿ™. ÿ®ÿßÿ≤€å ÿ®ÿ± ÿßÿ≥ÿßÿ≥ ÿ™ÿπÿØÿßÿØ ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿ®Ÿá ÿµŸàÿ±ÿ™ ÿÆŸàÿØ⁄©ÿßÿ± ŸÖŸÇ€åÿßÿ≥‚Äåÿ®ŸÜÿØ€å ŸÖ€å‚Äåÿ¥ŸàÿØ Ÿà ŸÜŸÇÿ¥ ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ (€±€∞+ ÿ®ÿßÿ≤€å⁄©ŸÜ) Ÿà ŸÖ⁄©ÿßŸÜ€å⁄©‚ÄåŸáÿß€å ÿ™ÿ≠ŸÇ€åŸÇ Ÿà€å⁄òŸá ÿ±ÿß ŸÖÿπÿ±ŸÅ€å ŸÖ€å‚Äå⁄©ŸÜÿØ.</p>
                    <p><strong>ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ⁄©Ÿà⁄Ü⁄© (€∂-€π):</strong> ŸÜŸÇÿ¥‚ÄåŸáÿß€å ÿÆÿßÿµ ŸÖÿ≠ÿØŸàÿØ - ÿ±ÿ¶€åÿ≥ÿå ÿ¥€åÿßÿØ ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿßÿµŸÑ€å</p>
                    <p><strong>ÿ™ÿ±⁄©€åÿ® ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ (€±€± ÿ®ÿßÿ≤€å⁄©ŸÜ):</strong> €≥ ŸÖÿßŸÅ€åÿß ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ €∏ ÿ¥Ÿáÿ±ŸàŸÜÿØ - ÿ™ŸÖÿßŸÖ ŸÜŸÇÿ¥‚ÄåŸáÿß€å ÿÆÿßÿµ</p>
                    <p><strong>ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿ®ÿ≤ÿ±⁄Ø (€±€∂-€≤€∞):</strong> ŸÜŸÇÿ¥‚ÄåŸáÿß€å ÿ≥ÿßÿØŸá ÿ®€åÿ¥ÿ™ÿ± ÿ®ÿß ÿ≠ŸÅÿ∏ ŸÜÿ≥ÿ®ÿ™ ~€≥€∞Ÿ™ ŸÖÿßŸÅ€åÿß</p>
                    
                    <h3>üåô ÿ±ŸàŸÜÿØ ÿ®ÿßÿ≤€å</h3>
                    <ul>
                        <li><strong>ŸÅÿßÿ≤ ÿ¥ÿ®:</strong> ŸÜŸÇÿ¥‚ÄåŸáÿß ÿ®Ÿá ÿ™ÿ±ÿ™€åÿ® ÿ®€åÿØÿßÿ± ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ - ŸÖÿ≠ŸÇŸÇÿå ÿ™€åŸÖ ŸÖÿßŸÅ€åÿßÿå ÿ¥€åÿßÿØÿå ⁄©ÿßÿ±ÿ¢⁄ØÿßŸáÿå ÿßÿ≥ŸÜÿß€åŸæÿ±ÿå Ÿæÿ≤ÿ¥⁄©ÿå ÿ®ÿßÿ≤Ÿæÿ±ÿ≥</li>
                        <li><strong>ŸÅÿßÿ≤ ÿ±Ÿàÿ≤:</strong> ÿ®ÿ≠ÿ´ Ÿà ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ®ÿ±ÿß€å ÿ≠ÿ∞ŸÅ ŸÖÿ∏ŸÜŸàŸÜ€åŸÜ</li>
                        <li><strong>ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å:</strong> ŸàŸÇÿ™€å ŸÅÿπÿßŸÑ ÿ¥ŸàÿØÿå €≤ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØŸÅÿßÿπ ŸÖ€å‚Äå⁄©ŸÜŸÜÿØÿå ÿ≥Ÿæÿ≥ ŸáŸÖŸá ÿ®€åŸÜ ÿ¢ŸÜ‚ÄåŸáÿß ÿ±ÿß€å ŸÖ€å‚ÄåÿØŸáŸÜÿØ</li>
                    </ul>

                    <h3>üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß</h3>
                    
                    <div class="role-help mafia">
                        <h4>üëî ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß</h4>
                        <p><strong>ÿ¥ÿßÿ™ ÿ¥ÿ®:</strong> ÿ™ÿµŸÖ€åŸÖ ŸÖ€å‚Äå⁄Ø€åÿ±ÿØ ŸÖÿßŸÅ€åÿß Ÿáÿ± ÿ¥ÿ® ⁄ÜŸá ⁄©ÿ≥€å ÿ±ÿß ÿ≠ÿ∞ŸÅ ⁄©ŸÜÿØ</p>
                        <p><strong>ŸáŸà€åÿ™ ŸÖÿÆŸÅ€å:</strong> ÿØÿ± ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá ŸáŸÖ€åÿ¥Ÿá ÿ®€å‚Äå⁄ØŸÜÿßŸá ÿ®Ÿá ŸÜÿ∏ÿ± ŸÖ€å‚Äåÿ±ÿ≥ÿØ</p>
                        <p><strong>ÿ≥ŸàÿØÿß⁄Øÿ±€å €åÿß⁄©Ÿàÿ≤ÿß€å€å:</strong> €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å (ŸÅŸÇÿ∑ ŸàŸÇÿ™€å ÿ±ÿ¶€åÿ≥ ÿ≤ŸÜÿØŸá ÿßÿ≥ÿ™)ÿå €å⁄© ŸÖÿßŸÅ€åÿß ÿ±ÿß ŸÅÿØÿß ⁄©ŸÜ€åÿØ Ÿà €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá €åÿß ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ ÿ±ÿß ÿ®Ÿá ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ. ÿ±ÿßŸà€å ÿßÿπŸÑÿßŸÖ ŸÖ€å‚Äå⁄©ŸÜÿØ: "ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ŸÇÿµÿØ ŸÖÿ∞ÿß⁄©ÿ±Ÿá ÿØÿßÿ±ÿØ"</p>
                        <p><strong>ŸÖÿµŸàŸÜ€åÿ™:</strong> ÿßÿ≥ŸÜÿß€åŸæÿ± ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿßŸà ÿ±ÿß ÿ®⁄©ÿ¥ÿØ</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üí£ ŸÜÿßÿ™Ÿà</h4>
                        <p><strong>ÿ≠ÿØÿ≥ ŸÜŸÇÿ¥:</strong> €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€åÿå ŸÜŸÇÿ¥ ÿØŸÇ€åŸÇ €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿØÿ± Ÿáÿ± ÿ¥ÿ±ÿß€åÿ∑€å ÿßÿ≤ ÿ®ÿßÿ≤€å ÿÆÿßÿ±ÿ¨ ŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                        <p><strong>ŸÖÿπÿßŸàÿ∂Ÿá:</strong> ÿ¥ÿ®€å ⁄©Ÿá ŸÜÿßÿ™Ÿà ÿß€åŸÜ ÿ™ŸàÿßŸÜÿß€å€å ÿ±ÿß ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜÿØÿå ŸÖÿßŸÅ€åÿß ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ⁄©ÿ≥€å ÿ±ÿß ÿ¥ÿßÿ™ ⁄©ŸÜÿØ</p>
                        <p><strong>€å⁄©‚Äåÿ®ÿßÿ± ŸÖÿµÿ±ŸÅ:</strong> ÿß€åŸÜ ÿ™ŸàÿßŸÜÿß€å€å ŸÅŸÇÿ∑ €å⁄© ÿ®ÿßÿ± ÿØÿ± ⁄©ŸÑ ÿ®ÿßÿ≤€å ŸÇÿßÿ®ŸÑ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≥ÿ™</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üé≠ ÿ¥€åÿßÿØ</h4>
                        <p><strong>ŸáÿØŸÅ:</strong> Ÿæ€åÿØÿß ⁄©ÿ±ÿØŸÜ ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá</p>
                        <p><strong>ÿ™ÿ≠ŸÇ€åŸÇ:</strong> Ÿáÿ± ÿ¥ÿ® €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ. Ÿáÿ± ÿ¥ÿ® ÿßÿ≤ ŸÇÿßÿ®ŸÑ€åÿ™ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜ€åÿØ. ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿØÿ± €≤ ÿ¥ÿ® Ÿæ€åÿßŸæ€å €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ</p>
                        <p><strong>ÿßÿ´ÿ± ŸÖŸàŸÅŸÇ€åÿ™:</strong> ÿß⁄Øÿ± ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá Ÿæ€åÿØÿß ÿ¥ŸàÿØÿå ÿ™ŸÖÿßŸÖ ÿßÿπÿ∂ÿß€å ŸÖÿßŸÅ€åÿß ÿØÿ± ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá ÿ®€å‚Äå⁄ØŸÜÿßŸá ÿ®Ÿá ŸÜÿ∏ÿ± ŸÖ€å‚Äåÿ±ÿ≥ŸÜÿØ</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üòà ŸÖÿßŸÅ€åÿß ÿ≥ÿßÿØŸá</h4>
                        <p><strong>ŸÜŸÇÿ¥:</strong> ÿ™ŸàÿßŸÜÿß€å€å ÿ¥ÿ®ÿßŸÜŸá ÿÆÿßÿµ€å ŸÜÿØÿßÿ±ÿØ</p>
                        <p><strong>Ÿàÿ∏€åŸÅŸá:</strong> ÿØÿ± ÿ®ÿ≠ÿ´‚ÄåŸáÿß ÿ®Ÿá ÿ™€åŸÖ ⁄©ŸÖ⁄© ⁄©ŸÜ€åÿØ Ÿà ÿ¥⁄© ÿ±ÿß ŸÖŸÜÿ≠ÿ±ŸÅ ⁄©ŸÜ€åÿØ</p>
                    </div>

                    <h3>üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ</h3>
                    
                    <div class="role-help citizen">
                        <h4>üíâ Ÿæÿ≤ÿ¥⁄©</h4>
                        <p><strong>ŸÜÿ¨ÿßÿ™:</strong> Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßÿ≤ ÿ≠ŸÖŸÑÿßÿ™ ŸÖÿ≠ÿßŸÅÿ∏ÿ™ ⁄©ŸÜ€åÿØ</p>
                        <p><strong>ÿÆŸàÿØŸÜÿ¨ÿßÿ™€å:</strong> ŸÅŸÇÿ∑ €≤ ÿ®ÿßÿ± ÿØÿ± ⁄©ŸÑ ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿÆŸàÿØÿ™ÿßŸÜ ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ</p>
                        <p><strong>ÿØ€å⁄Øÿ±ÿßŸÜ:</strong> ŸÜÿ¨ÿßÿ™ ŸÜÿßŸÖÿ≠ÿØŸàÿØ ÿ®ÿ±ÿß€å ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿØ€å⁄Øÿ±</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üîç ⁄©ÿßÿ±ÿ¢⁄ØÿßŸá</h4>
                        <p><strong>ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ:</strong> Ÿáÿ± ÿ¥ÿ® ÿ®ÿ±ÿ±ÿ≥€å ⁄©ŸÜ€åÿØ ⁄©Ÿá ÿ¢€åÿß €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ŸÖÿßŸÅ€åÿßÿ≥ÿ™</p>
                        <p><strong>ÿßÿ≥ÿ™ÿ´ŸÜÿß€å ÿ±ÿ¶€åÿ≥:</strong> ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ŸáŸÖ€åÿ¥Ÿá ÿ®€å‚Äå⁄ØŸÜÿßŸá ŸÜÿ¥ÿßŸÜ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                        <p><strong>ÿ®Ÿá ÿÆÿ∑ÿ± ÿßŸÅÿ™ÿßÿØŸá:</strong> ÿß⁄Øÿ± ÿ¥€åÿßÿØ ÿ¥ŸÖÿß ÿ±ÿß Ÿæ€åÿØÿß ⁄©ŸÜÿØÿå ŸáŸÖŸá ŸÖÿßŸÅ€åÿßŸáÿß ÿ®€å‚Äå⁄ØŸÜÿßŸá ŸÜÿ¥ÿßŸÜ ÿØÿßÿØŸá ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üõ°Ô∏è ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ</h4>
                        <p><strong>ŸÖÿµŸàŸÜ€åÿ™:</strong> ÿ®ÿß ÿ¥ÿßÿ™ ÿ¥ÿ® ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                        <p><strong>ŸÜŸÇÿ∑Ÿá ÿ∂ÿπŸÅ:</strong> ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ±Ÿàÿ≤ ŸÇÿßÿ®ŸÑ ÿ≠ÿ∞ŸÅ ÿßÿ≥ÿ™</p>
                        <p><strong>ŸáÿØŸÅ ÿ≥ŸàÿØÿß⁄Øÿ±€å:</strong> ÿß⁄Øÿ± ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿ®ÿß ÿ¥ŸÖÿß ÿ≥ŸàÿØÿß⁄Øÿ±€å ⁄©ŸÜÿØÿå ÿ®Ÿá ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸæ€åŸàŸÜÿØ€åÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üéØ ÿßÿ≥ŸÜÿß€åŸæÿ±</h4>
                        <p><strong>ÿ™⁄© ÿ™€åÿ±:</strong> €å⁄© ÿ™€åÿ± ÿ®ÿ±ÿß€å ⁄©ŸÑ ÿ®ÿßÿ≤€å</p>
                        <p><strong>ÿ¨ÿ±€åŸÖŸá:</strong> ÿß⁄Øÿ± ÿ®Ÿá ÿßÿ¥ÿ™ÿ®ÿßŸá ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØÿå ÿÆŸàÿØÿ™ÿßŸÜ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ</p>
                        <p><strong>ŸÖÿ≠ÿØŸàÿØ€åÿ™:</strong> ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿ±ÿß ÿ®⁄©ÿ¥€åÿØÿå ÿßŸÖÿß ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿ≥ÿß€åÿ± ŸÖÿßŸÅ€åÿßŸáÿß ÿ±ÿß ÿ®⁄©ÿ¥€åÿØ</p>
                        <p><strong>ÿ™ÿπÿßŸÖŸÑ ÿ®ÿß Ÿæÿ≤ÿ¥⁄©:</strong> ÿß⁄Øÿ± Ÿæÿ≤ÿ¥⁄© ŸáŸÖÿßŸÜ ÿ¥ÿ® ŸáÿØŸÅÿ™ÿßŸÜ ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸáÿØÿå ÿ™€åÿ±ÿ™ÿßŸÜ ÿ®€å‚Äåÿßÿ´ÿ± ŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üìã ŸÖÿ≠ŸÇŸÇ</h4>
                        <p><strong>Ÿæ€åŸàŸÜÿØ:</strong> Ÿáÿ± ÿ¥ÿ® (ÿ®Ÿá ÿ¨ÿ≤ ŸÖÿπÿßÿ±ŸÅŸá) ÿÆŸàÿØ ÿ±ÿß ÿ®Ÿá €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ Ÿæ€åŸàŸÜÿØ ÿØŸá€åÿØ</p>
                        <p><strong>ÿßÿ´ÿ±:</strong> ÿß⁄Øÿ± ÿ≠ÿ∞ŸÅ ÿ¥Ÿà€åÿØ (ÿ®ÿß ÿ±ÿß€å €åÿß ÿ¥ÿßÿ™ ÿ¥ÿ®) Ÿà ÿ®Ÿá ŸÜÿßÿ™Ÿà €åÿß ÿ¥€åÿßÿØ Ÿæ€åŸàŸÜÿØ ÿ≤ÿØŸá ÿ®ÿßÿ¥€åÿØÿå ÿ¢ŸÜ‚ÄåŸáÿß ÿ®ÿß ÿ¥ŸÖÿß ŸÖ€å‚ÄåŸÖ€åÿ±ŸÜÿØ</p>
                        <p><strong>ŸÖŸáŸÖ:</strong> ŸÅŸÇÿ∑ ÿ¢ÿÆÿ±€åŸÜ Ÿæ€åŸàŸÜÿØ ÿ¥ŸÖÿß (ÿ¥ÿ® ŸÇÿ®ŸÑ ÿßÿ≤ ŸÖÿ±⁄Øÿ™ÿßŸÜ) ÿ≠ÿ≥ÿßÿ® ŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üïµÔ∏è ÿ®ÿßÿ≤Ÿæÿ±ÿ≥</h4>
                        <p><strong>ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å:</strong> €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€åÿå €≤ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ÿ®ÿ±ÿß€å ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ</p>
                        <p><strong>ŸÅÿ±ÿ¢€åŸÜÿØ:</strong> ÿß⁄Øÿ± Ÿáÿ± ÿØŸà ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≤ŸÜÿØŸá ÿ®ÿßÿ¥ŸÜÿØÿå ÿ®ÿπÿØ ÿßÿ≤ ÿßÿπŸÑÿßŸÖ ⁄©ÿ¥ÿ™Ÿá‚ÄåŸáÿß€å ÿ¥ÿ®:
                            <ul>
                                <li>Ÿáÿ± ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØŸà ÿ®ÿßÿ± ÿØŸÅÿßÿπ ŸÖ€å‚Äå⁄©ŸÜÿØ (Ÿáÿ± ÿ®ÿßÿ± €≥€∞ ÿ´ÿßŸÜ€åŸáÿå ŸÜŸàÿ®ÿ™€å)</li>
                                <li>ÿØÿ± ÿ≠€åŸÜ ÿØŸÅÿßÿπ ŸÑÿß€å⁄©/ÿØ€åÿ≥‚ÄåŸÑÿß€å⁄© ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ</li>
                                <li>ÿ®ÿπÿØ ÿßÿ≤ ÿØŸÅÿßÿπÿå ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ ÿ™ÿµŸÖ€åŸÖ ŸÖ€å‚Äå⁄Ø€åÿ±ÿØ: ÿßÿØÿßŸÖŸá €åÿß ŸÑÿ∫Ÿà</li>
                                <li>ÿß⁄Øÿ± ÿßÿØÿßŸÖŸá €åÿßÿ®ÿØ: ŸáŸÖŸá ÿ®ÿß€åÿØ ÿ®€åŸÜ €≤ ŸÜŸÅÿ± ÿ±ÿß€å ÿØŸáŸÜÿØ</li>
                                <li>ÿ®€åÿ¥ÿ™ÿ±€åŸÜ ÿ±ÿß€å ÿ®ÿß ÿßÿπŸÑÿßŸÖ ŸÜŸÇÿ¥ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ</li>
                                <li>ÿß⁄Øÿ± ÿ±ÿß€å ÿ®ÿ±ÿßÿ®ÿ±: Ÿáÿ± ÿØŸà ÿØÿ± ÿ®ÿßÿ≤€å ŸÖ€å‚ÄåŸÖÿßŸÜŸÜÿØ</li>
                            </ul>
                        </p>
                        <p><strong>ŸÖŸàÿßÿ±ÿØ ÿÆÿßÿµ:</strong></p>
                        <ul>
                            <li>ÿß⁄Øÿ± ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ ÿ¥ÿ® ŸÇÿ®ŸÑ ÿßÿ≤ ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å ÿ¥ÿßÿ™ ÿ¥ŸàÿØÿå ŸÅÿ±ÿ¢€åŸÜÿØ ŸáŸÖ⁄ÜŸÜÿßŸÜ ÿßÿ™ŸÅÿßŸÇ ŸÖ€å‚ÄåÿßŸÅÿ™ÿØ</li>
                            <li>ÿß⁄Øÿ± €å⁄©€å ÿßÿ≤ ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿßŸÜÿ™ÿÆÿßÿ®€å ÿ¢ŸÜ ÿ¥ÿ® ÿ¥ÿßÿ™ ÿ¥ŸàÿØÿå ÿ™ŸàÿßŸÜÿß€å€å ÿ®Ÿá ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ</li>
                            <li>ÿß⁄Øÿ± ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ ÿØÿ± ŸÜ€åŸÖ‚Äåÿ±Ÿàÿ≤ ŸÑÿ∫Ÿà ⁄©ŸÜÿØÿå ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿØŸàÿ®ÿßÿ±Ÿá ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜÿØ</li>
                        </ul>
                    </div>

                    <div class="role-help citizen">
                        <h4>üë§ ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá</h4>
                        <p><strong>ŸÜŸÇÿ¥:</strong> ÿ™ŸàÿßŸÜÿß€å€å ÿÆÿßÿµ€å ŸÜÿØÿßÿ±ÿØ</p>
                        <p><strong>Ÿàÿ∏€åŸÅŸá:</strong> ÿ®ÿ≠ÿ´ÿå ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å Ÿà ⁄©ŸÖ⁄© ÿ®Ÿá ÿ¥ŸÜÿßÿ≥ÿß€å€å ŸÖÿßŸÅ€åÿß</p>
                        <p><strong>ÿ±€åÿ≥⁄©:</strong> ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ™Ÿàÿ≥ÿ∑ ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿßÿ≤ ÿ∑ÿ±€åŸÇ ÿ≥ŸàÿØÿß⁄Øÿ±€å €åÿß⁄©Ÿàÿ≤ÿß€å€å ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿ¥ŸàÿØ</p>
                    </div>

                    <h3>üéÆ ŸÖ⁄©ÿßŸÜ€å⁄©‚ÄåŸáÿß€å Ÿà€å⁄òŸá</h3>
                    
                    <h4>ü§ù ÿ≥ŸàÿØÿß⁄Øÿ±€å €åÿß⁄©Ÿàÿ≤ÿß€å€å</h4>
                    <ul>
                        <li>ŸÅŸÇÿ∑ ŸàŸÇÿ™€å ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß ÿ≤ŸÜÿØŸá ÿßÿ≥ÿ™ÿå €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å</li>
                        <li>ÿ±ÿßŸà€å ÿ®ÿß ÿµÿØÿß€å ÿ®ŸÑŸÜÿØ ÿßÿπŸÑÿßŸÖ ŸÖ€å‚Äå⁄©ŸÜÿØ: "ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ŸÇÿµÿØ ŸÖÿ∞ÿß⁄©ÿ±Ÿá ÿØÿßÿ±ÿØ"</li>
                        <li>ÿ±ÿ¶€åÿ≥ €å⁄© ÿπÿ∂Ÿà ŸÖÿßŸÅ€åÿß ÿ±ÿß ŸÅÿØÿß ŸÖ€å‚Äå⁄©ŸÜÿØ Ÿà ÿ®Ÿá ⁄©ÿ≥€å ÿ®ÿ±ÿß€å ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßÿ¥ÿßÿ±Ÿá ŸÖ€å‚Äå⁄©ŸÜÿØ</li>
                        <li>ŸÖŸàŸÅŸÇ€åÿ™: ÿß⁄Øÿ± ŸáÿØŸÅ ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá €åÿß ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ ÿ®ÿßÿ¥ÿØÿå ÿ¢ŸÜ ÿ¥ÿ® ÿ®Ÿá ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸæ€åŸàŸÜÿØÿØ</li>
                        <li>ÿ¥⁄©ÿ≥ÿ™: ÿß⁄Øÿ± ŸáÿØŸÅ ŸÜŸÇÿ¥ ÿØ€å⁄Øÿ±€å ÿ®ÿßÿ¥ÿØÿå ÿπÿ∂Ÿà ŸÖÿßŸÅ€åÿß ÿßÿ≤ ÿØÿ≥ÿ™ ŸÖ€å‚Äåÿ±ŸàÿØ ÿ®ÿØŸàŸÜ ÿ¨ÿß€å⁄Øÿ≤€åŸÜ</li>
                        <li>ÿß⁄Øÿ± ŸÅŸÇÿ∑ ÿ±ÿ¶€åÿ≥ ÿ®ÿßŸÇ€å ŸÖÿßŸÜÿØŸáÿå ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿÆŸàÿØ ÿ±ÿß ŸÅÿØÿß ⁄©ŸÜÿØ ÿ™ÿß ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ⁄©ŸÜÿØ</li>
                    </ul>

                    <h4>‚öñÔ∏è ŸÅÿ±ÿ¢€åŸÜÿØ ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å</h4>
                    <ul>
                        <li>ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ €å⁄© ÿ¥ÿ® €≤ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßŸÜÿ™ÿÆÿßÿ® ŸÖ€å‚Äå⁄©ŸÜÿØ</li>
                        <li>ÿß⁄Øÿ± Ÿáÿ± ÿØŸà ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≤ŸÜÿØŸá ÿ®ÿßÿ¥ŸÜÿØÿå ÿ®ÿßÿ≤Ÿæÿ±ÿ≥€å ÿ®ÿπÿØ ÿßÿ≤ ÿßÿπŸÑÿßŸÖ ŸÖÿ±⁄Ø‚ÄåŸáÿß ÿ¥ÿ±Ÿàÿπ ŸÖ€å‚Äåÿ¥ŸàÿØ</li>
                        <li>Ÿáÿ± ÿ®ÿßÿ≤€å⁄©ŸÜ €≤ ŸÜŸàÿ®ÿ™ €≥€∞ ÿ´ÿßŸÜ€åŸá‚Äåÿß€å ÿ®ÿ±ÿß€å ÿØŸÅÿßÿπ ÿØÿßÿ±ÿØ</li>
                        <li>ÿ®ÿßÿ≤Ÿæÿ±ÿ≥ ÿ™ÿµŸÖ€åŸÖ ŸÖ€å‚Äå⁄Ø€åÿ±ÿØ: ÿßÿØÿßŸÖŸá €åÿß ŸÑÿ∫Ÿà</li>
                        <li>ÿß⁄Øÿ± ÿßÿØÿßŸÖŸá €åÿßÿ®ÿØ: ÿ±ÿß€å ÿßÿ¨ÿ®ÿßÿ±€å ÿ®€åŸÜ €≤ ÿ®ÿßÿ≤€å⁄©ŸÜ</li>
                        <li>ŸÜŸÇÿ¥ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸá ŸÅÿßÿ¥ ŸÖ€å‚Äåÿ¥ŸàÿØ</li>
                    </ul>

                    <h3>üèÜ ÿ¥ÿ±ÿß€åÿ∑ ÿ®ÿ±ÿØ</h3>
                    <ul>
                        <li><strong>ÿ®ÿ±ÿØ ŸÖÿßŸÅ€åÿß:</strong> ŸàŸÇÿ™€å ÿ™ÿπÿØÿßÿØ ŸÖÿßŸÅ€åÿßŸáÿß ÿ®ÿß ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿ®ÿ±ÿßÿ®ÿ± €åÿß ÿ®€åÿ¥ÿ™ÿ± ÿ¥ŸàÿØ</li>
                        <li><strong>ÿ®ÿ±ÿØ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ:</strong> ŸàŸÇÿ™€å ŸáŸÖŸá ÿßÿπÿ∂ÿß€å ŸÖÿßŸÅ€åÿß ÿ≠ÿ∞ŸÅ ÿ¥ŸàŸÜÿØ</li>
                    </ul>

                    <h3>üí° ŸÜ⁄©ÿßÿ™ ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å⁄©</h3>
                    <ul>
                        <li><strong>ÿ±ÿ¶€åÿ≥ ŸÖÿßŸÅ€åÿß:</strong> ÿ≥ŸàÿØÿß⁄Øÿ±€å €åÿß⁄©Ÿàÿ≤ÿß€å€å ÿ±ÿß ÿ®ÿ±ÿß€å ŸÑÿ≠ÿ∏ÿßÿ™ ÿ≠ÿ≥ÿßÿ≥ ÿ∞ÿÆ€åÿ±Ÿá ⁄©ŸÜ€åÿØ</li>
                        <li><strong>ÿ¥€åÿßÿØ:</strong> Ÿæ€åÿØÿß ⁄©ÿ±ÿØŸÜ ⁄©ÿßÿ±ÿ¢⁄ØÿßŸáÿå ÿ™ÿ≠ŸÇ€åŸÇÿßÿ™ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿ±ÿß ŸÅŸÑÿ¨ ŸÖ€å‚Äå⁄©ŸÜÿØ</li>
                        <li><strong>ÿ®ÿßÿ≤Ÿæÿ±ÿ≥:</strong> ŸÇÿØÿ±ÿ™ ÿÆŸàÿØ ÿ±ÿß ÿπÿßŸÇŸÑÿßŸÜŸá ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ - ŸÅŸÇÿ∑ €å⁄© ÿ¥ÿßŸÜÿ≥ ÿØÿßÿ±€åÿØ</li>
                        <li><strong>ŸÖÿ≠ŸÇŸÇ:</strong> ÿ®Ÿá ŸÖÿßŸÅ€åÿßŸáÿß€å ŸÖÿ¥⁄©Ÿà⁄© Ÿæ€åŸàŸÜÿØ ÿ®ÿ≤ŸÜ€åÿØ ÿ™ÿß ÿ¢ŸÜ‚ÄåŸáÿß ÿ±ÿß ÿ®ÿß ÿÆŸàÿØ ÿ®ÿ®ÿ±€åÿØ</li>
                        <li><strong>ÿ±Ÿà€å€åŸÜ‚Äåÿ™ŸÜ:</strong> ÿÆŸàÿØ ÿ±ÿß ŸÅÿßÿ¥ ŸÜ⁄©ŸÜ€åÿØ - ŸáÿØŸÅ ÿ≥ŸàÿØÿß⁄Øÿ±€å Ÿáÿ≥ÿ™€åÿØ!</li>
                    </ul>
                `;
            }
        }

        function startGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const errorMsg = document.getElementById('errorMsg');
            
            if (!playerCount || playerCount < 6 || playerCount > 20) {
                errorMsg.textContent = currentLang === 'en' 
                    ? 'Please enter a number between 6 and 20' 
                    : 'ŸÑÿ∑ŸÅÿßŸã ÿπÿØÿØ€å ÿ®€åŸÜ €∂ ÿ™ÿß €≤€∞ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            
            const teamSize = calculateTeamSize(playerCount);
            
            // Create role array based on calculated team sizes
            let roleArray = [];
            
            // Add Mafia roles
            for (let i = 0; i < teamSize.godfather; i++) roleArray.push('godfather');
            for (let i = 0; i < teamSize.nato; i++) roleArray.push('nato');
            for (let i = 0; i < teamSize.shayad; i++) roleArray.push('shayad');
            for (let i = 0; i < teamSize.simpleMafia; i++) roleArray.push('simpleMafia');
            
            // Add Citizen roles
            for (let i = 0; i < teamSize.doctor; i++) roleArray.push('doctor');
            for (let i = 0; i < teamSize.detective; i++) roleArray.push('detective');
            for (let i = 0; i < teamSize.ironBody; i++) roleArray.push('ironBody');
            for (let i = 0; i < teamSize.sniper; i++) roleArray.push('sniper');
            for (let i = 0; i < teamSize.investigator; i++) roleArray.push('investigator');
            for (let i = 0; i < teamSize.interrogator; i++) roleArray.push('interrogator');
            for (let i = 0; i < teamSize.citizen; i++) roleArray.push('citizen');
            
            // Shuffle and assign
            playerRoles = shuffleArray(roleArray);
            currentPlayerIndex = 0;
            
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('gameSection').classList.remove('hidden');
            
            // Hide back-to-home button during game
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
            
            showPlayerReveal();
        }

        function showPlayerReveal() {
            const rolesContainer = document.getElementById('rolesContainer');
            const newGameBtn = document.getElementById('newGameBtn');
            const t = translations[currentLang];
            
            if (currentPlayerIndex >= playerRoles.length) {
                if (!gameCountIncremented) {
                    incrementGlobalCounter();
                    gameCountIncremented = true;
                }
                
                rolesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üéâ</div>
                        <h2 style="color: #333; margin-bottom: 15px;">${t.allAssigned}</h2>
                        <p style="color: #666; font-size: 1.1em;">${t.gameBegin}</p>
                    </div>
                `;
                newGameBtn.classList.remove('hidden');
                return;
            }
            
            newGameBtn.classList.add('hidden');
            
            rolesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div id="instructionBox" style="background: #f8f9fa; border-radius: 15px; padding: 30px; margin-bottom: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 15px;">üë§</div>
                        <h2 style="color: #333; margin-bottom: 10px;">${t.playerLabel} ${currentPlayerIndex + 1}</h2>
                        <p style="color: #666;">${currentLang === 'en' ? 'Click the button below to see your role' : 'ÿ±Ÿà€å ÿØ⁄©ŸÖŸá ÿ≤€åÿ± ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ŸÜŸÇÿ¥ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ®€åŸÜ€åÿØ'}</p>
                    </div>
                    
                    <div id="roleRevealArea"></div>
                    
                    <button class="btn" id="showRoleBtn" onclick="revealRole()">${t.showRoleBtn}</button>
                </div>
            `;
        }

        function revealRole() {
            document.getElementById('instructionBox').style.display = 'none';
            document.getElementById('showRoleBtn').style.display = 'none';
            
            const roleKey = playerRoles[currentPlayerIndex];
            const role = roles[currentLang][roleKey];
            const t = translations[currentLang];
            
            let teamBadge = '';
            let teamColor = '';
            if (role.team === 'mafia') {
                teamBadge = currentLang === 'en' ? 'üòà Mafia Team' : 'üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß';
                teamColor = '#ee3d72';
            } else if (role.team === 'citizen') {
                teamBadge = currentLang === 'en' ? 'üòá Citizens Team' : 'üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ';
                teamColor = '#4facfe';
            }
            
            const roleRevealArea = document.getElementById('roleRevealArea');
            roleRevealArea.innerHTML = `
                <div class="role-card ${role.class}" style="margin-bottom: 20px; cursor: default;">
                    <div style="text-align: ${currentLang === 'fa' ? 'right' : 'left'};">
                        <div style="display: inline-block; background: ${teamColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; font-weight: 600;">
                            ${teamBadge}
                        </div>
                        <div class="role-name" style="font-size: 1.8em; margin-bottom: 15px;">
                            ${role.name}
                        </div>
                        <div class="role-description" style="font-size: 1.05em; line-height: 1.8;">
                            ${role.description}
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="nextPlayer()" style="margin-top: 20px;">${t.sawRoleBtn}</button>
            `;
        }

        function nextPlayer() {
            currentPlayerIndex++;
            showPlayerReveal();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function resetGame() {
            currentPlayerIndex = 0;
            playerRoles = [];
            gameCountIncremented = false;
            document.getElementById('setupSection').classList.remove('hidden');
            document.getElementById('gameSection').classList.add('hidden');
            document.getElementById('rolesContainer').innerHTML = '';
            document.getElementById('newGameBtn').classList.add('hidden');
            
            // Show back-to-home button when returning to setup
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
        }

        function cancelGame() {
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        function confirmCancel() {
            closeConfirm();
            resetGame();
        }

        function closeConfirm() {
            document.getElementById('confirmModal').classList.add('hidden');
        }

        function showHelp() {
            document.getElementById('helpModal').classList.remove('hidden');
            // Hide back-to-home button when showing help
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.add('hidden');
            // Show back-to-home button when closing help
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
        }

        function showFeedback() {
            document.getElementById('feedbackModal').classList.remove('hidden');
            // Hide back-to-home button when showing feedback
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').classList.add('hidden');
            // Show back-to-home button when closing feedback
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
            setTimeout(() => {
                document.getElementById('feedbackForm').reset();
                document.getElementById('feedbackStatus').classList.add('hidden');
            }, 300);
        }

        function updateGlobalCounter() {
            if (!database) {
                const t = translations[currentLang];
                document.getElementById('gameCounter').textContent = t.gamesPlayed + ' ' + (currentLang === 'en' ? 'Setup Required' : 'ŸÜ€åÿßÿ≤ ÿ®Ÿá ÿ™ŸÜÿ∏€åŸÖ');
                return;
            }

            const counterRef = database.ref('bazporsGameCounter');
            counterRef.on('value', (snapshot) => {
                const count = snapshot.val() || 0;
                const t = translations[currentLang];
                document.getElementById('gameCounter').textContent = t.gamesPlayed + ' ' + count.toLocaleString(currentLang === 'fa' ? 'fa-IR' : 'en-US');
            });
        }

        function incrementGlobalCounter() {
            if (!database) return;

            const counterRef = database.ref('bazporsGameCounter');
            counterRef.transaction((currentValue) => {
                return (currentValue || 0) + 1;
            });
        }

        function submitFeedback(event) {
            event.preventDefault();
            
            const name = document.getElementById('feedbackName').value.trim();
            const email = document.getElementById('feedbackEmail').value.trim();
            const message = document.getElementById('feedbackMessage').value.trim();
            const submitBtn = document.getElementById('submitFeedbackBtn');
            const statusEl = document.getElementById('feedbackStatus');
            
            if (!message) {
                statusEl.textContent = currentLang === 'en' ? '‚ö†Ô∏è Please enter a message' : '‚ö†Ô∏è ŸÑÿ∑ŸÅÿßŸã Ÿæ€åÿßŸÖ€å Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                statusEl.style.background = '#fff3cd';
                statusEl.style.color = '#856404';
                statusEl.classList.remove('hidden');
                return;
            }
            
            submitBtn.disabled = true;
            const sendingText = currentLang === 'en' ? 'üì§ Sending...' : 'üì§ ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ...';
            submitBtn.querySelector('span').textContent = sendingText;
            
            if (database) {
                const counterRef = database.ref('bazporsFeedbackCounter');
                counterRef.transaction((currentValue) => {
                    return (currentValue || 0) + 1;
                }).then((result) => {
                    const feedbackNumber = result.snapshot.val();
                    
                    const feedbackRef = database.ref('bazporsFeedback');
                    return feedbackRef.push({
                        number: feedbackNumber,
                        name: name || 'Anonymous',
                        email: email || 'Not provided',
                        message: message,
                        language: currentLang,
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleString()
                    }).then(() => feedbackNumber);
                })
                .then((feedbackNumber) => {
                    if (EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
                        emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                            feedback_number: feedbackNumber,
                            from_name: name || 'Anonymous',
                            from_email: email || 'Not provided',
                            message: message + '\n\nLanguage: ' + currentLang + '\n\nScenario: Detective',
                            to_email: 'contact.ehm@gmail.com'
                        }).catch((error) => {
                            console.error('EmailJS error:', error);
                        });
                    }
                    
                    statusEl.textContent = currentLang === 'en' ? '‚úÖ Thank you! Your feedback has been sent successfully!' : '‚úÖ ŸÖÿ™ÿ¥⁄©ÿ±€åŸÖ! ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ ÿ¥ŸÖÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ!';
                    statusEl.style.background = '#d4edda';
                    statusEl.style.color = '#155724';
                    statusEl.classList.remove('hidden');
                    
                    document.getElementById('feedbackForm').reset();
                    
                    setTimeout(() => {
                        closeFeedback();
                    }, 2000);
                })
                .catch((error) => {
                    console.error('Error submitting feedback:', error);
                    statusEl.textContent = currentLang === 'en' ? '‚ùå Error sending feedback. Please try again.' : '‚ùå ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.';
                    statusEl.style.background = '#f8d7da';
                    statusEl.style.color = '#721c24';
                    statusEl.classList.remove('hidden');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.querySelector('span').textContent = translations[currentLang].sendBtn;
                });
            } else {
                statusEl.textContent = currentLang === 'en' ? '‚ùå Firebase not configured.' : '‚ùå Firebase Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™.';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
                statusEl.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.querySelector('span').textContent = translations[currentLang].sendBtn;
            }
        }

        // Close modals when clicking outside
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('helpModal').addEventListener('click', function(e) {
                if (e.target === this) closeHelp();
            });
            
            document.getElementById('feedbackModal').addEventListener('click', function(e) {
                if (e.target === this) closeFeedback();
            });
            
            document.getElementById('confirmModal').addEventListener('click', function(e) {
                if (e.target === this) closeConfirm();
            });

            // Initialize
            updateLanguage();
            updateGlobalCounter();
        });
    </script>
</body>
</html>
