<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia: El Cl√°sico - Role Assigner</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d3561 0%, #3e2753 50%, #4a2c5e 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* RTL Support for Farsi */
        body.rtl {
            direction: rtl;
            font-family: Tahoma, 'Segoe UI', Arial, sans-serif;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            padding: 30px;
            animation: fadeIn 0.5s ease-in;
            position: relative;
            margin-top: 80px;
        }

        .back-home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 2000;
            cursor: pointer;
        }

        .back-home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Language Toggle Button */
        .language-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 4000;
        }

        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        h1 {
            text-align: center;
            color: #1a1a2e;
            margin-bottom: 40px;
            font-size: 2em;
            margin-top: 20px;
            position: relative;
            padding-bottom: 20px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 2px;
            background: linear-gradient(90deg, #e94560 0%, #f093fb 50%, #e94560 100%);
            border-radius: 1px;
            box-shadow: 0 2px 10px rgba(233, 69, 96, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .info-badge {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
        }

        .roles-section {
            margin-top: 30px;
        }

        .role-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.rtl .role-card {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .role-card:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        body.rtl .role-card:hover {
            transform: translateX(-5px);
        }

        .role-card.mafia {
            border-left-color: #f5576c;
        }

        body.rtl .role-card.mafia {
            border-right-color: #f5576c;
        }

        .role-card.citizen {
            border-left-color: #4facfe;
        }

        body.rtl .role-card.citizen {
            border-right-color: #4facfe;
        }

        .role-card.independent {
            border-left-color: #8b5cf6;
        }

        body.rtl .role-card.independent {
            border-right-color: #8b5cf6;
        }

        .player-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: 700;
            margin-right: 15px;
        }

        body.rtl .player-number {
            margin-right: 0;
            margin-left: 15px;
        }

        .role-card.mafia .player-number {
            background: #f5576c;
        }

        .role-card.citizen .player-number {
            background: #4facfe;
        }

        .role-card.independent .player-number {
            background: #8b5cf6;
        }

        .role-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .role-description {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
            line-height: 1.6;
        }

        .close-game-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 20px;
            width: 70px;
            height: 36px;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(245, 87, 108, 0.3);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-game-btn:hover {
            background: #e04560;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.5);
        }

        #gameCounter {
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
            text-align: center;
            padding: 10px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
            overflow-y: auto;
        }

        .hidden {
            display: none !important;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
            margin-top: 50px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            margin: 0;
            color: white;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-body h3 {
            color: #1a1a2e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .modal-body h3:first-child {
            margin-top: 0;
        }

        .modal-body h4 {
            color: #333;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .modal-body p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .modal-body ul {
            color: #666;
            line-height: 2;
            padding-left: 25px;
            margin-bottom: 15px;
        }

        body.rtl .modal-body ul {
            padding-left: 0;
            padding-right: 25px;
        }

        .role-help {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        body.rtl .role-help {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .role-help.mafia {
            border-left-color: #f5576c;
        }

        body.rtl .role-help.mafia {
            border-right-color: #f5576c;
        }

        .role-help.citizen {
            border-left-color: #4facfe;
        }

        body.rtl .role-help.citizen {
            border-right-color: #4facfe;
        }

        .role-help.independent {
            border-left-color: #8b5cf6;
        }

        body.rtl .role-help.independent {
            border-right-color: #8b5cf6;
        }

        .team-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .team-badge.mafia {
            background: #f5576c;
            color: white;
        }

        .team-badge.citizen {
            background: #4facfe;
            color: white;
        }

        .team-badge.independent {
            background: #8b5cf6;
            color: white;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin-top: 70px;
            }

            h1 {
                font-size: 1.5em;
            }

            .language-toggle,
            .back-home-btn {
                padding: 8px 15px;
                font-size: 0.8em;
                top: 15px;
            }

            .language-toggle {
                right: 15px;
            }

            .back-home-btn {
                left: 15px;
            }

            .close-game-btn {
                width: 60px;
                height: 32px;
                font-size: 1.1em;
            }

            .close-btn {
                width: 36px;
                height: 36px;
                font-size: 1.3em;
            }

            .modal-body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Global Language Toggle (Fixed Position) -->
    <button class="language-toggle" onclick="toggleLanguage()">
        <span id="langButtonText">ŸÅÿßÿ±ÿ≥€å</span>
    </button>

    <!-- Back to Home Button (Fixed Position) -->
    <a href="index.html" class="back-home-btn">
        <span>üè†</span>
        <span id="backHomeText">Back to Home</span>
    </a>

    <div class="container">
        <div id="setupSection">
            <h1 id="mainTitle">üé≠ Mafia: El Cl√°sico ‚öîÔ∏è</h1>

            <div class="input-section" style="margin-bottom: 20px;">
                <label for="playerCount" style="display: block; color: #333; margin-bottom: 10px; font-weight: 600; font-size: 1.1em;">
                    <span id="playerCountLabel">Number of Players (8-13):</span>
                </label>
                <input type="number" id="playerCount" min="8" max="13" value="11" placeholder="Enter number of players"
                       style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1.1em; transition: all 0.3s ease;"
                       oninput="updatePlayerInfo()"
                       onfocus="this.style.borderColor='#e94560'; this.style.boxShadow='0 0 0 3px rgba(233, 69, 96, 0.1)';"
                       onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none';">
                <p class="error hidden" id="errorMsg" style="color: #ee3d72; font-size: 0.9em; margin-top: 10px; text-align: center;"></p>
            </div>

            <div class="info-badge" id="playerInfo">
                11 Players: 3 Mafia ‚Ä¢ 7 Citizens ‚Ä¢ 1 Independent
            </div>

            <button class="btn" onclick="startGame()">
                <span id="assignBtn">üé≤ Assign Roles</span>
            </button>
            <button class="btn btn-secondary" onclick="showHelp()">
                <span id="howToPlayBtn">üìñ How to Play</span>
            </button>
            <button class="btn btn-secondary" onclick="showFeedback()">
                <span id="feedbackBtn">üí¨ Feedback</span>
            </button>
            <div id="gameCounter">Games Played Worldwide: Loading...</div>
        </div>

        <div id="gameSection" class="hidden">
            <button class="close-game-btn" onclick="cancelGame()" title="Cancel and start over">‚úï</button>
            
            <div class="roles-section">
                <div id="rolesContainer"></div>
            </div>

            <button class="btn btn-secondary hidden" id="newGameBtn" onclick="resetGame()">
                <span id="newGameText">üîÑ New Game</span>
            </button>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="helpTitle">üìñ How to Play - Mafia: El Cl√°sico</h2>
                <button class="close-btn" onclick="closeHelp()">‚úï</button>
            </div>
            <div class="modal-body" id="helpContent">
                <!-- Content will be populated by JavaScript based on language -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="feedbackTitle">üí¨ Send Feedback</h2>
                <button class="close-btn" onclick="closeFeedback()">‚úï</button>
            </div>
            <div class="modal-body">
                <p id="feedbackIntro" style="color: #666; margin-bottom: 20px;">Have questions, suggestions, or ideas to improve the game? We'd love to hear from you!</p>
                
                <form id="feedbackForm" onsubmit="submitFeedback(event)">
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackName" id="nameLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Name (Optional)</label>
                        <input type="text" id="feedbackName" placeholder="Your name" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackEmail" id="emailLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Email (Optional)</label>
                        <input type="email" id="feedbackEmail" placeholder="your.email@example.com" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackMessage" id="messageLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Message *</label>
                        <textarea id="feedbackMessage" required placeholder="Share your thoughts..." 
                                  style="width: 100%; min-height: 150px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <p id="feedbackStatus" class="hidden" style="padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-weight: 600;"></p>
                    
                    <button type="submit" class="btn" id="submitFeedbackBtn">
                        <span id="sendBtn">üì§ Send Feedback</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmTitle" style="font-size: 1.3em;">‚ö†Ô∏è Cancel Game?</h2>
            </div>
            <div class="modal-body">
                <p id="confirmText" style="font-size: 1.1em; text-align: center; margin-bottom: 20px;">
                    Are you sure you want to cancel this game and start over?
                </p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" style="flex: 1;" onclick="confirmCancel()">
                        <span id="yesBtn">Yes, Cancel</span>
                    </button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="closeConfirm()">
                        <span id="noBtn">No, Continue</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBSTuzqrJ0ik2CTfKq0GOc7lEVUYtxCX0E",
            authDomain: "spy-game-12f96.firebaseapp.com",
            databaseURL: "https://spy-game-12f96-default-rtdb.firebaseio.com",
            projectId: "spy-game-12f96",
            storageBucket: "spy-game-12f96.firebasestorage.app",
            messagingSenderId: "22301781663",
            appId: "1:22301781663:web:23f31448a872e41203fcaa",
            measurementId: "G-DE4QRR88RH"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        const EMAILJS_PUBLIC_KEY = 'qw_grGhV3it_4-RwE';
        const EMAILJS_SERVICE_ID = 'service_f65c74d';
        const EMAILJS_TEMPLATE_ID = 'template_gna5het';
        
        try {
            emailjs.init(EMAILJS_PUBLIC_KEY);
        } catch (error) {
            console.error("EmailJS initialization error:", error);
        }

        // Language System
        let currentLang = localStorage.getItem('language') || 'fa';

        const translations = {
            en: {
                mainTitle: 'üé≠ Mafia: El Cl√°sico ‚öîÔ∏è',
                playerCountLabel: 'Number of Players (8-13):',
                playerInfo: '11 Players: 3 Mafia ‚Ä¢ 7 Citizens ‚Ä¢ 1 Independent',
                assignBtn: 'üé≤ Assign Roles',
                howToPlayBtn: 'üìñ How to Play',
                feedbackBtn: 'üí¨ Feedback',
                newGameText: 'üîÑ New Game',
                langButtonText: 'ŸÅÿßÿ±ÿ≥€å',
                helpTitle: 'üìñ How to Play - Mafia: El Cl√°sico',
                feedbackTitle: 'üí¨ Send Feedback',
                feedbackIntro: 'Have questions, suggestions, or ideas to improve the game? We\'d love to hear from you!',
                nameLabel: 'Name (Optional)',
                emailLabel: 'Email (Optional)',
                messageLabel: 'Message *',
                sendBtn: 'üì§ Send Feedback',
                confirmTitle: '‚ö†Ô∏è Cancel Game?',
                confirmText: 'Are you sure you want to cancel this game and start over?',
                yesBtn: 'Yes, Cancel',
                noBtn: 'No, Continue',
                playerLabel: 'Player',
                showRoleBtn: 'üé≠ Show My Role',
                sawRoleBtn: '‚úÖ I Saw My Role',
                allAssigned: 'All Roles Assigned!',
                gameBegin: 'The game can now begin. Good luck!',
                gamesPlayed: 'Games Played Worldwide:',
                drawCard: 'üÉè Draw Exit Card',
                cardDrawn: 'Card Drawn:',
                noCardsLeft: 'No cards left!',
                cardsRemaining: 'cards remaining'
            },
            fa: {
                mainTitle: 'üé≠ ŸÖÿßŸÅ€åÿß: ÿßŸÑ ⁄©ŸÑÿßÿ≥€å⁄©Ÿà ‚öîÔ∏è',
                playerCountLabel: 'ÿ™ÿπÿØÿßÿØ ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ (€∏-€±€≥):',
                playerInfo: '€±€± ÿ®ÿßÿ≤€å⁄©ŸÜ: €≥ ŸÖÿßŸÅ€åÿß - €∑ ÿ¥Ÿáÿ±ŸàŸÜÿØ - €± ŸÖÿ≥ÿ™ŸÇŸÑ',
                assignBtn: 'üé≤ ÿ™ÿÆÿµ€åÿµ ŸÜŸÇÿ¥‚ÄåŸáÿß',
                howToPlayBtn: 'üìñ ÿ¢ŸÖŸàÿ≤ÿ¥ ÿ®ÿßÿ≤€å',
                feedbackBtn: 'üí¨ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                newGameText: 'üîÑ ÿ®ÿßÿ≤€å ÿ¨ÿØ€åÿØ',
                langButtonText: 'English',
                helpTitle: 'üìñ ÿ¢ŸÖŸàÿ≤ÿ¥ ÿ®ÿßÿ≤€å - ŸÖÿßŸÅ€åÿß: ÿßŸÑ ⁄©ŸÑÿßÿ≥€å⁄©Ÿà',
                feedbackTitle: 'üí¨ ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                feedbackIntro: 'ÿ≥ŸàÿßŸÑÿå Ÿæ€åÿ¥ŸÜŸáÿßÿØ €åÿß ÿß€åÿØŸá‚Äåÿß€å ÿ®ÿ±ÿß€å ÿ®Ÿáÿ®ŸàÿØ ÿ®ÿßÿ≤€å ÿØÿßÿ±€åÿØÿü ÿÆŸàÿ¥ÿ≠ÿßŸÑ ŸÖ€å‚Äåÿ¥Ÿà€åŸÖ ŸÜÿ∏ÿ±ÿ™ÿßŸÜ ÿ±ÿß ÿ®ÿ¥ŸÜŸà€åŸÖ!',
                nameLabel: 'ŸÜÿßŸÖ (ÿßÿÆÿ™€åÿßÿ±€å)',
                emailLabel: 'ÿß€åŸÖ€åŸÑ (ÿßÿÆÿ™€åÿßÿ±€å)',
                messageLabel: 'Ÿæ€åÿßŸÖ *',
                sendBtn: 'üì§ ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                confirmTitle: '‚ö†Ô∏è ŸÑÿ∫Ÿà ÿ®ÿßÿ≤€åÿü',
                confirmText: 'ÿ¢€åÿß ŸÖÿ∑ŸÖÿ¶ŸÜ Ÿáÿ≥ÿ™€åÿØ ⁄©Ÿá ŸÖ€å‚ÄåÿÆŸàÿßŸá€åÿØ ÿß€åŸÜ ÿ®ÿßÿ≤€å ÿ±ÿß ŸÑÿ∫Ÿà ⁄©ŸÜ€åÿØ Ÿà ÿßÿ≤ ŸÜŸà ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØÿü',
                yesBtn: 'ÿ®ŸÑŸáÿå ŸÑÿ∫Ÿà ⁄©ŸÜ',
                noBtn: 'ÿÆ€åÿ±ÿå ÿßÿØÿßŸÖŸá ÿ®ÿØŸá',
                playerLabel: 'ÿ®ÿßÿ≤€å⁄©ŸÜ',
                showRoleBtn: 'üé≠ ŸÜŸÖÿß€åÿ¥ ŸÜŸÇÿ¥ ŸÖŸÜ',
                sawRoleBtn: '‚úÖ ŸÜŸÇÿ¥ŸÖ ÿ±ÿß ÿØ€åÿØŸÖ',
                allAssigned: 'ŸáŸÖŸá ŸÜŸÇÿ¥‚ÄåŸáÿß ÿ™ÿÆÿµ€åÿµ ÿØÿßÿØŸá ÿ¥ÿØ!',
                gameBegin: 'ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ÿ±Ÿàÿπ ÿ¥ŸàÿØ. ŸÖŸàŸÅŸÇ ÿ®ÿßÿ¥€åÿØ!',
                gamesPlayed: 'ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿßŸÜÿ¨ÿßŸÖ ÿ¥ÿØŸá ÿØÿ± ÿ≥ÿ±ÿßÿ≥ÿ± ÿ¨ŸáÿßŸÜ:',
                drawCard: 'üÉè ⁄©ÿ¥€åÿØŸÜ ⁄©ÿßÿ±ÿ™ ÿÆÿ±Ÿàÿ¨',
                cardDrawn: '⁄©ÿßÿ±ÿ™ ⁄©ÿ¥€åÿØŸá ÿ¥ÿØŸá:',
                noCardsLeft: '⁄©ÿßÿ±ÿ™€å ÿ®ÿßŸÇ€å ŸÜŸÖÿßŸÜÿØŸá!',
                cardsRemaining: '⁄©ÿßÿ±ÿ™ ÿ®ÿßŸÇ€å‚ÄåŸÖÿßŸÜÿØŸá'
            }
        };

        // Role definitions
        const roles = {
            en: {
                pablo: {
                    name: 'Pablo Escobar',
                    team: 'mafia',
                    description: 'You are Pablo Escobar, the mafia leader. Each night, choose a victim to shoot. You can also guess someone\'s identity and slaughter them. You are immortal until someone correctly guesses your role.',
                    class: 'mafia'
                },
                juan: {
                    name: 'Juan Velasquez',
                    team: 'mafia',
                    description: 'You are Juan Velasquez. Each night, disable one citizen\'s ability. You cannot target the same person two consecutive nights.',
                    class: 'mafia'
                },
                griselda: {
                    name: 'Griselda Blanco',
                    team: 'mafia',
                    description: 'You are Griselda Blanco. If a mafia member is eliminated, you can convert one Simple Citizen or Chaplin to the mafia team. If you are eliminated before using this ability, Pablo can perform both a shoot and slaughter in one night.',
                    class: 'mafia'
                },
                churchill: {
                    name: 'Churchill',
                    team: 'independent',
                    description: 'You are Churchill, the independent player. From night 2, predict who will be eliminated the next day. If correct, you become immortal. You can guess identities and slaughter. You have a vest on night 1. Your win condition depends on the final "Key Ace" stage composition.',
                    class: 'independent'
                },
                bridget: {
                    name: 'Dr. Bridget',
                    team: 'citizen',
                    description: 'You are Dr. Bridget. Each night, save one person from shooting. You can save yourself twice during the game, but not two consecutive nights (unless certain conditions are met).',
                    class: 'citizen'
                },
                moreno: {
                    name: 'Moreno',
                    team: 'citizen',
                    description: 'You are Moreno. You have one war rifle and one practice rifle. Each night, distribute them between two people. You can only keep the practice rifle for yourself. If the war rifle holder is eliminated, it returns to you (unless they used it). When someone is eliminated by war rifle, their side is announced.',
                    class: 'citizen'
                },
                bonaparte: {
                    name: 'General Bonaparte',
                    team: 'citizen',
                    description: 'You are General Bonaparte. Each night, set a code and select a player who receives it. If both alive next day, you know they\'re a citizen. Use the code to communicate your next target. If you select mafia or Churchill, you are eliminated.',
                    class: 'citizen'
                },
                martinez: {
                    name: 'Officer Martinez',
                    team: 'citizen',
                    description: 'You are Officer Martinez. You can shoot once. If you shoot mafia, they\'re eliminated. If you shoot citizen, you\'re eliminated. Shooting Churchill or Escobar eliminates no one. You have one slaughter ability that works even if shooting is disabled. Slaughtering a citizen doesn\'t eliminate you.',
                    class: 'citizen'
                },
                chaplin: {
                    name: 'Chaplin',
                    team: 'citizen',
                    description: 'You are Chaplin. On night 1, wake up and select one Simple Citizen to protect from being bought/converted by mafia (counters Blanco).',
                    class: 'citizen'
                },
                citizen: {
                    name: 'Simple Citizen',
                    team: 'citizen',
                    description: 'You are a Simple Citizen. You have no special abilities, but your voice and vote are crucial. Discuss, analyze, and help find the mafia!',
                    class: 'citizen'
                }
            },
            fa: {
                pablo: {
                    name: 'Ÿæÿßÿ®ŸÑŸà ÿßÿ≥⁄©Ÿàÿ®ÿßÿ±',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß Ÿæÿßÿ®ŸÑŸà ÿßÿ≥⁄©Ÿàÿ®ÿßÿ±ÿå ÿ±Ÿáÿ®ÿ± ŸÖÿßŸÅ€åÿß Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÇÿ±ÿ®ÿßŸÜ€å ÿ®ÿ±ÿß€å ÿ¥ŸÑ€å⁄© ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ. ŸáŸÖ⁄ÜŸÜ€åŸÜ ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ŸáŸà€åÿ™ ⁄©ÿ≥€å ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ Ÿà ÿ≥ŸÑÿßÿÆ€å ⁄©ŸÜ€åÿØ. ÿ™ÿß ÿ≤ŸÖÿßŸÜ€å ⁄©Ÿá ⁄©ÿ≥€å ŸÜŸÇÿ¥ ÿ¥ŸÖÿß ÿ±ÿß ÿØÿ±ÿ≥ÿ™ ÿ≠ÿØÿ≥ ŸÜÿ≤ŸÜÿØÿå ŸÜÿßŸÖ€åÿ±ÿß Ÿáÿ≥ÿ™€åÿØ.',
                    class: 'mafia'
                },
                juan: {
                    name: 'ÿÆŸàÿ¢ŸÜ ŸàŸÑÿßÿ≥⁄©Ÿàÿ¶ÿ≤',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ÿÆŸàÿ¢ŸÜ ŸàŸÑÿßÿ≥⁄©Ÿàÿ¶ÿ≤ Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® ÿ™ŸàÿßŸÜÿß€å€å €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ±ÿß ÿßÿ≤ ⁄©ÿßÿ± ÿ®€åŸÜÿØÿßÿ≤€åÿØ. ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿØŸà ÿ¥ÿ® Ÿæÿ¥ÿ™ ÿ≥ÿ± ŸáŸÖ €å⁄© ŸÜŸÅÿ± ÿ±ÿß ŸáÿØŸÅ ÿ®⁄Ø€åÿ±€åÿØ.',
                    class: 'mafia'
                },
                griselda: {
                    name: '⁄Øÿ±€åÿ≥ŸÑÿØÿß ÿ®ŸÑÿßŸÜ⁄©Ÿà',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ⁄Øÿ±€åÿ≥ŸÑÿØÿß ÿ®ŸÑÿßŸÜ⁄©Ÿà Ÿáÿ≥ÿ™€åÿØ. ÿß⁄Øÿ± €å⁄© ÿπÿ∂Ÿà ŸÖÿßŸÅ€åÿß ÿ≠ÿ∞ŸÅ ÿ¥ŸàÿØÿå ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá €åÿß ⁄ÜÿßŸæŸÑ€åŸÜ ÿ±ÿß ÿ®Ÿá ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ŸÇÿ®ŸÑ ÿßÿ≤ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ÿß€åŸÜ ÿ™ŸàÿßŸÜÿß€å€å ÿ≠ÿ∞ŸÅ ÿ¥Ÿà€åÿØÿå Ÿæÿßÿ®ŸÑŸà ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿØÿ± €å⁄© ÿ¥ÿ® ŸáŸÖ ÿ¥ŸÑ€å⁄© Ÿà ŸáŸÖ ÿ≥ŸÑÿßÿÆ€å ÿßŸÜÿ¨ÿßŸÖ ÿØŸáÿØ.',
                    class: 'mafia'
                },
                churchill: {
                    name: '⁄Üÿ±⁄Ü€åŸÑ',
                    team: 'independent',
                    description: 'ÿ¥ŸÖÿß ⁄Üÿ±⁄Ü€åŸÑÿå ÿ®ÿßÿ≤€å⁄©ŸÜ ŸÖÿ≥ÿ™ŸÇŸÑ Ÿáÿ≥ÿ™€åÿØ. ÿßÿ≤ ÿ¥ÿ® ÿØŸàŸÖÿå Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ⁄©ŸÜ€åÿØ ⁄ÜŸá ⁄©ÿ≥€å ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ŸÜÿßŸÖ€åÿ±ÿß ŸÖ€å‚Äåÿ¥Ÿà€åÿØ. ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ŸáŸà€åÿ™‚ÄåŸáÿß ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ Ÿà ÿ≥ŸÑÿßÿÆ€å ⁄©ŸÜ€åÿØ. ÿØÿ± ÿ¥ÿ® ÿßŸàŸÑ €å⁄© ÿ¨ŸÑ€åŸÇŸá ÿØÿßÿ±€åÿØ. ÿ¥ÿ±ÿ∑ ÿ®ÿ±ÿØ ÿ¥ŸÖÿß ÿ®Ÿá ÿ™ÿ±⁄©€åÿ® ŸÜŸáÿß€å€å ŸÖÿ±ÿ≠ŸÑŸá "⁄©€å ÿ¢ÿ≥" ÿ®ÿ≥ÿ™⁄Ø€å ÿØÿßÿ±ÿØ.',
                    class: 'independent'
                },
                bridget: {
                    name: 'ÿØ⁄©ÿ™ÿ± ÿ®ÿ±€åÿ¨€åÿ™',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ÿØ⁄©ÿ™ÿ± ÿ®ÿ±€åÿ¨€åÿ™ Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßÿ≤ ÿ¥ŸÑ€å⁄© ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ. ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿÆŸàÿØÿ™ÿßŸÜ ÿ±ÿß ÿØŸà ÿ®ÿßÿ± ÿØÿ± ÿ∑ŸàŸÑ ÿ®ÿßÿ≤€å ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØÿå ÿßŸÖÿß ŸÜŸá ÿØŸà ÿ¥ÿ® Ÿæÿ¥ÿ™ ÿ≥ÿ± ŸáŸÖ (ŸÖ⁄Øÿ± ÿ¥ÿ±ÿß€åÿ∑ ÿÆÿßÿµ€å ÿ®ÿ±ŸÇÿ±ÿßÿ± ÿ®ÿßÿ¥ÿØ).',
                    class: 'citizen'
                },
                moreno: {
                    name: 'ŸÖŸàÿ±ŸÜŸà',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ŸÖŸàÿ±ŸÜŸà Ÿáÿ≥ÿ™€åÿØ. €å⁄© ÿ™ŸÅŸÜ⁄Ø ÿ¨ŸÜ⁄Ø€å Ÿà €å⁄© ÿ™ŸÅŸÜ⁄Ø ŸÖÿ¥ŸÇ€å ÿØÿßÿ±€åÿØ. Ÿáÿ± ÿ¥ÿ® ÿ¢ŸÜ‚ÄåŸáÿß ÿ±ÿß ÿ®€åŸÜ ÿØŸà ŸÜŸÅÿ± ÿ™Ÿàÿ≤€åÿπ ⁄©ŸÜ€åÿØ. ŸÅŸÇÿ∑ ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿ™ŸÅŸÜ⁄Ø ŸÖÿ¥ŸÇ€å ÿ±ÿß ŸÜÿ≤ÿØ ÿÆŸàÿØÿ™ÿßŸÜ ŸÜ⁄ØŸá ÿØÿßÿ±€åÿØ. ÿß⁄Øÿ± ÿØÿßÿ±ŸÜÿØŸá ÿ™ŸÅŸÜ⁄Ø ÿ¨ŸÜ⁄Ø€å ÿ≠ÿ∞ŸÅ ÿ¥ŸàÿØÿå ÿ®Ÿá ÿ¥ŸÖÿß ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ (ŸÖ⁄Øÿ± ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ÿ±ÿØŸá ÿ®ÿßÿ¥ÿØ). ŸàŸÇÿ™€å ⁄©ÿ≥€å ÿ®ÿß ÿ™ŸÅŸÜ⁄Ø ÿ¨ŸÜ⁄Ø€å ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØÿå ÿ≥ÿß€åÿØ ÿßŸà ÿßÿπŸÑÿßŸÖ ŸÖ€å‚Äåÿ¥ŸàÿØ.',
                    class: 'citizen'
                },
                bonaparte: {
                    name: '⁄òŸÜÿ±ÿßŸÑ ÿ®ŸÜÿßŸæÿßÿ±ÿ™',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ⁄òŸÜÿ±ÿßŸÑ ÿ®ŸÜÿßŸæÿßÿ±ÿ™ Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® €å⁄© ⁄©ÿØ ÿ®⁄Øÿ∞ÿßÿ±€åÿØ Ÿà €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ⁄©Ÿá ÿ¢ŸÜ ÿ±ÿß ÿØÿ±€åÿßŸÅÿ™ ŸÖ€å‚Äå⁄©ŸÜÿØ. ÿß⁄Øÿ± Ÿáÿ± ÿØŸà ŸÅÿ±ÿØÿß ÿ≤ŸÜÿØŸá ÿ®ÿßÿ¥€åÿØÿå ŸÖ€å‚ÄåÿØÿßŸÜ€åÿØ ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿßÿ≥ÿ™. ÿßÿ≤ ⁄©ÿØ ÿ®ÿ±ÿß€å ÿßÿ∑ŸÑÿßÿπ‚Äåÿ±ÿ≥ÿßŸÜ€å ŸáÿØŸÅ ÿ®ÿπÿØ€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ŸÖÿßŸÅ€åÿß €åÿß ⁄Üÿ±⁄Ü€åŸÑ ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØÿå ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ.',
                    class: 'citizen'
                },
                martinez: {
                    name: 'ÿßŸÅÿ≥ÿ± ŸÖÿßÿ±ÿ™€åŸÜÿ≤',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ÿßŸÅÿ≥ÿ± ŸÖÿßÿ±ÿ™€åŸÜÿ≤ Ÿáÿ≥ÿ™€åÿØ. €å⁄© ÿ®ÿßÿ± ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ÿ®Ÿá ŸÖÿßŸÅ€åÿß ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØÿå ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿß⁄Øÿ± ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØÿå ÿ¥ŸÖÿß ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ. ÿ¥ŸÑ€å⁄© ÿ®Ÿá ⁄Üÿ±⁄Ü€åŸÑ €åÿß ÿßÿ≥⁄©Ÿàÿ®ÿßÿ± Ÿá€å⁄Ü‚Äå⁄©ÿ≥ ÿ±ÿß ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äå⁄©ŸÜÿØ. €å⁄© ÿ™ŸàÿßŸÜÿß€å€å ÿ≥ŸÑÿßÿÆ€å ÿØÿßÿ±€åÿØ ⁄©Ÿá ÿ≠ÿ™€å ÿß⁄Øÿ± ÿ¥ŸÑ€å⁄© ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿ¥ŸàÿØ ⁄©ÿßÿ± ŸÖ€å‚Äå⁄©ŸÜÿØ. ÿ≥ŸÑÿßÿÆ€å ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ¥ŸÖÿß ÿ±ÿß ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äå⁄©ŸÜÿØ.',
                    class: 'citizen'
                },
                chaplin: {
                    name: '⁄ÜÿßŸæŸÑ€åŸÜ',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ⁄ÜÿßŸæŸÑ€åŸÜ Ÿáÿ≥ÿ™€åÿØ. ÿØÿ± ÿ¥ÿ® ÿßŸàŸÑ ÿ®€åÿØÿßÿ± ÿ¥Ÿà€åÿØ Ÿà €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ÿ™ÿß ÿßÿ≤ ÿÆÿ±€åÿØ/ÿ™ÿ®ÿØ€åŸÑ ÿ™Ÿàÿ≥ÿ∑ ŸÖÿßŸÅ€åÿß ŸÖÿ≠ÿßŸÅÿ∏ÿ™ ÿ¥ŸàÿØ (ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ ÿ®ŸÑÿßŸÜ⁄©Ÿà ÿπŸÖŸÑ ŸÖ€å‚Äå⁄©ŸÜÿØ).',
                    class: 'citizen'
                },
                citizen: {
                    name: 'ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá Ÿáÿ≥ÿ™€åÿØ. ÿ™ŸàÿßŸÜÿß€å€å ÿÆÿßÿµ€å ŸÜÿØÿßÿ±€åÿØÿå ÿßŸÖÿß ÿµÿØÿß Ÿà ÿ±ÿ£€å ÿ¥ŸÖÿß ÿ≠€åÿßÿ™€å ÿßÿ≥ÿ™. ÿ®ÿ≠ÿ´ ⁄©ŸÜ€åÿØÿå ÿ™ÿ≠ŸÑ€åŸÑ ⁄©ŸÜ€åÿØ Ÿà ÿ®Ÿá Ÿæ€åÿØÿß ⁄©ÿ±ÿØŸÜ ŸÖÿßŸÅ€åÿß ⁄©ŸÖ⁄© ⁄©ŸÜ€åÿØ!',
                    class: 'citizen'
                }
            }
        };

        let currentPlayerIndex = 0;
        let playerRoles = [];
        let gameCountIncremented = false;
        let availableCards = [];
        let drawnCard = null;

        const cardDeck = {
            en: [
                { name: 'üé≠ Guess Role Card', description: 'Guess another player\'s role. If correct, you take their place in the game and they are eliminated.' },
                { name: 'üòµ‚Äçüí´ Dizziness Card', description: 'For 24 hours: you don\'t wake at night, can\'t speak or vote during the day.' },
                { name: 'üõ°Ô∏è Shield Card', description: 'For 24 hours: you cannot be killed at night or eliminated during the day.' },
                { name: 'üí∞ Money Sack Card', description: 'Your abilities are doubled for one night.' },
                { name: 'ü™û Mirror Card', description: 'Your identity and abilities swap with a chosen player.' }
            ],
            fa: [
                { name: 'üé≠ ⁄©ÿßÿ±ÿ™ ÿ≠ÿØÿ≥ ŸÜŸÇÿ¥', description: 'ŸÜŸÇÿ¥ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØ€å⁄Øÿ±€å ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ¨ÿß€å ÿßŸà ÿ±ÿß ÿØÿ± ÿ®ÿßÿ≤€å ŸÖ€å‚Äå⁄Ø€åÿ±€åÿØ Ÿà ÿßŸà ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ.' },
                { name: 'üòµ‚Äçüí´ ⁄©ÿßÿ±ÿ™ ÿ≥ÿ±⁄Ø€åÿ¨Ÿá', description: 'ÿ®ÿ±ÿß€å €≤€¥ ÿ≥ÿßÿπÿ™: ÿØÿ± ÿ¥ÿ® ÿ®€åÿØÿßÿ± ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿØÿ± ÿ±Ÿàÿ≤ ÿµÿ≠ÿ®ÿ™ ⁄©ŸÜ€åÿØ €åÿß ÿ±ÿß€å ÿ®ÿØŸá€åÿØ.' },
                { name: 'üõ°Ô∏è ⁄©ÿßÿ±ÿ™ ÿØÿßŸÑ (ÿ≥Ÿæÿ±)', description: 'ÿ®ÿ±ÿß€å €≤€¥ ÿ≥ÿßÿπÿ™: ÿØÿ± ÿ¥ÿ® ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØ Ÿà ÿØÿ± ÿ±Ÿàÿ≤ ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØ.' },
                { name: 'üí∞ ⁄©ÿßÿ±ÿ™ ŸÖÿßŸÜ€å ÿ≥ÿß', description: 'ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß€å ÿ¥ŸÖÿß ÿ®ÿ±ÿß€å €å⁄© ÿ¥ÿ® ÿØŸà ÿ®ÿ±ÿßÿ®ÿ± ŸÖ€å‚Äåÿ¥ŸàÿØ.' },
                { name: 'ü™û ⁄©ÿßÿ±ÿ™ ÿ¢€åŸÜŸá', description: 'ŸáŸà€åÿ™ Ÿà ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß€å ÿ¥ŸÖÿß ÿ®ÿß ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßŸÜÿ™ÿÆÿßÿ®€å ÿ¨ÿßÿ®Ÿá‚Äåÿ¨ÿß ŸÖ€å‚Äåÿ¥ŸàÿØ.' }
            ]
        };

        function calculateTeamSize(playerCount) {
            // El Cl√°sico role assignment (8-13 players)
            // Standard: 3 Mafia, 1 Churchill, Rest Citizens
            
            let pablo = 1;  // Always have Pablo
            let juan = 1;   // Always have Juan
            let griselda = 0;
            let churchill = 1;  // Always have Churchill
            let bridget = 1;    // Always have Bridget
            let moreno = 1;     // Always have Moreno
            let bonaparte = 0;
            let martinez = 0;
            let chaplin = 0;
            
            // Assign additional roles based on player count
            if (playerCount >= 9) {
                bonaparte = 1;
            }
            if (playerCount >= 10) {
                chaplin = 1;
            }
            if (playerCount >= 11) {
                griselda = 1;  // 3rd Mafia
                martinez = 1;
            }
            
            const totalMafiaCount = pablo + juan + griselda;
            const totalCitizensCount = playerCount - totalMafiaCount - churchill;
            
            // Calculate simple citizens (fill remaining slots)
            const citizen = totalCitizensCount - bridget - moreno - bonaparte - martinez - chaplin;
            
            return {
                pablo: pablo,
                juan: juan,
                griselda: griselda,
                churchill: churchill,
                bridget: bridget,
                moreno: moreno,
                bonaparte: bonaparte,
                martinez: martinez,
                chaplin: chaplin,
                citizen: citizen,
                totalMafia: totalMafiaCount,
                totalCitizens: totalCitizensCount,
                totalIndependent: churchill
            };
        }

        function updatePlayerInfo() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const errorMsg = document.getElementById('errorMsg');
            
            if (!playerCount || playerCount < 8 || playerCount > 13) {
                errorMsg.textContent = currentLang === 'en' 
                    ? 'Please enter a number between 8 and 13' 
                    : 'ŸÑÿ∑ŸÅÿßŸã ÿπÿØÿØ€å ÿ®€åŸÜ €∏ ÿ™ÿß €±€≥ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            
            const teamSize = calculateTeamSize(playerCount);
            const playerInfoEl = document.getElementById('playerInfo');
            
            if (currentLang === 'en') {
                playerInfoEl.textContent = `${playerCount} Players: ${teamSize.totalMafia} Mafia ‚Ä¢ ${teamSize.totalCitizens} Citizens ‚Ä¢ ${teamSize.totalIndependent} Independent`;
            } else {
                // Convert numbers to Farsi
                const persianDigits = ['€∞', '€±', '€≤', '€≥', '€¥', '€µ', '€∂', '€∑', '€∏', '€π'];
                const toFarsi = (num) => String(num).split('').map(d => persianDigits[parseInt(d)]).join('');
                playerInfoEl.textContent = `${toFarsi(playerCount)} ÿ®ÿßÿ≤€å⁄©ŸÜ: ${toFarsi(teamSize.totalMafia)} ŸÖÿßŸÅ€åÿß - ${toFarsi(teamSize.totalCitizens)} ÿ¥Ÿáÿ±ŸàŸÜÿØ - ${toFarsi(teamSize.totalIndependent)} ŸÖÿ≥ÿ™ŸÇŸÑ`;
            }
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'fa' : 'en';
            localStorage.setItem('language', currentLang);
            updateLanguage();
        }

        function updateLanguage() {
            const t = translations[currentLang];
            document.body.className = currentLang === 'fa' ? 'rtl' : '';
            
            // Update all UI text
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('playerCountLabel').textContent = t.playerCountLabel;
            updatePlayerInfo(); // Update player info with current language
            document.getElementById('assignBtn').textContent = t.assignBtn;
            document.getElementById('howToPlayBtn').textContent = t.howToPlayBtn;
            document.getElementById('feedbackBtn').textContent = t.feedbackBtn;
            document.getElementById('newGameText').textContent = t.newGameText;
            document.getElementById('langButtonText').textContent = t.langButtonText;
            document.getElementById('helpTitle').textContent = t.helpTitle;
            document.getElementById('feedbackTitle').textContent = t.feedbackTitle;
            document.getElementById('feedbackIntro').textContent = t.feedbackIntro;
            document.getElementById('nameLabel').textContent = t.nameLabel;
            document.getElementById('emailLabel').textContent = t.emailLabel;
            document.getElementById('messageLabel').textContent = t.messageLabel;
            document.getElementById('sendBtn').textContent = t.sendBtn;
            document.getElementById('confirmTitle').textContent = t.confirmTitle;
            document.getElementById('confirmText').textContent = t.confirmText;
            document.getElementById('yesBtn').textContent = t.yesBtn;
            document.getElementById('noBtn').textContent = t.noBtn;
            
            // Update help content
            updateHelpContent();
            
            // If game is in progress, refresh the current screen
            if (playerRoles.length > 0 && !document.getElementById('gameSection').classList.contains('hidden')) {
                refreshCurrentGameScreen();
            }
        }

        function refreshCurrentGameScreen() {
            // Check if we're on the final "all assigned" screen
            if (currentPlayerIndex >= playerRoles.length) {
                showPlayerReveal();
                return;
            }
            
            // Check if role is currently revealed
            const roleRevealArea = document.getElementById('roleRevealArea');
            if (roleRevealArea && roleRevealArea.innerHTML.trim() !== '') {
                // Role is revealed, refresh it
                const roleKey = playerRoles[currentPlayerIndex];
                const role = roles[currentLang][roleKey];
                const t = translations[currentLang];
                
                let teamBadge = '';
                let teamColor = '';
                if (role.team === 'mafia') {
                    teamBadge = currentLang === 'en' ? 'üòà Mafia Team' : 'üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß';
                    teamColor = '#ee3d72';
                } else if (role.team === 'citizen') {
                    teamBadge = currentLang === 'en' ? 'üòá Citizens Team' : 'üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ';
                    teamColor = '#4facfe';
                } else if (role.team === 'independent') {
                    teamBadge = currentLang === 'en' ? 'üéØ Independent' : 'üéØ ŸÖÿ≥ÿ™ŸÇŸÑ';
                    teamColor = '#9b59b6';
                }
                
                roleRevealArea.innerHTML = `
                    <div class="role-card ${role.class}" style="margin-bottom: 20px; cursor: default;">
                        <div style="text-align: ${currentLang === 'fa' ? 'right' : 'left'};">
                            <div style="display: inline-block; background: ${teamColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; font-weight: 600;">
                                ${teamBadge}
                            </div>
                            <div class="role-name" style="font-size: 1.8em; margin-bottom: 15px;">
                                ${role.name}
                            </div>
                            <div class="role-description" style="font-size: 1.05em; line-height: 1.8;">
                                ${role.description}
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="nextPlayer()" style="margin-top: 20px;">${t.sawRoleBtn}</button>
                `;
            } else {
                // Just the instruction screen is showing, refresh it
                const instructionBox = document.getElementById('instructionBox');
                const showRoleBtn = document.getElementById('showRoleBtn');
                if (instructionBox && showRoleBtn) {
                    const t = translations[currentLang];
                    instructionBox.innerHTML = `
                        <div style="font-size: 2.5em; margin-bottom: 15px;">üë§</div>
                        <h2 style="color: #333; margin-bottom: 10px;">${t.playerLabel} ${currentPlayerIndex + 1}</h2>
                        <p style="color: #666;">${currentLang === 'en' ? 'Click the button below to see your role' : 'ÿ±Ÿà€å ÿØ⁄©ŸÖŸá ÿ≤€åÿ± ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ŸÜŸÇÿ¥ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ®€åŸÜ€åÿØ'}</p>
                    `;
                    showRoleBtn.innerHTML = t.showRoleBtn;
                }
            }
        }

        function updateHelpContent() {
            const helpContent = document.getElementById('helpContent');
            
            if (currentLang === 'en') {
                helpContent.innerHTML = `
                    <h3>üéØ Game Overview</h3>
                    <p>Mafia: El Cl√°sico is a social deduction game for 8-13 players. The game features a battle between the Black side (Mafia) and the White side (Citizens), with one Independent player (Churchill). The game is run by a narrator who manages the flow and executes all actions.</p>
                    <p><strong>Standard Setup (11 players):</strong> 3 Mafia vs 7 Citizens vs 1 Independent (Churchill)</p>
                    
                    <h3>üåô Game Flow</h3>
                    <ul>
                        <li><strong>Night Phase:</strong> Mafia shoots a victim, special roles use abilities</li>
                        <li><strong>Day Phase:</strong> Discussion and voting to eliminate suspects</li>
                        <li><strong>Exit Cards:</strong> Players eliminated by voting draw an exit card before leaving</li>
                    </ul>

                    <h3>üòà Mafia Team (2-3 members)</h3>
                    
                    <div class="role-help mafia">
                        <h4>üíä Pablo Escobar (Leader)</h4>
                        <p><strong>Shoot:</strong> Each night, mafia chooses a victim to shoot</p>
                        <p><strong>Slaughter:</strong> Can guess someone's identity and slaughter them (unstoppable kill)</p>
                        <p><strong>Immortality:</strong> Cannot be killed until someone correctly guesses his role</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üö´ Juan Velasquez</h4>
                        <p><strong>Disable:</strong> Each night, block one citizen's ability</p>
                        <p><strong>Limitation:</strong> Cannot target same person two consecutive nights</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üëó Griselda Blanco</h4>
                        <p><strong>Recruitment:</strong> If a mafia dies, convert one Simple Citizen or Chaplin to mafia</p>
                        <p><strong>Death Effect:</strong> If Griselda dies before using her ability, Pablo can do both shoot and slaughter in one night</p>
                    </div>

                    <h3>üéØ Independent (1 player)</h3>
                    
                    <div class="role-help independent">
                        <h4>üé© Churchill</h4>
                        <p><strong>Prediction:</strong> From night 2, predict who will be eliminated the next day. If correct, become immortal</p>
                        <p><strong>Slaughter:</strong> Can guess someone's identity and slaughter them</p>
                        <p><strong>Vest:</strong> Has protection on night 1</p>
                        <p><strong>Win Condition:</strong> Depends on final "Key Ace" stage composition</p>
                    </div>

                    <h3>üòá Citizens Team (5-9 members)</h3>
                    
                    <div class="role-help citizen">
                        <h4>üíâ Dr. Bridget</h4>
                        <p><strong>Save:</strong> Each night, save one person from shooting</p>
                        <p><strong>Self-Save:</strong> Can save herself twice (not consecutively, with exceptions)</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üî´ Moreno</h4>
                        <p><strong>Rifles:</strong> Has one war rifle and one practice rifle</p>
                        <p><strong>Distribution:</strong> Each night, distribute between two people (can only keep practice rifle)</p>
                        <p><strong>War Rifle Effect:</strong> Eliminates target and announces their side</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>‚≠ê General Bonaparte</h4>
                        <p><strong>Code System:</strong> Each night, set a code and select a player who wakes up and receives it</p>
                        <p><strong>Confirmation:</strong> If both alive next day, selected player is confirmed citizen</p>
                        <p><strong>Communication:</strong> Use code during the day to indicate next target</p>
                        <p><strong>Risk:</strong> If you select mafia or Churchill, you are eliminated</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üëÆ Officer Martinez</h4>
                        <p><strong>Shoot:</strong> Can shoot once. Eliminates mafia, but you die if you shoot citizen</p>
                        <p><strong>Slaughter:</strong> Has one slaughter ability (works even if disabled)</p>
                        <p><strong>Special:</strong> Shooting Churchill or Pablo eliminates no one</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üé¨ Chaplin</h4>
                        <p><strong>Protection:</strong> On night 1, select one Simple Citizen to protect from being converted by Griselda</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üë§ Simple Citizens</h4>
                        <p><strong>Role:</strong> No special abilities</p>
                        <p><strong>Importance:</strong> Discussion and voting are crucial</p>
                    </div>

                    <h3>üÉè Exit Cards</h3>
                    <p>When eliminated by voting during the day, players draw one exit card. The narrator executes the card's effect.</p>
                    
                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üé≠ Guess Role Card</h4>
                        <p>Guess another player's role. If correct, you take their place and they are eliminated.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üòµ‚Äçüí´ Dizziness Card</h4>
                        <p>For 24 hours: don't wake at night, can't speak or vote during day.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üõ°Ô∏è Shield Card</h4>
                        <p>For 24 hours: cannot be killed at night or eliminated during day.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üí∞ Money Sack Card</h4>
                        <p>Your abilities are doubled for one night.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>ü™û Mirror Card</h4>
                        <p>Your identity and abilities swap with a chosen player.</p>
                    </div>

                    <h3>üèÜ Win Conditions</h3>
                    <ul>
                        <li><strong>Mafia wins:</strong> When their numbers equal citizens</li>
                        <li><strong>Citizens win:</strong> When all mafia are eliminated</li>
                        <li><strong>Churchill wins:</strong> Reaches "Key Ace" with specific conditions met</li>
                    </ul>
                `;
            } else {
                helpContent.innerHTML = `
                    <h3>üéØ ŸÖÿπÿ±ŸÅ€å ÿ®ÿßÿ≤€å</h3>
                    <p>ŸÖÿßŸÅ€åÿß: ÿßŸÑ ⁄©ŸÑÿßÿ≥€å⁄©Ÿà €å⁄© ÿ®ÿßÿ≤€å ÿßÿ≥ÿ™ŸÜÿ™ÿßÿ¨ ÿßÿ¨ÿ™ŸÖÿßÿπ€å ÿ®ÿ±ÿß€å €∏-€±€≥ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ≥ÿ™. ÿ®ÿßÿ≤€å ÿ¥ÿßŸÖŸÑ ŸÜÿ®ÿ±ÿØ ÿ®€åŸÜ ÿ¨ÿ®ŸáŸá ÿ≥€åÿßŸá (ŸÖÿßŸÅ€åÿß) Ÿà ÿ¨ÿ®ŸáŸá ÿ≥ŸÅ€åÿØ (ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ) ÿ®ÿß €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ŸÖÿ≥ÿ™ŸÇŸÑ (⁄Üÿ±⁄Ü€åŸÑ) ÿßÿ≥ÿ™. ÿ®ÿßÿ≤€å ÿ™Ÿàÿ≥ÿ∑ €å⁄© ÿ±ÿßŸà€å ÿßÿØÿßÿ±Ÿá ŸÖ€å‚Äåÿ¥ŸàÿØ.</p>
                    <p><strong>ÿ™ÿ±⁄©€åÿ® ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ (€±€± ÿ®ÿßÿ≤€å⁄©ŸÜ):</strong> €≥ ŸÖÿßŸÅ€åÿß ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ €∑ ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ €± ŸÖÿ≥ÿ™ŸÇŸÑ (⁄Üÿ±⁄Ü€åŸÑ)</p>
                    
                    <h3>üåô ÿ±ŸàŸÜÿØ ÿ®ÿßÿ≤€å</h3>
                    <ul>
                        <li><strong>ŸÅÿßÿ≤ ÿ¥ÿ®:</strong> ŸÖÿßŸÅ€åÿß ÿ®Ÿá ŸÇÿ±ÿ®ÿßŸÜ€å ÿ¥ŸÑ€å⁄© ŸÖ€å‚Äå⁄©ŸÜÿØÿå ŸÜŸÇÿ¥‚ÄåŸáÿß€å Ÿà€å⁄òŸá ÿßÿ≤ ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß€åÿ¥ÿßŸÜ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜŸÜÿØ</li>
                        <li><strong>ŸÅÿßÿ≤ ÿ±Ÿàÿ≤:</strong> ÿ®ÿ≠ÿ´ Ÿà ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ®ÿ±ÿß€å ÿ≠ÿ∞ŸÅ ŸÖÿ∏ŸÜŸàŸÜ€åŸÜ</li>
                        <li><strong>⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿÆÿ±Ÿàÿ¨:</strong> ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸá ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ŸÇÿ®ŸÑ ÿßÿ≤ ÿÆÿ±Ÿàÿ¨ €å⁄© ⁄©ÿßÿ±ÿ™ ÿÆÿ±Ÿàÿ¨ ŸÖ€å‚Äå⁄©ÿ¥ŸÜÿØ</li>
                    </ul>

                    <h3>üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß (€≤-€≥ ÿπÿ∂Ÿà)</h3>
                    
                    <div class="role-help mafia">
                        <h4>üíä Ÿæÿßÿ®ŸÑŸà ÿßÿ≥⁄©Ÿàÿ®ÿßÿ± (ÿ±Ÿáÿ®ÿ±)</h4>
                        <p><strong>ÿ¥ŸÑ€å⁄©:</strong> Ÿáÿ± ÿ¥ÿ® ŸÖÿßŸÅ€åÿß €å⁄© ŸÇÿ±ÿ®ÿßŸÜ€å ÿ®ÿ±ÿß€å ÿ¥ŸÑ€å⁄© ÿßŸÜÿ™ÿÆÿßÿ® ŸÖ€å‚Äå⁄©ŸÜÿØ</p>
                        <p><strong>ÿ≥ŸÑÿßÿÆ€å:</strong> ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ŸáŸà€åÿ™ ⁄©ÿ≥€å ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜÿØ Ÿà ÿ≥ŸÑÿßÿÆ€å ⁄©ŸÜÿØ (⁄©ÿ¥ÿ™ŸÜ ÿ∫€åÿ±ŸÇÿßÿ®ŸÑ ŸÖÿ™ŸàŸÇŸÅ)</p>
                        <p><strong>ŸÜÿßŸÖ€åÿ±ÿß€å€å:</strong> ÿ™ÿß ÿ≤ŸÖÿßŸÜ€å ⁄©Ÿá ⁄©ÿ≥€å ŸÜŸÇÿ¥ÿ¥ ÿ±ÿß ÿØÿ±ÿ≥ÿ™ ÿ≠ÿØÿ≥ ŸÜÿ≤ŸÜÿØÿå ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üö´ ÿÆŸàÿ¢ŸÜ ŸàŸÑÿßÿ≥⁄©Ÿàÿ¶ÿ≤</h4>
                        <p><strong>ÿ∫€åÿ±ŸÅÿπÿßŸÑ‚Äåÿ≥ÿßÿ≤€å:</strong> Ÿáÿ± ÿ¥ÿ® ÿ™ŸàÿßŸÜÿß€å€å €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ±ÿß ŸÖÿ≥ÿØŸàÿØ ⁄©ŸÜÿØ</p>
                        <p><strong>ŸÖÿ≠ÿØŸàÿØ€åÿ™:</strong> ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿØŸà ÿ¥ÿ® Ÿæÿ¥ÿ™ ÿ≥ÿ± ŸáŸÖ €å⁄© ŸÜŸÅÿ± ÿ±ÿß ŸáÿØŸÅ ÿ®⁄Ø€åÿ±ÿØ</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üëó ⁄Øÿ±€åÿ≥ŸÑÿØÿß ÿ®ŸÑÿßŸÜ⁄©Ÿà</h4>
                        <p><strong>ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ:</strong> ÿß⁄Øÿ± €å⁄© ŸÖÿßŸÅ€åÿß ÿ®ŸÖ€åÿ±ÿØÿå €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá €åÿß ⁄ÜÿßŸæŸÑ€åŸÜ ÿ±ÿß ÿ®Ÿá ŸÖÿßŸÅ€åÿß ÿ™ÿ®ÿØ€åŸÑ ⁄©ŸÜÿØ</p>
                        <p><strong>ÿßÿ´ÿ± ŸÖÿ±⁄Ø:</strong> ÿß⁄Øÿ± ⁄Øÿ±€åÿ≥ŸÑÿØÿß ŸÇÿ®ŸÑ ÿßÿ≤ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿßÿ≤ ÿ™ŸàÿßŸÜÿß€å€å ÿ®ŸÖ€åÿ±ÿØÿå Ÿæÿßÿ®ŸÑŸà ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿØÿ± €å⁄© ÿ¥ÿ® ŸáŸÖ ÿ¥ŸÑ€å⁄© Ÿà ŸáŸÖ ÿ≥ŸÑÿßÿÆ€å ÿßŸÜÿ¨ÿßŸÖ ÿØŸáÿØ</p>
                    </div>

                    <h3>üéØ ŸÖÿ≥ÿ™ŸÇŸÑ (€± ÿ®ÿßÿ≤€å⁄©ŸÜ)</h3>
                    
                    <div class="role-help independent">
                        <h4>üé© ⁄Üÿ±⁄Ü€åŸÑ</h4>
                        <p><strong>Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å:</strong> ÿßÿ≤ ÿ¥ÿ® ÿØŸàŸÖÿå Ÿæ€åÿ¥‚Äåÿ®€åŸÜ€å ⁄©ŸÜ€åÿØ ⁄ÜŸá ⁄©ÿ≥€å ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ŸÜÿßŸÖ€åÿ±ÿß ŸÖ€å‚Äåÿ¥Ÿà€åÿØ</p>
                        <p><strong>ÿ≥ŸÑÿßÿÆ€å:</strong> ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ŸáŸà€åÿ™ ⁄©ÿ≥€å ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜÿØ Ÿà ÿ≥ŸÑÿßÿÆ€å ⁄©ŸÜÿØ</p>
                        <p><strong>ÿ¨ŸÑ€åŸÇŸá:</strong> ÿØÿ± ÿ¥ÿ® ÿßŸàŸÑ ŸÖÿ≠ÿßŸÅÿ∏ÿ™ ÿØÿßÿ±ÿØ</p>
                        <p><strong>ÿ¥ÿ±ÿ∑ ÿ®ÿ±ÿØ:</strong> ÿ®Ÿá ÿ™ÿ±⁄©€åÿ® ŸÜŸáÿß€å€å ŸÖÿ±ÿ≠ŸÑŸá "⁄©€å ÿ¢ÿ≥" ÿ®ÿ≥ÿ™⁄Ø€å ÿØÿßÿ±ÿØ</p>
                    </div>

                    <h3>üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ (€µ-€π ÿπÿ∂Ÿà)</h3>
                    
                    <div class="role-help citizen">
                        <h4>üíâ ÿØ⁄©ÿ™ÿ± ÿ®ÿ±€åÿ¨€åÿ™</h4>
                        <p><strong>ŸÜÿ¨ÿßÿ™:</strong> Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßÿ≤ ÿ¥ŸÑ€å⁄© ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ</p>
                        <p><strong>ÿÆŸàÿØŸÜÿ¨ÿßÿ™€å:</strong> ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿÆŸàÿØÿ¥ ÿ±ÿß ÿØŸà ÿ®ÿßÿ± ŸÜÿ¨ÿßÿ™ ÿØŸáÿØ (ŸÜŸá Ÿæÿ¥ÿ™ ÿ≥ÿ± ŸáŸÖÿå ÿ®ÿß ÿßÿ≥ÿ™ÿ´ŸÜÿßŸáÿß)</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üî´ ŸÖŸàÿ±ŸÜŸà</h4>
                        <p><strong>ÿ™ŸÅŸÜ⁄Ø‚ÄåŸáÿß:</strong> €å⁄© ÿ™ŸÅŸÜ⁄Ø ÿ¨ŸÜ⁄Ø€å Ÿà €å⁄© ÿ™ŸÅŸÜ⁄Ø ŸÖÿ¥ŸÇ€å ÿØÿßÿ±ÿØ</p>
                        <p><strong>ÿ™Ÿàÿ≤€åÿπ:</strong> Ÿáÿ± ÿ¥ÿ® ÿ®€åŸÜ ÿØŸà ŸÜŸÅÿ± ÿ™Ÿàÿ≤€åÿπ ⁄©ŸÜ€åÿØ (ŸÅŸÇÿ∑ ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ™ŸÅŸÜ⁄Ø ŸÖÿ¥ŸÇ€å ÿ±ÿß ŸÜ⁄ØŸá ÿØÿßÿ±ÿØ)</p>
                        <p><strong>ÿßÿ´ÿ± ÿ™ŸÅŸÜ⁄Ø ÿ¨ŸÜ⁄Ø€å:</strong> ŸáÿØŸÅ ÿ±ÿß ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äå⁄©ŸÜÿØ Ÿà ÿ≥ÿß€åÿØÿ¥ ÿ±ÿß ÿßÿπŸÑÿßŸÖ ŸÖ€å‚Äå⁄©ŸÜÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>‚≠ê ⁄òŸÜÿ±ÿßŸÑ ÿ®ŸÜÿßŸæÿßÿ±ÿ™</h4>
                        <p><strong>ÿ≥€åÿ≥ÿ™ŸÖ ⁄©ÿØ:</strong> Ÿáÿ± ÿ¥ÿ® €å⁄© ⁄©ÿØ ÿ®⁄Øÿ∞ÿßÿ±€åÿØ Ÿà ÿ®ÿßÿ≤€å⁄©ŸÜ€å ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ⁄©Ÿá ÿ®€åÿØÿßÿ± ÿ¥ÿØŸá Ÿà ⁄©ÿØ ÿ±ÿß ÿØÿ±€åÿßŸÅÿ™ ŸÖ€å‚Äå⁄©ŸÜÿØ</p>
                        <p><strong>ÿ™ÿ£€å€åÿØ:</strong> ÿß⁄Øÿ± Ÿáÿ± ÿØŸà ŸÅÿ±ÿØÿß ÿ≤ŸÜÿØŸá ÿ®ÿßÿ¥ŸÜÿØÿå ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßŸÜÿ™ÿÆÿßÿ® ÿ¥ÿØŸá ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ™ÿ£€å€åÿØ ÿ¥ÿØŸá ÿßÿ≥ÿ™</p>
                        <p><strong>ÿßÿ±ÿ™ÿ®ÿßÿ∑:</strong> ÿßÿ≤ ⁄©ÿØ ÿØÿ± ÿ∑ŸàŸÑ ÿ±Ÿàÿ≤ ÿ®ÿ±ÿß€å ŸÜÿ¥ÿßŸÜ ÿØÿßÿØŸÜ ŸáÿØŸÅ ÿ®ÿπÿØ€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ</p>
                        <p><strong>ÿ±€åÿ≥⁄©:</strong> ÿß⁄Øÿ± ŸÖÿßŸÅ€åÿß €åÿß ⁄Üÿ±⁄Ü€åŸÑ ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØÿå ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üëÆ ÿßŸÅÿ≥ÿ± ŸÖÿßÿ±ÿ™€åŸÜÿ≤</h4>
                        <p><strong>ÿ¥ŸÑ€å⁄©:</strong> €å⁄© ÿ®ÿßÿ± ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜÿØ. ŸÖÿßŸÅ€åÿß ÿ±ÿß ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äå⁄©ŸÜÿØÿå ÿßŸÖÿß ÿß⁄Øÿ± ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜÿØ ŸÖ€å‚ÄåŸÖ€åÿ±ÿØ</p>
                        <p><strong>ÿ≥ŸÑÿßÿÆ€å:</strong> €å⁄© ÿ™ŸàÿßŸÜÿß€å€å ÿ≥ŸÑÿßÿÆ€å ÿØÿßÿ±ÿØ (ÿ≠ÿ™€å ÿß⁄Øÿ± ÿ∫€åÿ±ŸÅÿπÿßŸÑ ÿ¥ŸàÿØ ⁄©ÿßÿ± ŸÖ€å‚Äå⁄©ŸÜÿØ)</p>
                        <p><strong>Ÿà€å⁄òŸá:</strong> ÿ¥ŸÑ€å⁄© ÿ®Ÿá ⁄Üÿ±⁄Ü€åŸÑ €åÿß Ÿæÿßÿ®ŸÑŸà Ÿá€å⁄Ü‚Äå⁄©ÿ≥ ÿ±ÿß ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äå⁄©ŸÜÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üé¨ ⁄ÜÿßŸæŸÑ€åŸÜ</h4>
                        <p><strong>ŸÖÿ≠ÿßŸÅÿ∏ÿ™:</strong> ÿØÿ± ÿ¥ÿ® ÿßŸàŸÑÿå €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ÿ™ÿß ÿßÿ≤ ÿ™ÿ®ÿØ€åŸÑ ÿ™Ÿàÿ≥ÿ∑ ⁄Øÿ±€åÿ≥ŸÑÿØÿß ŸÖÿ≠ÿßŸÅÿ∏ÿ™ ÿ¥ŸàÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üë§ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿ≥ÿßÿØŸá</h4>
                        <p><strong>ŸÜŸÇÿ¥:</strong> ÿ™ŸàÿßŸÜÿß€å€å ÿÆÿßÿµ€å ŸÜÿØÿßÿ±ŸÜÿØ</p>
                        <p><strong>ÿßŸáŸÖ€åÿ™:</strong> ÿ®ÿ≠ÿ´ Ÿà ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ®ÿ≥€åÿßÿ± ŸÖŸáŸÖ Ÿáÿ≥ÿ™ŸÜÿØ</p>
                    </div>

                    <h3>üÉè ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿÆÿ±Ÿàÿ¨</h3>
                    <p>ŸàŸÇÿ™€å ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿØÿ± ÿ∑ŸàŸÑ ÿ±Ÿàÿ≤ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå €å⁄© ⁄©ÿßÿ±ÿ™ ÿÆÿ±Ÿàÿ¨ ŸÖ€å‚Äå⁄©ÿ¥€åÿØ. ÿ±ÿßŸà€å ÿßÿ´ÿ± ⁄©ÿßÿ±ÿ™ ÿ±ÿß ÿßÿ¨ÿ±ÿß ŸÖ€å‚Äå⁄©ŸÜÿØ.</p>
                    
                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üé≠ ⁄©ÿßÿ±ÿ™ ÿ≠ÿØÿ≥ ŸÜŸÇÿ¥</h4>
                        <p>ŸÜŸÇÿ¥ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØ€å⁄Øÿ±€å ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ¨ÿß€å ÿßŸà ÿ±ÿß ŸÖ€å‚Äå⁄Ø€åÿ±€åÿØ Ÿà ÿßŸà ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üòµ‚Äçüí´ ⁄©ÿßÿ±ÿ™ ÿ≥ÿ±⁄Ø€åÿ¨Ÿá</h4>
                        <p>ÿ®ÿ±ÿß€å €≤€¥ ÿ≥ÿßÿπÿ™: ÿØÿ± ÿ¥ÿ® ÿ®€åÿØÿßÿ± ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿØÿ± ÿ±Ÿàÿ≤ ÿµÿ≠ÿ®ÿ™ ⁄©ŸÜ€åÿØ €åÿß ÿ±ÿß€å ÿ®ÿØŸá€åÿØ.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üõ°Ô∏è ⁄©ÿßÿ±ÿ™ ÿØÿßŸÑ (ÿ≥Ÿæÿ±)</h4>
                        <p>ÿ®ÿ±ÿß€å €≤€¥ ÿ≥ÿßÿπÿ™: ÿØÿ± ÿ¥ÿ® ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØ Ÿà ÿØÿ± ÿ±Ÿàÿ≤ ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØ.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üí∞ ⁄©ÿßÿ±ÿ™ ŸÖÿßŸÜ€å ÿ≥ÿß</h4>
                        <p>ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß€å ÿ¥ŸÖÿß ÿ®ÿ±ÿß€å €å⁄© ÿ¥ÿ® ÿØŸà ÿ®ÿ±ÿßÿ®ÿ± ŸÖ€å‚Äåÿ¥ŸàÿØ.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>ü™û ⁄©ÿßÿ±ÿ™ ÿ¢€åŸÜŸá</h4>
                        <p>ŸáŸà€åÿ™ Ÿà ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß€å ÿ¥ŸÖÿß ÿ®ÿß ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßŸÜÿ™ÿÆÿßÿ®€å ÿ¨ÿßÿ®Ÿá‚Äåÿ¨ÿß ŸÖ€å‚Äåÿ¥ŸàÿØ.</p>
                    </div>

                    <h3>üèÜ ÿ¥ÿ±ÿß€åÿ∑ Ÿæ€åÿ±Ÿàÿ≤€å</h3>
                    <ul>
                        <li><strong>ŸÖÿßŸÅ€åÿß ÿ®ÿ±ŸÜÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ:</strong> ŸàŸÇÿ™€å ÿ™ÿπÿØÿßÿØ ÿ¢ŸÜ‚ÄåŸáÿß ÿ®ÿß ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿ®ÿ±ÿßÿ®ÿ± ÿ¥ŸàÿØ</li>
                        <li><strong>ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿ®ÿ±ŸÜÿØŸá ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ:</strong> ŸàŸÇÿ™€å ÿ™ŸÖÿßŸÖ ŸÖÿßŸÅ€åÿßŸáÿß ÿ≠ÿ∞ŸÅ ÿ¥ŸàŸÜÿØ</li>
                        <li><strong>⁄Üÿ±⁄Ü€åŸÑ ÿ®ÿ±ŸÜÿØŸá ŸÖ€å‚Äåÿ¥ŸàÿØ:</strong> ÿ®Ÿá "⁄©€å ÿ¢ÿ≥" ÿ®ÿß ÿ¥ÿ±ÿß€åÿ∑ ÿÆÿßÿµ ÿ®ÿ±ÿ≥ÿØ</li>
                    </ul>
                `;
            }
        }

        function startGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const errorMsg = document.getElementById('errorMsg');
            
            if (!playerCount || playerCount < 8 || playerCount > 13) {
                errorMsg.textContent = currentLang === 'en' 
                    ? 'Please enter a number between 8 and 13' 
                    : 'ŸÑÿ∑ŸÅÿßŸã ÿπÿØÿØ€å ÿ®€åŸÜ €∏ ÿ™ÿß €±€≥ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            
            const teamSize = calculateTeamSize(playerCount);
            
            // Create role array based on calculated team sizes
            let roleArray = [];
            
            // Add Mafia roles
            for (let i = 0; i < teamSize.pablo; i++) roleArray.push('pablo');
            for (let i = 0; i < teamSize.juan; i++) roleArray.push('juan');
            for (let i = 0; i < teamSize.griselda; i++) roleArray.push('griselda');
            
            // Add Citizen roles
            for (let i = 0; i < teamSize.bridget; i++) roleArray.push('bridget');
            for (let i = 0; i < teamSize.moreno; i++) roleArray.push('moreno');
            for (let i = 0; i < teamSize.bonaparte; i++) roleArray.push('bonaparte');
            for (let i = 0; i < teamSize.martinez; i++) roleArray.push('martinez');
            for (let i = 0; i < teamSize.chaplin; i++) roleArray.push('chaplin');
            for (let i = 0; i < teamSize.citizen; i++) roleArray.push('citizen');
            
            // Add Independent role
            for (let i = 0; i < teamSize.churchill; i++) roleArray.push('churchill');
            
            // Shuffle and assign
            playerRoles = shuffleArray(roleArray);
            currentPlayerIndex = 0;
            
            // Initialize card deck
            availableCards = [...cardDeck[currentLang]];
            drawnCard = null;
            
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('gameSection').classList.remove('hidden');
            
            // Hide back-to-home button during game
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
            
            showPlayerReveal();
        }

        function showPlayerReveal() {
            const rolesContainer = document.getElementById('rolesContainer');
            const newGameBtn = document.getElementById('newGameBtn');
            const t = translations[currentLang];
            
            if (currentPlayerIndex >= playerRoles.length) {
                if (!gameCountIncremented) {
                    incrementGlobalCounter();
                    gameCountIncremented = true;
                }
                
                const cardsLeft = availableCards.length;
                const cardDisplay = drawnCard ? `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                        <h3 style="margin: 0 0 10px 0; color: white;">${t.cardDrawn}</h3>
                        <p style="font-size: 1.3em; font-weight: 700; margin: 10px 0; color: white;">${drawnCard.name}</p>
                        <p style="margin: 10px 0 0 0; opacity: 0.95; color: white;">${drawnCard.description}</p>
                    </div>
                ` : '';
                
                rolesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üéâ</div>
                        <h2 style="color: #333; margin-bottom: 15px;">${t.allAssigned}</h2>
                        <p style="color: #666; font-size: 1.1em; margin-bottom: 30px;">${t.gameBegin}</p>
                        
                        <div style="margin-top: 30px;">
                            ${cardDisplay}
                            <button class="btn btn-secondary" onclick="drawCard()" id="drawCardBtn" ${cardsLeft === 0 ? 'disabled' : ''} style="${cardsLeft === 0 ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
                                ${cardsLeft > 0 ? t.drawCard + ` (${cardsLeft} ${t.cardsRemaining})` : t.noCardsLeft}
                            </button>
                        </div>
                    </div>
                `;
                newGameBtn.classList.remove('hidden');
                return;
            }
            
            newGameBtn.classList.add('hidden');
            
            rolesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div id="instructionBox" style="background: #f8f9fa; border-radius: 15px; padding: 30px; margin-bottom: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 15px;">üë§</div>
                        <h2 style="color: #333; margin-bottom: 10px;">${t.playerLabel} ${currentPlayerIndex + 1}</h2>
                        <p style="color: #666;">${currentLang === 'en' ? 'Click the button below to see your role' : 'ÿ±Ÿà€å ÿØ⁄©ŸÖŸá ÿ≤€åÿ± ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ŸÜŸÇÿ¥ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ®€åŸÜ€åÿØ'}</p>
                    </div>
                    
                    <div id="roleRevealArea"></div>
                    
                    <button class="btn" id="showRoleBtn" onclick="revealRole()">${t.showRoleBtn}</button>
                </div>
            `;
        }

        function revealRole() {
            document.getElementById('instructionBox').style.display = 'none';
            document.getElementById('showRoleBtn').style.display = 'none';
            
            const roleKey = playerRoles[currentPlayerIndex];
            const role = roles[currentLang][roleKey];
            const t = translations[currentLang];
            
            let teamBadge = '';
            let teamColor = '';
            if (role.team === 'mafia') {
                teamBadge = currentLang === 'en' ? 'üòà Mafia Team' : 'üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß';
                teamColor = '#ee3d72';
            } else if (role.team === 'citizen') {
                teamBadge = currentLang === 'en' ? 'üòá Citizens Team' : 'üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ';
                teamColor = '#4facfe';
            } else if (role.team === 'independent') {
                teamBadge = currentLang === 'en' ? 'üéØ Independent' : 'üéØ ŸÖÿ≥ÿ™ŸÇŸÑ';
                teamColor = '#9b59b6';
            }
            
            const roleRevealArea = document.getElementById('roleRevealArea');
            roleRevealArea.innerHTML = `
                <div class="role-card ${role.class}" style="margin-bottom: 20px; cursor: default;">
                    <div style="text-align: ${currentLang === 'fa' ? 'right' : 'left'};">
                        <div style="display: inline-block; background: ${teamColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; font-weight: 600;">
                            ${teamBadge}
                        </div>
                        <div class="role-name" style="font-size: 1.8em; margin-bottom: 15px;">
                            ${role.name}
                        </div>
                        <div class="role-description" style="font-size: 1.05em; line-height: 1.8;">
                            ${role.description}
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="nextPlayer()" style="margin-top: 20px;">${t.sawRoleBtn}</button>
            `;
        }

        function nextPlayer() {
            currentPlayerIndex++;
            showPlayerReveal();
        }

        function drawCard() {
            if (availableCards.length === 0) {
                return; // No cards left
            }
            
            // Draw a random card
            const randomIndex = Math.floor(Math.random() * availableCards.length);
            drawnCard = availableCards[randomIndex];
            
            // Remove the drawn card from available cards
            availableCards.splice(randomIndex, 1);
            
            // Refresh the display
            showPlayerReveal();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function resetGame() {
            currentPlayerIndex = 0;
            playerRoles = [];
            gameCountIncremented = false;
            availableCards = [];
            drawnCard = null;
            document.getElementById('setupSection').classList.remove('hidden');
            document.getElementById('gameSection').classList.add('hidden');
            document.getElementById('rolesContainer').innerHTML = '';
            document.getElementById('newGameBtn').classList.add('hidden');
            
            // Show back-to-home button when returning to setup
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
        }

        function cancelGame() {
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        function confirmCancel() {
            closeConfirm();
            resetGame();
        }

        function closeConfirm() {
            document.getElementById('confirmModal').classList.add('hidden');
        }

        function showHelp() {
            document.getElementById('helpModal').classList.remove('hidden');
            // Hide back-to-home button when showing help
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.add('hidden');
            // Show back-to-home button when closing help
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
        }

        function showFeedback() {
            document.getElementById('feedbackModal').classList.remove('hidden');
            // Hide back-to-home button when showing feedback
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').classList.add('hidden');
            // Show back-to-home button when closing feedback
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
            setTimeout(() => {
                document.getElementById('feedbackForm').reset();
                document.getElementById('feedbackStatus').classList.add('hidden');
            }, 300);
        }

        function updateGlobalCounter() {
            if (!database) {
                const t = translations[currentLang];
                document.getElementById('gameCounter').textContent = t.gamesPlayed + ' ' + (currentLang === 'en' ? 'Setup Required' : 'ŸÜ€åÿßÿ≤ ÿ®Ÿá ÿ™ŸÜÿ∏€åŸÖ');
                return;
            }

            const counterRef = database.ref('elclasicoGameCounter');
            counterRef.on('value', (snapshot) => {
                const count = snapshot.val() || 0;
                const t = translations[currentLang];
                document.getElementById('gameCounter').textContent = t.gamesPlayed + ' ' + count.toLocaleString(currentLang === 'fa' ? 'fa-IR' : 'en-US');
            });
        }

        function incrementGlobalCounter() {
            if (!database) return;

            const counterRef = database.ref('elclasicoGameCounter');
            counterRef.transaction((currentValue) => {
                return (currentValue || 0) + 1;
            });
        }

        function submitFeedback(event) {
            event.preventDefault();
            
            const name = document.getElementById('feedbackName').value.trim();
            const email = document.getElementById('feedbackEmail').value.trim();
            const message = document.getElementById('feedbackMessage').value.trim();
            const submitBtn = document.getElementById('submitFeedbackBtn');
            const statusEl = document.getElementById('feedbackStatus');
            
            if (!message) {
                statusEl.textContent = currentLang === 'en' ? '‚ö†Ô∏è Please enter a message' : '‚ö†Ô∏è ŸÑÿ∑ŸÅÿßŸã Ÿæ€åÿßŸÖ€å Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                statusEl.style.background = '#fff3cd';
                statusEl.style.color = '#856404';
                statusEl.classList.remove('hidden');
                return;
            }
            
            submitBtn.disabled = true;
            const sendingText = currentLang === 'en' ? 'üì§ Sending...' : 'üì§ ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ...';
            submitBtn.querySelector('span').textContent = sendingText;
            
            if (database) {
                const counterRef = database.ref('elclasicoFeedbackCounter');
                counterRef.transaction((currentValue) => {
                    return (currentValue || 0) + 1;
                }).then((result) => {
                    const feedbackNumber = result.snapshot.val();
                    
                    const feedbackRef = database.ref('elclasicoFeedback');
                    return feedbackRef.push({
                        number: feedbackNumber,
                        name: name || 'Anonymous',
                        email: email || 'Not provided',
                        message: message,
                        language: currentLang,
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleString()
                    }).then(() => feedbackNumber);
                })
                .then((feedbackNumber) => {
                    if (EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
                        emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                            feedback_number: feedbackNumber,
                            from_name: name || 'Anonymous',
                            from_email: email || 'Not provided',
                            message: message + '\n\nGame: El Cl√°sico\nLanguage: ' + currentLang,
                            to_email: 'contact.ehm@gmail.com'
                        }).catch((error) => {
                            console.error('EmailJS error:', error);
                        });
                    }
                    
                    statusEl.textContent = currentLang === 'en' ? '‚úÖ Thank you! Your feedback has been sent successfully!' : '‚úÖ ŸÖÿ™ÿ¥⁄©ÿ±€åŸÖ! ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ ÿ¥ŸÖÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ!';
                    statusEl.style.background = '#d4edda';
                    statusEl.style.color = '#155724';
                    statusEl.classList.remove('hidden');
                    
                    document.getElementById('feedbackForm').reset();
                    
                    setTimeout(() => {
                        closeFeedback();
                    }, 2000);
                })
                .catch((error) => {
                    console.error('Error submitting feedback:', error);
                    statusEl.textContent = currentLang === 'en' ? '‚ùå Error sending feedback. Please try again.' : '‚ùå ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.';
                    statusEl.style.background = '#f8d7da';
                    statusEl.style.color = '#721c24';
                    statusEl.classList.remove('hidden');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.querySelector('span').textContent = translations[currentLang].sendBtn;
                });
            } else {
                statusEl.textContent = currentLang === 'en' ? '‚ùå Firebase not configured.' : '‚ùå Firebase Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™.';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
                statusEl.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.querySelector('span').textContent = translations[currentLang].sendBtn;
            }
        }

        // Close modals when clicking outside
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('helpModal').addEventListener('click', function(e) {
                if (e.target === this) closeHelp();
            });
            
            document.getElementById('feedbackModal').addEventListener('click', function(e) {
                if (e.target === this) closeFeedback();
            });
            
            document.getElementById('confirmModal').addEventListener('click', function(e) {
                if (e.target === this) closeConfirm();
            });

            // Initialize
            updateLanguage();
            updateGlobalCounter();
        });
    </script>
</body>
</html>

