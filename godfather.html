<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mafia: Godfather - Role Assigner</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2d3561 0%, #3e2753 50%, #4a2c5e 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* RTL Support for Farsi */
        body.rtl {
            direction: rtl;
            font-family: Tahoma, 'Segoe UI', Arial, sans-serif;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            padding: 30px;
            animation: fadeIn 0.5s ease-in;
            position: relative;
            margin-top: 80px;
        }

        .back-home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 2000;
            cursor: pointer;
        }

        .back-home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Language Toggle Button */
        .language-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            z-index: 4000;
        }

        .language-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        h1 {
            text-align: center;
            color: #1a1a2e;
            margin-bottom: 40px;
            font-size: 2em;
            margin-top: 20px;
            position: relative;
            padding-bottom: 20px;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 2px;
            background: linear-gradient(90deg, #e94560 0%, #f093fb 50%, #e94560 100%);
            border-radius: 1px;
            box-shadow: 0 2px 10px rgba(233, 69, 96, 0.3);
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .info-badge {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 2px solid #dee2e6;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-align: center;
            margin-bottom: 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(245, 87, 108, 0.4);
        }

        .roles-section {
            margin-top: 30px;
        }

        .role-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        body.rtl .role-card {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .role-card:hover {
            transform: translateX(5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        body.rtl .role-card:hover {
            transform: translateX(-5px);
        }

        .role-card.mafia {
            border-left-color: #f5576c;
        }

        body.rtl .role-card.mafia {
            border-right-color: #f5576c;
        }

        .role-card.citizen {
            border-left-color: #4facfe;
        }

        body.rtl .role-card.citizen {
            border-right-color: #4facfe;
        }

        .role-card.independent {
            border-left-color: #8b5cf6;
        }

        body.rtl .role-card.independent {
            border-right-color: #8b5cf6;
        }

        .player-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: 700;
            margin-right: 15px;
        }

        body.rtl .player-number {
            margin-right: 0;
            margin-left: 15px;
        }

        .role-card.mafia .player-number {
            background: #f5576c;
        }

        .role-card.citizen .player-number {
            background: #4facfe;
        }

        .role-card.independent .player-number {
            background: #8b5cf6;
        }

        .role-name {
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .role-description {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
            line-height: 1.6;
        }

        .close-game-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f5576c;
            color: white;
            border: none;
            border-radius: 20px;
            width: 70px;
            height: 36px;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(245, 87, 108, 0.3);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-game-btn:hover {
            background: #e04560;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.5);
        }

        #gameCounter {
            margin-top: 20px;
            font-size: 0.9em;
            color: #888;
            text-align: center;
            padding: 10px;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
            overflow-y: auto;
        }

        .hidden {
            display: none !important;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideDown 0.3s ease;
            margin-top: 50px;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-header h2 {
            margin: 0;
            color: white;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-body h3 {
            color: #1a1a2e;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .modal-body h3:first-child {
            margin-top: 0;
        }

        .modal-body h4 {
            color: #333;
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .modal-body p {
            color: #666;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .modal-body ul {
            color: #666;
            line-height: 2;
            padding-left: 25px;
            margin-bottom: 15px;
        }

        body.rtl .modal-body ul {
            padding-left: 0;
            padding-right: 25px;
        }

        .role-help {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #667eea;
        }

        body.rtl .role-help {
            border-left: none;
            border-right: 5px solid #667eea;
        }

        .role-help.mafia {
            border-left-color: #f5576c;
        }

        body.rtl .role-help.mafia {
            border-right-color: #f5576c;
        }

        .role-help.citizen {
            border-left-color: #4facfe;
        }

        body.rtl .role-help.citizen {
            border-right-color: #4facfe;
        }

        .role-help.independent {
            border-left-color: #8b5cf6;
        }

        body.rtl .role-help.independent {
            border-right-color: #8b5cf6;
        }

        .team-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .team-badge.mafia {
            background: #f5576c;
            color: white;
        }

        .team-badge.citizen {
            background: #4facfe;
            color: white;
        }

        .team-badge.independent {
            background: #8b5cf6;
            color: white;
        }

        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin-top: 70px;
            }

            h1 {
                font-size: 1.5em;
            }

            .language-toggle,
            .back-home-btn {
                padding: 8px 15px;
                font-size: 0.8em;
                top: 15px;
            }

            .language-toggle {
                right: 15px;
            }

            .back-home-btn {
                left: 15px;
            }

            .close-game-btn {
                width: 60px;
                height: 32px;
                font-size: 1.1em;
            }

            .close-btn {
                width: 36px;
                height: 36px;
                font-size: 1.3em;
            }

            .modal-body {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Global Language Toggle (Fixed Position) -->
    <button class="language-toggle" onclick="toggleLanguage()">
        <span id="langButtonText">ŸÅÿßÿ±ÿ≥€å</span>
    </button>

    <!-- Back to Home Button (Fixed Position) -->
    <a href="index.html" class="back-home-btn">
        <span>üè†</span>
        <span id="backHomeText">Back to Home</span>
    </a>

    <div class="container">
        <div id="setupSection">
            <h1 id="mainTitle">üé≠ Mafia: Godfather üî±</h1>

            <div class="input-section" style="margin-bottom: 20px;">
                <label for="playerCount" style="display: block; color: #333; margin-bottom: 10px; font-weight: 600; font-size: 1.1em;">
                    <span id="playerCountLabel">Number of Players (6-15):</span>
                </label>
                <input type="number" id="playerCount" min="6" max="15" value="11" placeholder="Enter number of players"
                       style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1.1em; transition: all 0.3s ease;"
                       oninput="updatePlayerInfo()"
                       onfocus="this.style.borderColor='#e94560'; this.style.boxShadow='0 0 0 3px rgba(233, 69, 96, 0.1)';"
                       onblur="this.style.borderColor='#e0e0e0'; this.style.boxShadow='none';">
                <p class="error hidden" id="errorMsg" style="color: #ee3d72; font-size: 0.9em; margin-top: 10px; text-align: center;"></p>
            </div>

            <div class="info-badge" id="playerInfo">
                11 Players: 3 Mafia ‚Ä¢ 7 Citizens ‚Ä¢ 1 Independent
            </div>

            <button class="btn" onclick="startGame()">
                <span id="assignBtn">üé≤ Assign Roles</span>
            </button>
            <button class="btn btn-secondary" onclick="showHelp()">
                <span id="howToPlayBtn">üìñ How to Play</span>
            </button>
            <button class="btn btn-secondary" onclick="showFeedback()">
                <span id="feedbackBtn">üí¨ Feedback</span>
            </button>
            <div id="gameCounter">Games Played Worldwide: Loading...</div>
        </div>

        <div id="gameSection" class="hidden">
            <button class="close-game-btn" onclick="cancelGame()" title="Cancel and start over">‚úï</button>
            
            <div class="roles-section">
                <div id="rolesContainer"></div>
            </div>

            <button class="btn btn-secondary hidden" id="newGameBtn" onclick="resetGame()">
                <span id="newGameText">üîÑ New Game</span>
            </button>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="helpTitle">üìñ How to Play - Mafia: Godfather</h2>
                <button class="close-btn" onclick="closeHelp()">‚úï</button>
            </div>
            <div class="modal-body" id="helpContent">
                <!-- Content will be populated by JavaScript based on language -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="feedbackTitle">üí¨ Send Feedback</h2>
                <button class="close-btn" onclick="closeFeedback()">‚úï</button>
            </div>
            <div class="modal-body">
                <p id="feedbackIntro" style="color: #666; margin-bottom: 20px;">Have questions, suggestions, or ideas to improve the game? We'd love to hear from you!</p>
                
                <form id="feedbackForm" onsubmit="submitFeedback(event)">
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackName" id="nameLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Name (Optional)</label>
                        <input type="text" id="feedbackName" placeholder="Your name" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackEmail" id="emailLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Email (Optional)</label>
                        <input type="email" id="feedbackEmail" placeholder="your.email@example.com" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label for="feedbackMessage" id="messageLabel" style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Message *</label>
                        <textarea id="feedbackMessage" required placeholder="Share your thoughts..." 
                                  style="width: 100%; min-height: 150px; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <p id="feedbackStatus" class="hidden" style="padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-weight: 600;"></p>
                    
                    <button type="submit" class="btn" id="submitFeedbackBtn">
                        <span id="sendBtn">üì§ Send Feedback</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 id="confirmTitle" style="font-size: 1.3em;">‚ö†Ô∏è Cancel Game?</h2>
            </div>
            <div class="modal-body">
                <p id="confirmText" style="font-size: 1.1em; text-align: center; margin-bottom: 20px;">
                    Are you sure you want to cancel this game and start over?
                </p>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" style="flex: 1;" onclick="confirmCancel()">
                        <span id="yesBtn">Yes, Cancel</span>
                    </button>
                    <button class="btn btn-secondary" style="flex: 1;" onclick="closeConfirm()">
                        <span id="noBtn">No, Continue</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBSTuzqrJ0ik2CTfKq0GOc7lEVUYtxCX0E",
            authDomain: "spy-game-12f96.firebaseapp.com",
            databaseURL: "https://spy-game-12f96-default-rtdb.firebaseio.com",
            projectId: "spy-game-12f96",
            storageBucket: "spy-game-12f96.firebasestorage.app",
            messagingSenderId: "22301781663",
            appId: "1:22301781663:web:23f31448a872e41203fcaa",
            measurementId: "G-DE4QRR88RH"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        const EMAILJS_PUBLIC_KEY = 'qw_grGhV3it_4-RwE';
        const EMAILJS_SERVICE_ID = 'service_f65c74d';
        const EMAILJS_TEMPLATE_ID = 'template_gna5het';
        
        try {
            emailjs.init(EMAILJS_PUBLIC_KEY);
        } catch (error) {
            console.error("EmailJS initialization error:", error);
        }

        // Language System
        let currentLang = localStorage.getItem('language') || 'fa';

        const translations = {
            en: {
                mainTitle: 'üé≠ Mafia: Godfather üî±',
                playerCountLabel: 'Number of Players (6-15):',
                playerInfo: '11 Players: 3 Mafia ‚Ä¢ 7 Citizens ‚Ä¢ 1 Independent',
                assignBtn: 'üé≤ Assign Roles',
                howToPlayBtn: 'üìñ How to Play',
                feedbackBtn: 'üí¨ Feedback',
                newGameText: 'üîÑ New Game',
                langButtonText: 'ŸÅÿßÿ±ÿ≥€å',
                helpTitle: 'üìñ How to Play - Mafia: Godfather',
                feedbackTitle: 'üí¨ Send Feedback',
                feedbackIntro: 'Have questions, suggestions, or ideas to improve the game? We\'d love to hear from you!',
                nameLabel: 'Name (Optional)',
                emailLabel: 'Email (Optional)',
                messageLabel: 'Message *',
                sendBtn: 'üì§ Send Feedback',
                confirmTitle: '‚ö†Ô∏è Cancel Game?',
                confirmText: 'Are you sure you want to cancel this game and start over?',
                yesBtn: 'Yes, Cancel',
                noBtn: 'No, Continue',
                playerLabel: 'Player',
                showRoleBtn: 'üé≠ Show My Role',
                sawRoleBtn: '‚úÖ I Saw My Role',
                allAssigned: 'All Roles Assigned!',
                gameBegin: 'The game can now begin. Good luck!',
                gamesPlayed: 'Games Played Worldwide:',
                drawCard: 'üÉè Draw Card',
                cardDrawn: 'Card Drawn:',
                noCardsLeft: 'No cards left!',
                cardsRemaining: 'cards remaining'
            },
            fa: {
                mainTitle: 'üé≠ ŸÖÿßŸÅ€åÿß: ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá üî±',
                playerCountLabel: 'ÿ™ÿπÿØÿßÿØ ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ (€∂-€±€µ):',
                playerInfo: '€±€± ÿ®ÿßÿ≤€å⁄©ŸÜ: €≥ ŸÖÿßŸÅ€åÿß - €∑ ÿ¥Ÿáÿ±ŸàŸÜÿØ - €± ŸÖÿ≥ÿ™ŸÇŸÑ',
                assignBtn: 'üé≤ ÿ™ÿÆÿµ€åÿµ ŸÜŸÇÿ¥‚ÄåŸáÿß',
                howToPlayBtn: 'üìñ ÿ¢ŸÖŸàÿ≤ÿ¥ ÿ®ÿßÿ≤€å',
                feedbackBtn: 'üí¨ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                newGameText: 'üîÑ ÿ®ÿßÿ≤€å ÿ¨ÿØ€åÿØ',
                langButtonText: 'English',
                helpTitle: 'üìñ ÿ¢ŸÖŸàÿ≤ÿ¥ ÿ®ÿßÿ≤€å - ŸÖÿßŸÅ€åÿß: ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá',
                feedbackTitle: 'üí¨ ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                feedbackIntro: 'ÿ≥ŸàÿßŸÑÿå Ÿæ€åÿ¥ŸÜŸáÿßÿØ €åÿß ÿß€åÿØŸá‚Äåÿß€å ÿ®ÿ±ÿß€å ÿ®Ÿáÿ®ŸàÿØ ÿ®ÿßÿ≤€å ÿØÿßÿ±€åÿØÿü ÿÆŸàÿ¥ÿ≠ÿßŸÑ ŸÖ€å‚Äåÿ¥Ÿà€åŸÖ ŸÜÿ∏ÿ±ÿ™ÿßŸÜ ÿ±ÿß ÿ®ÿ¥ŸÜŸà€åŸÖ!',
                nameLabel: 'ŸÜÿßŸÖ (ÿßÿÆÿ™€åÿßÿ±€å)',
                emailLabel: 'ÿß€åŸÖ€åŸÑ (ÿßÿÆÿ™€åÿßÿ±€å)',
                messageLabel: 'Ÿæ€åÿßŸÖ *',
                sendBtn: 'üì§ ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ',
                confirmTitle: '‚ö†Ô∏è ŸÑÿ∫Ÿà ÿ®ÿßÿ≤€åÿü',
                confirmText: 'ÿ¢€åÿß ŸÖÿ∑ŸÖÿ¶ŸÜ Ÿáÿ≥ÿ™€åÿØ ⁄©Ÿá ŸÖ€å‚ÄåÿÆŸàÿßŸá€åÿØ ÿß€åŸÜ ÿ®ÿßÿ≤€å ÿ±ÿß ŸÑÿ∫Ÿà ⁄©ŸÜ€åÿØ Ÿà ÿßÿ≤ ŸÜŸà ÿ¥ÿ±Ÿàÿπ ⁄©ŸÜ€åÿØÿü',
                yesBtn: 'ÿ®ŸÑŸáÿå ŸÑÿ∫Ÿà ⁄©ŸÜ',
                noBtn: 'ÿÆ€åÿ±ÿå ÿßÿØÿßŸÖŸá ÿ®ÿØŸá',
                playerLabel: 'ÿ®ÿßÿ≤€å⁄©ŸÜ',
                showRoleBtn: 'üé≠ ŸÜŸÖÿß€åÿ¥ ŸÜŸÇÿ¥ ŸÖŸÜ',
                sawRoleBtn: '‚úÖ ŸÜŸÇÿ¥ŸÖ ÿ±ÿß ÿØ€åÿØŸÖ',
                allAssigned: 'ŸáŸÖŸá ŸÜŸÇÿ¥‚ÄåŸáÿß ÿ™ÿÆÿµ€åÿµ ÿØÿßÿØŸá ÿ¥ÿØ!',
                gameBegin: 'ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ÿ±Ÿàÿπ ÿ¥ŸàÿØ. ŸÖŸàŸÅŸÇ ÿ®ÿßÿ¥€åÿØ!',
                gamesPlayed: 'ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å ÿßŸÜÿ¨ÿßŸÖ ÿ¥ÿØŸá ÿØÿ± ÿ≥ÿ±ÿßÿ≥ÿ± ÿ¨ŸáÿßŸÜ:',
                drawCard: 'üÉè ⁄©ÿ¥€åÿØŸÜ ⁄©ÿßÿ±ÿ™',
                cardDrawn: '⁄©ÿßÿ±ÿ™ ⁄©ÿ¥€åÿØŸá ÿ¥ÿØŸá:',
                noCardsLeft: '⁄©ÿßÿ±ÿ™€å ÿ®ÿßŸÇ€å ŸÜŸÖÿßŸÜÿØŸá!',
                cardsRemaining: '⁄©ÿßÿ±ÿ™ ÿ®ÿßŸÇ€å‚ÄåŸÖÿßŸÜÿØŸá'
            }
        };

        // Role definitions
        const roles = {
            en: {
                godfather: {
                    name: 'The Godfather',
                    team: 'mafia',
                    description: 'You are the Godfather, the main leader of the Mafia. You have a vest (survives first shot). You have "Sixth Sense" ability: point to a player and guess their exact role - if correct, they are eliminated the next morning regardless of protection.',
                    class: 'mafia'
                },
                matador: {
                    name: 'Matador',
                    team: 'mafia',
                    description: 'You are the Matador. Each night, you can block one player\'s ability (roleblock). You cannot block the same person consecutively, but can repeat with a one-night gap.',
                    class: 'mafia'
                },
                saul: {
                    name: 'Saul Goodman',
                    team: 'mafia',
                    description: 'You are Saul Goodman. When a mafia teammate dies, you can once recruit a Simple Citizen to become mafia. Point to someone - if they are a Simple Citizen, they join the mafia team from that night.',
                    class: 'mafia'
                },
                watson: {
                    name: 'Dr. Watson',
                    team: 'citizen',
                    description: 'You are Dr. Watson. Each night, save one person from attacks. You can save yourself only once. You can save others unlimited times.',
                    class: 'citizen'
                },
                leon: {
                    name: 'Leon (Professional)',
                    team: 'citizen',
                    description: 'You are Leon, the Professional. You have 2 shots during the entire game. You have a vest (survives first shot). WARNING: If you shoot a citizen by mistake, you are killed as punishment and the doctor cannot save you!',
                    class: 'citizen'
                },
                kane: {
                    name: 'Citizen Kane',
                    team: 'citizen',
                    description: 'You are Citizen Kane. Once per game, you can reveal someone\'s allegiance. If they are mafia, their role is exposed to everyone (but not eliminated). If correct, you die the next night as you sacrifice yourself for the information. If you reveal a citizen who dies that night, you get your ability back.',
                    class: 'citizen'
                },
                constantine: {
                    name: 'Constantine',
                    team: 'citizen',
                    description: 'You are Constantine. Once per game, you can resurrect one "half-dead" player (eliminated by voting, not night kill). Choose carefully - you might accidentally resurrect a mafia member!',
                    class: 'citizen'
                },
                citizen: {
                    name: 'Simple Citizen',
                    team: 'citizen',
                    description: 'You are a Simple Citizen. You have no special abilities, but your voice and vote are crucial. Discuss, analyze, and help find the mafia! Be careful what you say - Godfather might target you with Sixth Sense.',
                    class: 'citizen'
                },
                nostradamus: {
                    name: 'Nostradamus',
                    team: 'independent',
                    description: 'You are Nostradamus, the Independent. At the start, show the narrator 3 players - they will tell you how many mafia are among them. Then choose which team to help. You cannot be killed by night shots, only by Godfather\'s Sixth Sense. You always appear innocent on investigations. Win by surviving to the end with your chosen side.',
                    class: 'independent'
                }
            },
            fa: {
                godfather: {
                    name: 'ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá Ÿáÿ≥ÿ™€åÿØÿå ÿ±Ÿáÿ®ÿ± ÿßÿµŸÑ€å ŸÖÿßŸÅ€åÿß. €å⁄© ÿ¨ŸÑ€åŸÇŸá ÿØÿßÿ±€åÿØ (ÿßÿ≤ ÿßŸàŸÑ€åŸÜ ÿ¥ŸÑ€å⁄© ÿ¨ÿßŸÜ ÿ≥ÿßŸÑŸÖ ÿ®Ÿá ÿØÿ± ŸÖ€å‚Äåÿ®ÿ±€åÿØ). ŸÇÿØÿ±ÿ™ "ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ" ÿØÿßÿ±€åÿØ: ÿ®Ÿá €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ¥ÿßÿ±Ÿá ⁄©ŸÜ€åÿØ Ÿà ŸÜŸÇÿ¥ ÿØŸÇ€åŸÇÿ¥ ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ - ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿµÿ®ÿ≠ ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ.',
                    class: 'mafia'
                },
                matador: {
                    name: 'ŸÖÿßÿ™ÿßÿØŸàÿ±',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ŸÖÿßÿ™ÿßÿØŸàÿ± Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿ™ŸàÿßŸÜÿß€å€å €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ŸÖÿ≥ÿØŸàÿØ ⁄©ŸÜ€åÿØ. ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ €å⁄© ŸÜŸÅÿ± ÿ±ÿß Ÿæÿ¥ÿ™ ÿ≥ÿ± ŸáŸÖ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØÿå ÿßŸÖÿß ÿ®ÿß €å⁄© ÿ¥ÿ® ŸÅÿßÿµŸÑŸá ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿ™⁄©ÿ±ÿßÿ± ⁄©ŸÜ€åÿØ.',
                    class: 'mafia'
                },
                saul: {
                    name: 'ÿ≥ÿßŸàŸÑ ⁄ØŸàÿØŸÖŸÜ',
                    team: 'mafia',
                    description: 'ÿ¥ŸÖÿß ÿ≥ÿßŸàŸÑ ⁄ØŸàÿØŸÖŸÜ Ÿáÿ≥ÿ™€åÿØ. ŸàŸÇÿ™€å €å⁄©€å ÿßÿ≤ ÿßÿπÿ∂ÿß€å ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸÖ€åÿ±ÿØÿå €å⁄© ÿ®ÿßÿ± ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá ÿ±ÿß ÿ®Ÿá ŸÖÿßŸÅ€åÿß ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ. ÿ®Ÿá ⁄©ÿ≥€å ÿßÿ¥ÿßÿ±Ÿá ⁄©ŸÜ€åÿØ - ÿß⁄Øÿ± ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá ÿ®ÿßÿ¥ÿØÿå ÿßÿ≤ ÿ¢ŸÜ ÿ¥ÿ® ÿ®Ÿá ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸæ€åŸàŸÜÿØÿØ.',
                    class: 'mafia'
                },
                watson: {
                    name: 'ÿØ⁄©ÿ™ÿ± Ÿàÿßÿ™ÿ≥ŸàŸÜ',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ÿØ⁄©ÿ™ÿ± Ÿàÿßÿ™ÿ≥ŸàŸÜ Ÿáÿ≥ÿ™€åÿØ. Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßÿ≤ ÿ≠ŸÖŸÑÿßÿ™ ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ. ŸÅŸÇÿ∑ €å⁄© ÿ®ÿßÿ± ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ÿÆŸàÿØÿ™ÿßŸÜ ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ. ÿØ€å⁄Øÿ±ÿßŸÜ ÿ±ÿß ÿ®€å‚ÄåŸÖÿ≠ÿØŸàÿØ€åÿ™ ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØ.',
                    class: 'citizen'
                },
                leon: {
                    name: 'ŸÑÿ¶ŸàŸÜ (ÿ≠ÿ±ŸÅŸá‚Äåÿß€å)',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ŸÑÿ¶ŸàŸÜÿå ÿ≠ÿ±ŸÅŸá‚Äåÿß€å Ÿáÿ≥ÿ™€åÿØ. ÿØÿ± ⁄©ŸÑ ÿ®ÿßÿ≤€å €≤ ÿ¥ŸÑ€å⁄© ÿØÿßÿ±€åÿØ. €å⁄© ÿ¨ŸÑ€åŸÇŸá ÿØÿßÿ±€åÿØ (ÿßÿ≤ ÿßŸàŸÑ€åŸÜ ÿ¥ŸÑ€å⁄© ÿ¨ÿßŸÜ ÿ≥ÿßŸÑŸÖ ÿ®Ÿá ÿØÿ± ŸÖ€å‚Äåÿ®ÿ±€åÿØ). Ÿáÿ¥ÿØÿßÿ±: ÿß⁄Øÿ± ÿ®Ÿá ÿßÿ¥ÿ™ÿ®ÿßŸá ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØÿå ÿ®Ÿá ÿπŸÜŸàÿßŸÜ ŸÖÿ¨ÿßÿ≤ÿßÿ™ ⁄©ÿ¥ÿ™Ÿá ŸÖ€å‚Äåÿ¥Ÿà€åÿØ Ÿà ÿØ⁄©ÿ™ÿ± ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ŸÖÿß ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸáÿØ!',
                    class: 'citizen'
                },
                kane: {
                    name: 'ŸáŸÖÿ¥Ÿáÿ±€å ⁄©€åŸÜ',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ŸáŸÖÿ¥Ÿáÿ±€å ⁄©€åŸÜ Ÿáÿ≥ÿ™€åÿØ. €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ Ÿàÿßÿ®ÿ≥ÿ™⁄Ø€å ⁄©ÿ≥€å ÿ±ÿß ŸÅÿßÿ¥ ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ŸÖÿßŸÅ€åÿß ÿ®ÿßÿ¥ÿØÿå ŸÜŸÇÿ¥ÿ¥ ÿ®ÿ±ÿß€å ŸáŸÖŸá ÿ¢ÿ¥⁄©ÿßÿ± ŸÖ€å‚Äåÿ¥ŸàÿØ (ÿßŸÖÿß ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ). ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ¥ÿ® ÿ®ÿπÿØ ŸÖ€å‚ÄåŸÖ€åÿ±€åÿØ ⁄ÜŸàŸÜ ÿÆŸàÿØ ÿ±ÿß ŸÅÿØÿß ŸÖ€å‚Äå⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ÿ¥Ÿáÿ±ŸàŸÜÿØ€å ⁄©Ÿá ŸÅÿßÿ¥ ⁄©ÿ±ÿØ€åÿØ ŸáŸÖÿßŸÜ ÿ¥ÿ® ÿ®ŸÖ€åÿ±ÿØÿå ÿ™ŸàÿßŸÜÿß€å€å‚Äåÿ™ÿßŸÜ ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ.',
                    class: 'citizen'
                },
                constantine: {
                    name: '⁄©ŸÜÿ≥ÿ™ÿßŸÜÿ™€åŸÜ',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß ⁄©ŸÜÿ≥ÿ™ÿßŸÜÿ™€åŸÜ Ÿáÿ≥ÿ™€åÿØ. €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ "ŸÜ€åŸÖ‚ÄåŸÖÿ±ÿØŸá" (ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸáÿå ŸÜŸá ÿ¥ÿßÿ™ ÿ¥ÿ®) ÿ±ÿß ÿßÿ≠ÿ∂ÿßÿ± ⁄©ŸÜ€åÿØ. ÿ®ÿß ÿØŸÇÿ™ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ - ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿßÿ¥ÿ™ÿ®ÿßŸáÿßŸã €å⁄© ŸÖÿßŸÅ€åÿß ÿ±ÿß ÿ≤ŸÜÿØŸá ⁄©ŸÜ€åÿØ!',
                    class: 'citizen'
                },
                citizen: {
                    name: 'ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá',
                    team: 'citizen',
                    description: 'ÿ¥ŸÖÿß €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá Ÿáÿ≥ÿ™€åÿØ. ÿ™ŸàÿßŸÜÿß€å€å ÿÆÿßÿµ€å ŸÜÿØÿßÿ±€åÿØÿå ÿßŸÖÿß ÿµÿØÿß Ÿà ÿ±ÿ£€å ÿ¥ŸÖÿß ÿ≠€åÿßÿ™€å ÿßÿ≥ÿ™. ÿ®ÿ≠ÿ´ ⁄©ŸÜ€åÿØÿå ÿ™ÿ≠ŸÑ€åŸÑ ⁄©ŸÜ€åÿØ Ÿà ÿ®Ÿá Ÿæ€åÿØÿß ⁄©ÿ±ÿØŸÜ ŸÖÿßŸÅ€åÿß ⁄©ŸÖ⁄© ⁄©ŸÜ€åÿØ! ŸÖÿ±ÿßŸÇÿ® ÿ≠ÿ±ŸÅ‚ÄåŸáÿß€åÿ™ÿßŸÜ ÿ®ÿßÿ¥€åÿØ - ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿ®ÿß ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ ÿ¥ŸÖÿß ÿ±ÿß ŸáÿØŸÅ ÿ®⁄Ø€åÿ±ÿØ.',
                    class: 'citizen'
                },
                nostradamus: {
                    name: 'ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥',
                    team: 'independent',
                    description: 'ÿ¥ŸÖÿß ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ÿå ŸÖÿ≥ÿ™ŸÇŸÑ Ÿáÿ≥ÿ™€åÿØ. ÿØÿ± ÿßÿ®ÿ™ÿØÿß €≥ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ÿ®Ÿá ÿ±ÿßŸà€å ŸÜÿ¥ÿßŸÜ ÿØŸá€åÿØ - ÿ™ÿπÿØÿßÿØ ŸÖÿßŸÅ€åÿßŸáÿß ÿ±ÿß ÿ®€åŸÜ ÿ¢ŸÜ‚ÄåŸáÿß ŸÖ€å‚Äå⁄ØŸà€åŸÜÿØ. ÿ≥Ÿæÿ≥ ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ⁄©ÿØÿßŸÖ ÿ™€åŸÖ ÿ±ÿß ⁄©ŸÖ⁄© ⁄©ŸÜ€åÿØ. ÿ®ÿß ÿ¥ÿßÿ™ ÿ¥ÿ® ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå ŸÅŸÇÿ∑ ÿ®ÿß ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá. ÿØÿ± ÿ™ÿ≠ŸÇ€åŸÇ ŸáŸÖ€åÿ¥Ÿá ÿ®€å‚Äå⁄ØŸÜÿßŸá ÿ®Ÿá ŸÜÿ∏ÿ± ŸÖ€å‚Äåÿ±ÿ≥€åÿØ. ÿ®ÿß ÿ≤ŸÜÿØŸá ŸÖÿßŸÜÿØŸÜ ÿ™ÿß ÿ¢ÿÆÿ± ÿØÿ± ⁄©ŸÜÿßÿ± ÿ™€åŸÖ ÿßŸÜÿ™ÿÆÿßÿ®€å‚Äåÿ™ÿßŸÜ ÿ®ÿ±ŸÜÿØŸá ÿ¥Ÿà€åÿØ.',
                    class: 'independent'
                }
            }
        };

        let currentPlayerIndex = 0;
        let playerRoles = [];
        let gameCountIncremented = false;
        let availableCards = [];
        let drawnCard = null;

        const cardDeck = {
            en: [
                { name: 'üîí Handcuff Card', description: 'Target one player - they lose their ability/power for the upcoming night.' },
                { name: 'üé≠ Face-Off Card', description: 'Swap roles with another player and return to the game! They are permanently eliminated.' },
                { name: 'ü§ê Silence of the Lambs', description: 'Silence chosen players for the entire next day. They can only vote.' },
                { name: 'üéØ Identity Reveal', description: 'The narrator reveals the exact role of the targeted player and they are eliminated.' },
                { name: 'üß† Beautiful Mind', description: 'Try to identify Nostradamus. If correct, they are eliminated and YOU become Nostradamus!' }
            ],
            fa: [
                { name: 'üîí ⁄©ÿßÿ±ÿ™ ÿØÿ≥ÿ™ÿ®ŸÜÿØ', description: '€å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ŸáÿØŸÅ ÿ®⁄Ø€åÿ±€åÿØ - ÿ™ŸàÿßŸÜÿß€å€å/ŸÇÿØÿ±ÿ™ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ±ÿß€å ÿ¥ÿ® ÿ¢€åŸÜÿØŸá ÿßÿ≤ ÿØÿ≥ÿ™ ŸÖ€å‚ÄåÿØŸáÿØ.' },
                { name: 'üé≠ ⁄©ÿßÿ±ÿ™ ÿ™ÿ∫€å€åÿ± ⁄ÜŸáÿ±Ÿá', description: 'ŸÜŸÇÿ¥ ÿ±ÿß ÿ®ÿß ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØ€å⁄Øÿ±€å ÿπŸàÿ∂ ⁄©ŸÜ€åÿØ Ÿà ÿ®Ÿá ÿ®ÿßÿ≤€å ÿ®ÿ±⁄Øÿ±ÿØ€åÿØ! ÿ¢ŸÜ‚ÄåŸáÿß ÿ®ÿ±ÿß€å ŸáŸÖ€åÿ¥Ÿá ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ.' },
                { name: 'ü§ê ⁄©ÿßÿ±ÿ™ ÿ≥⁄©Ÿàÿ™ ÿ®ÿ±Ÿá‚ÄåŸáÿß', description: 'ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿßŸÜÿ™ÿÆÿßÿ®€å ÿ±ÿß ÿ®ÿ±ÿß€å ⁄©ŸÑ ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≥ÿß⁄©ÿ™ ⁄©ŸÜ€åÿØ. ŸÅŸÇÿ∑ ŸÖ€å‚Äåÿ™ŸàÿßŸÜŸÜÿØ ÿ±ÿß€å ÿ®ÿØŸáŸÜÿØ.' },
                { name: 'üéØ ⁄©ÿßÿ±ÿ™ ÿßŸÅÿ¥ÿß€å ŸáŸà€åÿ™', description: 'ÿ±ÿßŸà€å ŸÜŸÇÿ¥ ÿØŸÇ€åŸÇ ÿ®ÿßÿ≤€å⁄©ŸÜ ŸáÿØŸÅ ÿ±ÿß ŸÅÿßÿ¥ ŸÖ€å‚Äå⁄©ŸÜÿØ Ÿà ÿßÿ≤ ÿ®ÿßÿ≤€å ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ.' },
                { name: 'üß† ⁄©ÿßÿ±ÿ™ ÿ∞ŸáŸÜ ÿ≤€åÿ®ÿß', description: 'ÿ≥ÿπ€å ⁄©ŸÜ€åÿØ ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ ÿ±ÿß ÿ¥ŸÜÿßÿ≥ÿß€å€å ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ Ÿà ÿ¥ŸÖÿß ÿ™ÿ®ÿØ€åŸÑ ÿ®Ÿá ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ!' }
            ]
        };

        function calculateTeamSize(playerCount) {
            // Godfather dynamic role assignment (6-15 players)
            // 6-7 players: Mafia vs Citizens (no Nostradamus)
            // 8+ players: Mafia vs Citizens vs Nostradamus (full Godfather mode)
            
            let godfather = 1; // Always have Godfather
            let matador = 0, saul = 0;
            let watson = 0, leon = 0, kane = 0, constantine = 0;
            let nostradamus = 0; // Only at 8+ players
            
            // Assign roles based on player count thresholds
            if (playerCount >= 6) {
                matador = 1;     // 2nd Mafia
                watson = 1;      // Core healer
                leon = 1;        // Core shooter
            }
            if (playerCount >= 7) {
                kane = 1;        // Investigation role
            }
            if (playerCount >= 8) {
                nostradamus = 1; // Independent enters (Godfather signature)
            }
            if (playerCount >= 9) {
                constantine = 1; // Resurrection role
            }
            if (playerCount >= 11) {
                saul = 1;        // 3rd Mafia (recruitment)
            }
            if (playerCount >= 13) {
                matador = 2;     // 2nd Matador for 4th Mafia
            }
            if (playerCount >= 15) {
                saul = 2;        // 2nd Saul for 5th Mafia
            }
            
            const totalMafiaCount = godfather + matador + saul;
            const totalCitizensCount = playerCount - totalMafiaCount - nostradamus;
            
            // Calculate simple citizens (fill remaining slots)
            const citizen = totalCitizensCount - watson - leon - kane - constantine;
            
            return {
                godfather: godfather,
                matador: matador,
                saul: saul,
                watson: watson,
                leon: leon,
                kane: kane,
                constantine: constantine,
                citizen: citizen,
                nostradamus: nostradamus,
                totalMafia: totalMafiaCount,
                totalCitizens: totalCitizensCount,
                totalIndependent: nostradamus
            };
        }

        function updatePlayerInfo() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const errorMsg = document.getElementById('errorMsg');
            
            if (!playerCount || playerCount < 6 || playerCount > 15) {
                errorMsg.textContent = currentLang === 'en' 
                    ? 'Please enter a number between 6 and 15' 
                    : 'ŸÑÿ∑ŸÅÿßŸã ÿπÿØÿØ€å ÿ®€åŸÜ €∂ ÿ™ÿß €±€µ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            
            const teamSize = calculateTeamSize(playerCount);
            const playerInfoEl = document.getElementById('playerInfo');
            
            if (currentLang === 'en') {
                if (teamSize.totalIndependent > 0) {
                    playerInfoEl.textContent = `${playerCount} Players: ${teamSize.totalMafia} Mafia ‚Ä¢ ${teamSize.totalCitizens} Citizens ‚Ä¢ ${teamSize.totalIndependent} Independent`;
                } else {
                    playerInfoEl.textContent = `${playerCount} Players: ${teamSize.totalMafia} Mafia ‚Ä¢ ${teamSize.totalCitizens} Citizens`;
                }
            } else {
                // Convert numbers to Farsi
                const persianDigits = ['€∞', '€±', '€≤', '€≥', '€¥', '€µ', '€∂', '€∑', '€∏', '€π'];
                const toFarsi = (num) => String(num).split('').map(d => persianDigits[parseInt(d)]).join('');
                if (teamSize.totalIndependent > 0) {
                    playerInfoEl.textContent = `${toFarsi(playerCount)} ÿ®ÿßÿ≤€å⁄©ŸÜ: ${toFarsi(teamSize.totalMafia)} ŸÖÿßŸÅ€åÿß - ${toFarsi(teamSize.totalCitizens)} ÿ¥Ÿáÿ±ŸàŸÜÿØ - ${toFarsi(teamSize.totalIndependent)} ŸÖÿ≥ÿ™ŸÇŸÑ`;
                } else {
                    playerInfoEl.textContent = `${toFarsi(playerCount)} ÿ®ÿßÿ≤€å⁄©ŸÜ: ${toFarsi(teamSize.totalMafia)} ŸÖÿßŸÅ€åÿß - ${toFarsi(teamSize.totalCitizens)} ÿ¥Ÿáÿ±ŸàŸÜÿØ`;
                }
            }
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'fa' : 'en';
            localStorage.setItem('language', currentLang);
            updateLanguage();
        }

        function updateLanguage() {
            const t = translations[currentLang];
            document.body.className = currentLang === 'fa' ? 'rtl' : '';
            
            // Update all UI text
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('playerCountLabel').textContent = t.playerCountLabel;
            updatePlayerInfo(); // Update player info with current language
            document.getElementById('assignBtn').textContent = t.assignBtn;
            document.getElementById('howToPlayBtn').textContent = t.howToPlayBtn;
            document.getElementById('feedbackBtn').textContent = t.feedbackBtn;
            document.getElementById('newGameText').textContent = t.newGameText;
            document.getElementById('langButtonText').textContent = t.langButtonText;
            document.getElementById('helpTitle').textContent = t.helpTitle;
            document.getElementById('feedbackTitle').textContent = t.feedbackTitle;
            document.getElementById('feedbackIntro').textContent = t.feedbackIntro;
            document.getElementById('nameLabel').textContent = t.nameLabel;
            document.getElementById('emailLabel').textContent = t.emailLabel;
            document.getElementById('messageLabel').textContent = t.messageLabel;
            document.getElementById('sendBtn').textContent = t.sendBtn;
            document.getElementById('confirmTitle').textContent = t.confirmTitle;
            document.getElementById('confirmText').textContent = t.confirmText;
            document.getElementById('yesBtn').textContent = t.yesBtn;
            document.getElementById('noBtn').textContent = t.noBtn;
            
            // Update help content
            updateHelpContent();
            
            // If game is in progress, refresh the current screen
            if (playerRoles.length > 0 && !document.getElementById('gameSection').classList.contains('hidden')) {
                refreshCurrentGameScreen();
            }
        }

        function refreshCurrentGameScreen() {
            // Check if we're on the final "all assigned" screen
            if (currentPlayerIndex >= playerRoles.length) {
                const t = translations[currentLang];
                const rolesContainer = document.getElementById('rolesContainer');
                rolesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üéâ</div>
                        <h2 style="color: #333; margin-bottom: 15px;">${t.allAssigned}</h2>
                        <p style="color: #666; font-size: 1.1em;">${t.gameBegin}</p>
                    </div>
                `;
                return;
            }
            
            // Check if role is currently revealed
            const roleRevealArea = document.getElementById('roleRevealArea');
            if (roleRevealArea && roleRevealArea.innerHTML.trim() !== '') {
                // Role is revealed, refresh it
                const roleKey = playerRoles[currentPlayerIndex];
                const role = roles[currentLang][roleKey];
                const t = translations[currentLang];
                
                let teamBadge = '';
                let teamColor = '';
                if (role.team === 'mafia') {
                    teamBadge = currentLang === 'en' ? 'üòà Mafia Team' : 'üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß';
                    teamColor = '#ee3d72';
                } else if (role.team === 'citizen') {
                    teamBadge = currentLang === 'en' ? 'üòá Citizens Team' : 'üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ';
                    teamColor = '#4facfe';
                } else if (role.team === 'independent') {
                    teamBadge = currentLang === 'en' ? 'üéØ Independent' : 'üéØ ŸÖÿ≥ÿ™ŸÇŸÑ';
                    teamColor = '#9b59b6';
                }
                
                roleRevealArea.innerHTML = `
                    <div class="role-card ${role.class}" style="margin-bottom: 20px; cursor: default;">
                        <div style="text-align: ${currentLang === 'fa' ? 'right' : 'left'};">
                            <div style="display: inline-block; background: ${teamColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; font-weight: 600;">
                                ${teamBadge}
                            </div>
                            <div class="role-name" style="font-size: 1.8em; margin-bottom: 15px;">
                                ${role.name}
                            </div>
                            <div class="role-description" style="font-size: 1.05em; line-height: 1.8;">
                                ${role.description}
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="nextPlayer()" style="margin-top: 20px;">${t.sawRoleBtn}</button>
                `;
            } else {
                // Just the instruction screen is showing, refresh it
                const instructionBox = document.getElementById('instructionBox');
                const showRoleBtn = document.getElementById('showRoleBtn');
                if (instructionBox && showRoleBtn) {
                    const t = translations[currentLang];
                    instructionBox.innerHTML = `
                        <div style="font-size: 2.5em; margin-bottom: 15px;">üë§</div>
                        <h2 style="color: #333; margin-bottom: 10px;">${t.playerLabel} ${currentPlayerIndex + 1}</h2>
                        <p style="color: #666;">${currentLang === 'en' ? 'Click the button below to see your role' : 'ÿ±Ÿà€å ÿØ⁄©ŸÖŸá ÿ≤€åÿ± ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ŸÜŸÇÿ¥ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ®€åŸÜ€åÿØ'}</p>
                    `;
                    showRoleBtn.innerHTML = t.showRoleBtn;
                }
            }
        }

        function updateHelpContent() {
            const helpContent = document.getElementById('helpContent');
            
            if (currentLang === 'en') {
                helpContent.innerHTML = `
                    <h3>üéØ Game Overview</h3>
                    <p>Mafia: Godfather is an advanced social deduction game for 6-15 players. The game is run by a narrator (Lord/God) who manages the flow and executes all actions.</p>
                    <p><strong>Standard Setup (11 players):</strong> 3 Mafia vs 7 Citizens vs 1 Independent (Nostradamus)</p>
                    <p><strong>Note:</strong> Nostradamus only appears in games with 8+ players. Games with 6-7 players are pure Mafia vs Citizens.</p>
                    
                    <h3>üåô Game Flow</h3>
                    <ul>
                        <li><strong>Night Introduction:</strong> Nostradamus picks 3 players, narrator reveals mafia count among them</li>
                        <li><strong>Night Phase:</strong> Mafia chooses victim, special roles use abilities</li>
                        <li><strong>Day Phase:</strong> Discussion and voting to eliminate suspects</li>
                        <li><strong>Voting:</strong> Open voting with eyes open if multiple candidates. Can vote for 2 people simultaneously. Candidates can vote for each other</li>
                        <li><strong>Last Move Cards:</strong> Players eliminated by voting draw a card before leaving</li>
                    </ul>

                    <h3>üòà Mafia Team (3 members)</h3>
                    
                    <div class="role-help mafia">
                        <h4>üëî The Godfather</h4>
                        <p><strong>Vest:</strong> Survives first shot (cannot be killed by Leon or night mafia shot)</p>
                        <p><strong>Sixth Sense:</strong> Point to a player and guess their exact role. If correct, they are eliminated the next morning (cannot be saved, blocked, or protected by any ability - like "slaughter")</p>
                        <p><strong>How to use:</strong> During night, point with index finger to the narrator</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üé≠ Matador</h4>
                        <p><strong>Roleblock:</strong> Each night, block one player's ability</p>
                        <p><strong>Limitation:</strong> Cannot block same person consecutively (but can after 1 night gap)</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üë®‚Äç‚öñÔ∏è Saul Goodman</h4>
                        <p><strong>Recruitment:</strong> When a mafia dies, once recruit a Simple Citizen to mafia</p>
                        <p><strong>How:</strong> Point to someone - if Simple Citizen, they join mafia that night</p>
                    </div>

                    <h3>üòá Citizens Team (7 members)</h3>
                    
                    <div class="role-help citizen">
                        <h4>üíâ Dr. Watson</h4>
                        <p><strong>Save:</strong> Protect one person each night from attacks</p>
                        <p><strong>Limitation:</strong> Can save self only once, others unlimited</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üî´ Leon (Professional)</h4>
                        <p><strong>Shots:</strong> 2 shots total for entire game</p>
                        <p><strong>Vest:</strong> Survives first shot</p>
                        <p><strong>Warning:</strong> If you shoot a citizen by mistake, you are killed as punishment and the doctor cannot save you!</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üì∫ Citizen Kane</h4>
                        <p><strong>Investigation:</strong> Once per game, point to someone. If they're a citizen, nothing happens. If they're mafia, the narrator announces the next morning: "At Citizen Kane's request, [Name] is mafia" - exposing their role to everyone</p>
                        <p><strong>Sacrifice:</strong> If investigation reveals a mafia, Kane dies the next night (sacrifices himself for the information)</p>
                        <p><strong>Important:</strong> Revealed mafia is NOT eliminated, only exposed</p>
                        <p><strong>Recharge:</strong> If you investigate a citizen and they die that same night, you get your ability back for another use</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>‚úùÔ∏è Constantine</h4>
                        <p><strong>Resurrection:</strong> Once per game, bring back a "half-dead" player (someone eliminated by day voting)</p>
                        <p><strong>Half-Dead Rules:</strong> Players eliminated by voting stay near the game with eyes closed. Constantine can resurrect one of them (if their role wasn't exposed)</p>
                        <p><strong>Risk:</strong> Might accidentally resurrect mafia!</p>
                        <p><strong>Important:</strong> When one half-dead player is resurrected, all other half-dead players are permanently eliminated from the game</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üë§ Simple Citizens (3 people)</h4>
                        <p><strong>Role:</strong> No special abilities</p>
                        <p><strong>Importance:</strong> Discussion, voting, and deduction are crucial</p>
                        <p><strong>Warning:</strong> Be careful about revealing you're a "simple" citizen - Godfather might use Sixth Sense!</p>
                    </div>

                    <h3>üéØ Independent (1 player)</h3>
                    
                    <div class="role-help independent">
                        <h4>üîÆ Nostradamus</h4>
                        <p><strong>Intro Phase:</strong> At the start of the game, point to 3 players. The narrator tells you how many mafia are among those 3</p>
                        <p><strong>Team Choice Rules:</strong></p>
                        <ul style="margin-top: 5px; margin-bottom: 10px;">
                            <li>If 0 or 1 mafia among your 3: You can choose any side (mafia or citizens)</li>
                            <li>If 2 or 3 mafia among your 3: You MUST join the mafia side (forced, no choice) because you've identified too many of them</li>
                        </ul>
                        <p><strong>Immunities:</strong> Cannot be killed by night shots, always appears innocent on investigations</p>
                        <p><strong>Weakness:</strong> Can only be killed by Godfather's Sixth Sense</p>
                        <p><strong>Goal:</strong> Survive to the end with your chosen (or forced) team to win</p>
                    </div>

                    <h3>üÉè Last Move Cards</h3>
                    <p>When eliminated by voting, players draw one card before leaving. The narrator executes the card's effect.</p>
                    
                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üîí Handcuff Card</h4>
                        <p><strong>Effect:</strong> Target one player - they lose their ability/power for the upcoming night.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üé≠ Face-Off Card</h4>
                        <p><strong>Effect:</strong> Swap roles with another player and return to the game! They are permanently eliminated (not even half-dead). You take their entire role, abilities, and team. Cannot be resurrected.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>ü§ê Silence of the Lambs Card</h4>
                        <p><strong>Effect:</strong> Silence chosen players for the entire next day. They can only vote, no talking or gestures.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üéØ Identity Reveal Card</h4>
                        <p><strong>Effect:</strong> The narrator reveals the exact role of the targeted player and they are eliminated from the game.</p>
                    </div>

                    <div class="role-help" style="border-left-color: #667eea;">
                        <h4>üß† Beautiful Mind Card</h4>
                        <p><strong>Effect:</strong> Try to identify Nostradamus. If correct, they are eliminated and YOU become the new Nostradamus!</p>
                    </div>

                    <h3>üí° Strategy Tips</h3>
                    <ul>
                        <li><strong>Godfather:</strong> Use Sixth Sense wisely - it's your most powerful tool</li>
                        <li><strong>Matador:</strong> Block key roles like Dr. Watson or Leon</li>
                        <li><strong>Leon:</strong> You only have 2 shots - be absolutely certain before shooting or you'll die!</li>
                        <li><strong>Citizens:</strong> Never say "I'm just a simple citizen" - it makes you a Sixth Sense target</li>
                        <li><strong>Nostradamus:</strong> Your choice of team can determine the entire game</li>
                        <li><strong>Everyone:</strong> Last Move Cards can change everything - use them strategically!</li>
                    </ul>
                `;
            } else {
                helpContent.innerHTML = `
                    <h3>üéØ ŸÖÿπÿ±ŸÅ€å ÿ®ÿßÿ≤€å</h3>
                    <p>ŸÖÿßŸÅ€åÿß: ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá €å⁄© ÿ®ÿßÿ≤€å ÿßÿ≥ÿ™ŸÜÿ™ÿßÿ¨ ÿßÿ¨ÿ™ŸÖÿßÿπ€å Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá ÿ®ÿ±ÿß€å €∂-€±€µ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ≥ÿ™. ÿ®ÿßÿ≤€å ÿ™Ÿàÿ≥ÿ∑ €å⁄© ÿ±ÿßŸà€å (ŸÑÿ±ÿØ/⁄ØÿßÿØ) ÿßÿØÿßÿ±Ÿá ŸÖ€å‚Äåÿ¥ŸàÿØ ⁄©Ÿá ÿ™ŸÖÿßŸÖ ÿßŸÇÿØÿßŸÖÿßÿ™ ÿ±ÿß ÿßÿ¨ÿ±ÿß ŸÖ€å‚Äå⁄©ŸÜÿØ.</p>
                    <p><strong>ÿ™ÿ±⁄©€åÿ® ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ (€±€± ÿ®ÿßÿ≤€å⁄©ŸÜ):</strong> €≥ ŸÖÿßŸÅ€åÿß ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ €∑ ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ €± ŸÖÿ≥ÿ™ŸÇŸÑ (ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥)</p>
                    <p><strong>ŸÜ⁄©ÿ™Ÿá:</strong> ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ ŸÅŸÇÿ∑ ÿØÿ± ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å €∏ ŸÜŸÅÿ±Ÿá €åÿß ÿ®€åÿ¥ÿ™ÿ± ÿ∏ÿßŸáÿ± ŸÖ€å‚Äåÿ¥ŸàÿØ. ÿ®ÿßÿ≤€å‚ÄåŸáÿß€å €∂-€∑ ŸÜŸÅÿ±Ÿá ŸÅŸÇÿ∑ ŸÖÿßŸÅ€åÿß ÿØÿ± ŸÖŸÇÿßÿ®ŸÑ ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿßÿ≥ÿ™.</p>
                    
                    <h3>üåô ÿ±ŸàŸÜÿØ ÿ®ÿßÿ≤€å</h3>
                    <ul>
                        <li><strong>ÿ¥ÿ® ŸÖÿπÿßÿ±ŸÅŸá:</strong> ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ €≥ ŸÜŸÅÿ± ÿßŸÜÿ™ÿÆÿßÿ® ŸÖ€å‚Äå⁄©ŸÜÿØÿå ÿ±ÿßŸà€å ÿ™ÿπÿØÿßÿØ ŸÖÿßŸÅ€åÿß ÿ±ÿß ÿ®€åŸÜ ÿ¢ŸÜ‚ÄåŸáÿß ŸÖ€å‚Äå⁄ØŸà€åÿØ</li>
                        <li><strong>ŸÅÿßÿ≤ ÿ¥ÿ®:</strong> ŸÖÿßŸÅ€åÿß ŸÇÿ±ÿ®ÿßŸÜ€å ÿßŸÜÿ™ÿÆÿßÿ® ŸÖ€å‚Äå⁄©ŸÜÿØÿå ŸÜŸÇÿ¥‚ÄåŸáÿß€å Ÿà€å⁄òŸá ÿßÿ≤ ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß€åÿ¥ÿßŸÜ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ŸÖ€å‚Äå⁄©ŸÜŸÜÿØ</li>
                        <li><strong>ŸÅÿßÿ≤ ÿ±Ÿàÿ≤:</strong> ÿ®ÿ≠ÿ´ Ÿà ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ®ÿ±ÿß€å ÿ≠ÿ∞ŸÅ ŸÖÿ∏ŸÜŸàŸÜ€åŸÜ</li>
                        <li><strong>ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å:</strong> ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ®ÿß ⁄Üÿ¥ŸÖ ÿ®ÿßÿ≤ ÿØÿ± ÿµŸàÿ±ÿ™ Ÿàÿ¨ŸàÿØ ⁄ÜŸÜÿØ ⁄©ÿßŸÜÿØ€åÿØÿß. ŸÖ€å‚Äåÿ™ŸàÿßŸÜ ŸáŸÖÿ≤ŸÖÿßŸÜ ÿ®Ÿá €≤ ŸÜŸÅÿ± ÿ±ÿß€å ÿØÿßÿØ. ⁄©ÿßŸÜÿØ€åÿØÿßŸáÿß ŸÖ€å‚Äåÿ™ŸàÿßŸÜŸÜÿØ ÿ®Ÿá €å⁄©ÿØ€å⁄Øÿ± ÿ±ÿß€å ÿØŸáŸÜÿØ</li>
                        <li><strong>⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿ≠ÿ±⁄©ÿ™ ÿ¢ÿÆÿ±:</strong> ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸá ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ŸÇÿ®ŸÑ ÿßÿ≤ ÿÆÿ±Ÿàÿ¨ €å⁄© ⁄©ÿßÿ±ÿ™ ŸÖ€å‚Äå⁄©ÿ¥ŸÜÿØ</li>
                    </ul>

                    <h3>üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß (€≥ ÿπÿ∂Ÿà)</h3>
                    
                    <div class="role-help mafia">
                        <h4>üëî ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá</h4>
                        <p><strong>ÿ¨ŸÑ€åŸÇŸá:</strong> ÿßÿ≤ ÿßŸàŸÑ€åŸÜ ÿ¥ŸÑ€å⁄© ÿ¨ÿßŸÜ ÿ≥ÿßŸÑŸÖ ÿ®Ÿá ÿØÿ± ŸÖ€å‚Äåÿ®ÿ±ÿØ (ÿ™Ÿàÿ≥ÿ∑ ŸÑÿ¶ŸàŸÜ €åÿß ÿ¥ÿßÿ™ ÿ¥ÿ® ŸÖÿßŸÅ€åÿß ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥ŸàÿØ)</p>
                        <p><strong>ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ:</strong> ÿ®Ÿá €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ¥ÿßÿ±Ÿá ⁄©ŸÜ€åÿØ Ÿà ŸÜŸÇÿ¥ ÿØŸÇ€åŸÇÿ¥ ÿ±ÿß ÿ≠ÿØÿ≥ ÿ®ÿ≤ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿµÿ®ÿ≠ ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ (ŸÇÿßÿ®ŸÑ ŸÜÿ¨ÿßÿ™ÿå ŸÖÿ≥ÿØŸàÿØÿ≥ÿßÿ≤€å €åÿß ŸÖÿ≠ÿßŸÅÿ∏ÿ™ ÿ™Ÿàÿ≥ÿ∑ Ÿá€å⁄Ü ÿ™ŸàÿßŸÜÿß€å€å‚Äåÿß€å ŸÜ€åÿ≥ÿ™ - ŸÖÿ´ŸÑ "ÿ≥ŸÑÿßÿÆ€å")</p>
                        <p><strong>ŸÜÿ≠ŸàŸá ÿßÿ≥ÿ™ŸÅÿßÿØŸá:</strong> ÿØÿ± ÿ¥ÿ® ÿ®ÿß ÿßŸÜ⁄Øÿ¥ÿ™ ÿßÿ¥ÿßÿ±Ÿá ÿ®Ÿá ÿ±ÿßŸà€å ŸÜÿ¥ÿßŸÜ ÿØŸá€åÿØ</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üé≠ ŸÖÿßÿ™ÿßÿØŸàÿ±</h4>
                        <p><strong>ŸÖÿ≥ÿØŸàÿØÿ≥ÿßÿ≤€å:</strong> Ÿáÿ± ÿ¥ÿ® ÿ™ŸàÿßŸÜÿß€å€å €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ŸÖÿ≥ÿØŸàÿØ ⁄©ŸÜ€åÿØ</p>
                        <p><strong>ŸÖÿ≠ÿØŸàÿØ€åÿ™:</strong> ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ €å⁄© ŸÜŸÅÿ± ÿ±ÿß Ÿæÿ¥ÿ™ ÿ≥ÿ± ŸáŸÖ ŸÖÿ≥ÿØŸàÿØ ⁄©ŸÜ€åÿØ (ÿßŸÖÿß ÿ®ÿπÿØ ÿßÿ≤ €± ÿ¥ÿ® ŸÅÿßÿµŸÑŸá ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ)</p>
                    </div>

                    <div class="role-help mafia">
                        <h4>üë®‚Äç‚öñÔ∏è ÿ≥ÿßŸàŸÑ ⁄ØŸàÿØŸÖŸÜ</h4>
                        <p><strong>ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ:</strong> ŸàŸÇÿ™€å €å⁄© ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸÖ€åÿ±ÿØÿå €å⁄© ÿ®ÿßÿ± €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá ÿ±ÿß ÿ®Ÿá ŸÖÿßŸÅ€åÿß ÿßÿ∂ÿßŸÅŸá ⁄©ŸÜ€åÿØ</p>
                        <p><strong>⁄Ü⁄ØŸàŸÜŸá:</strong> ÿ®Ÿá ⁄©ÿ≥€å ÿßÿ¥ÿßÿ±Ÿá ⁄©ŸÜ€åÿØ - ÿß⁄Øÿ± ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá ÿ®ÿßÿ¥ÿØÿå ŸáŸÖÿßŸÜ ÿ¥ÿ® ÿ®Ÿá ŸÖÿßŸÅ€åÿß ŸÖ€å‚ÄåŸæ€åŸàŸÜÿØÿØ</p>
                    </div>

                    <h3>üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ (€∑ ÿπÿ∂Ÿà)</h3>
                    
                    <div class="role-help citizen">
                        <h4>üíâ ÿØ⁄©ÿ™ÿ± Ÿàÿßÿ™ÿ≥ŸàŸÜ</h4>
                        <p><strong>ŸÜÿ¨ÿßÿ™:</strong> Ÿáÿ± ÿ¥ÿ® €å⁄© ŸÜŸÅÿ± ÿ±ÿß ÿßÿ≤ ÿ≠ŸÖŸÑÿßÿ™ ŸÖÿ≠ÿßŸÅÿ∏ÿ™ ⁄©ŸÜ€åÿØ</p>
                        <p><strong>ŸÖÿ≠ÿØŸàÿØ€åÿ™:</strong> ŸÅŸÇÿ∑ €å⁄© ÿ®ÿßÿ± ÿÆŸàÿØ ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸá€åÿØÿå ÿØ€å⁄Øÿ±ÿßŸÜ ÿ®€å‚ÄåŸÖÿ≠ÿØŸàÿØ€åÿ™</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üî´ ŸÑÿ¶ŸàŸÜ (ÿ≠ÿ±ŸÅŸá‚Äåÿß€å)</h4>
                        <p><strong>ÿ¥ŸÑ€å⁄©:</strong> ÿØÿ± ⁄©ŸÑ ÿ®ÿßÿ≤€å €≤ ÿ¥ŸÑ€å⁄© ÿØÿßÿ±€åÿØ</p>
                        <p><strong>ÿ¨ŸÑ€åŸÇŸá:</strong> ÿßÿ≤ ÿßŸàŸÑ€åŸÜ ÿ¥ŸÑ€å⁄© ÿ¨ÿßŸÜ ÿ≥ÿßŸÑŸÖ ÿ®Ÿá ÿØÿ± ŸÖ€å‚Äåÿ®ÿ±ÿØ</p>
                        <p><strong>Ÿáÿ¥ÿØÿßÿ±:</strong> ÿß⁄Øÿ± ÿ®Ÿá ÿßÿ¥ÿ™ÿ®ÿßŸá ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ¥ŸÑ€å⁄© ⁄©ŸÜ€åÿØÿå ÿ®Ÿá ÿπŸÜŸàÿßŸÜ ŸÖÿ¨ÿßÿ≤ÿßÿ™ ⁄©ÿ¥ÿ™Ÿá ŸÖ€å‚Äåÿ¥Ÿà€åÿØ Ÿà ÿØ⁄©ÿ™ÿ± ŸÜŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ÿ¥ŸÖÿß ÿ±ÿß ŸÜÿ¨ÿßÿ™ ÿØŸáÿØ!</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üì∫ ŸáŸÖÿ¥Ÿáÿ±€å ⁄©€åŸÜ</h4>
                        <p><strong>ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ:</strong> €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å ÿ®Ÿá ⁄©ÿ≥€å ÿßÿ¥ÿßÿ±Ÿá ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ®ÿßÿ¥ÿØ ÿßÿ™ŸÅÿßŸÇ€å ŸÜŸÖ€å‚ÄåÿßŸÅÿ™ÿØ. ÿß⁄Øÿ± ŸÖÿßŸÅ€åÿß ÿ®ÿßÿ¥ÿØ ÿµÿ®ÿ≠ ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ±ÿßŸà€å ÿßÿπŸÑÿßŸÖ ŸÖ€å‚Äå⁄©ŸÜÿØ: "ÿ®Ÿá ÿØÿ±ÿÆŸàÿßÿ≥ÿ™ ŸáŸÖÿ¥Ÿáÿ±€å ⁄©€åŸÜÿå [ŸÜÿßŸÖ] ŸÖÿßŸÅ€åÿß€å ÿ®ÿßÿ≤€å ÿßÿ≥ÿ™" - ŸÜŸÇÿ¥ ÿßŸà ÿ®ÿ±ÿß€å ŸáŸÖŸá ŸÅÿßÿ¥ ŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                        <p><strong>ŸÅÿØÿß⁄©ÿßÿ±€å:</strong> ÿß⁄Øÿ± ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ŸÖÿßŸÅ€åÿß ÿ±ÿß ŸÅÿßÿ¥ ⁄©ŸÜÿØÿå ⁄©€åŸÜ ÿ¥ÿ® ÿ®ÿπÿØ ŸÖ€å‚ÄåŸÖ€åÿ±ÿØ (ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ±ÿß€å ÿßÿ∑ŸÑÿßÿπÿßÿ™ ŸÅÿØÿß ŸÖ€å‚Äå⁄©ŸÜÿØ)</p>
                        <p><strong>ŸÖŸáŸÖ:</strong> ŸÖÿßŸÅ€åÿß€å ŸÅÿßÿ¥ ÿ¥ÿØŸá ÿ≠ÿ∞ŸÅ ŸÜŸÖ€å‚Äåÿ¥ŸàÿØÿå ŸÅŸÇÿ∑ ÿßŸÅÿ¥ÿß ŸÖ€å‚Äåÿ¥ŸàÿØ</p>
                        <p><strong>ÿ¥ÿßÿ±⁄ò ŸÖÿ¨ÿØÿØ:</strong> ÿß⁄Øÿ± ÿ®Ÿá ÿ¥Ÿáÿ±ŸàŸÜÿØ€å ÿßÿ≥ÿ™ÿπŸÑÿßŸÖ ÿ®ÿØŸá€åÿØ Ÿà ŸáŸÖÿßŸÜ ÿ¥ÿ® ÿ®ŸÖ€åÿ±ÿØÿå ÿ™ŸàÿßŸÜÿß€å€å‚Äåÿ™ÿßŸÜ ÿ®ÿ±ÿß€å ÿßÿ≥ÿ™ŸÅÿßÿØŸá ÿØŸàÿ®ÿßÿ±Ÿá ÿ®ÿ±ŸÖ€å‚Äå⁄Øÿ±ÿØÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>‚úùÔ∏è ⁄©ŸÜÿ≥ÿ™ÿßŸÜÿ™€åŸÜ</h4>
                        <p><strong>ÿßÿ≠ÿ∂ÿßÿ± ÿ±Ÿàÿ≠:</strong> €å⁄© ÿ®ÿßÿ± ÿØÿ± ÿ®ÿßÿ≤€å €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ "ŸÜ€åŸÖ‚ÄåŸÖÿ±ÿØŸá" (ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ±Ÿàÿ≤ ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸá) ÿ±ÿß ÿ®ÿ±⁄Øÿ±ÿØÿßŸÜ€åÿØ</p>
                        <p><strong>ŸÇŸàÿßŸÜ€åŸÜ ŸÜ€åŸÖ‚ÄåŸÖÿ±ÿØŸá:</strong> ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿ≠ÿ∞ŸÅ ÿ¥ÿØŸá ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿØÿ± ŸÜÿ≤ÿØ€å⁄©€å ÿ®ÿßÿ≤€å ÿ®ÿß ⁄Üÿ¥ŸÖ ÿ®ÿ≥ÿ™Ÿá ŸÖ€å‚ÄåŸÖÿßŸÜŸÜÿØ. ⁄©ŸÜÿ≥ÿ™ÿßŸÜÿ™€åŸÜ ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ €å⁄©€å ÿ±ÿß ÿßÿ≠ÿ∂ÿßÿ± ⁄©ŸÜÿØ (ÿß⁄Øÿ± ŸÜŸÇÿ¥ÿ¥ ÿßŸÅÿ¥ÿß ŸÜÿ¥ÿØŸá ÿ®ÿßÿ¥ÿØ)</p>
                        <p><strong>ÿ±€åÿ≥⁄©:</strong> ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿßÿ¥ÿ™ÿ®ÿßŸáÿßŸã ŸÖÿßŸÅ€åÿß ÿ±ÿß ÿßÿ≠ÿ∂ÿßÿ± ⁄©ŸÜ€åÿØ!</p>
                        <p><strong>ŸÖŸáŸÖ:</strong> ŸàŸÇÿ™€å €å⁄© ŸÜ€åŸÖ‚ÄåŸÖÿ±ÿØŸá ÿßÿ≠ÿ∂ÿßÿ± ŸÖ€å‚Äåÿ¥ŸàÿØÿå ÿ™ŸÖÿßŸÖ ŸÜ€åŸÖ‚ÄåŸÖÿ±ÿØŸá‚ÄåŸáÿß€å ÿØ€å⁄Øÿ± ÿ®ÿ±ÿß€å ŸáŸÖ€åÿ¥Ÿá ÿßÿ≤ ÿ®ÿßÿ≤€å ÿÆÿßÿ±ÿ¨ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ</p>
                    </div>

                    <div class="role-help citizen">
                        <h4>üë§ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ ÿ≥ÿßÿØŸá (€≥ ŸÜŸÅÿ±)</h4>
                        <p><strong>ŸÜŸÇÿ¥:</strong> ÿ™ŸàÿßŸÜÿß€å€å ÿÆÿßÿµ€å ŸÜÿØÿßÿ±ŸÜÿØ</p>
                        <p><strong>ÿßŸáŸÖ€åÿ™:</strong> ÿ®ÿ≠ÿ´ÿå ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å Ÿà ÿßÿ≥ÿ™ŸÜÿ™ÿßÿ¨ ÿ®ÿ≥€åÿßÿ± ŸÖŸáŸÖ Ÿáÿ≥ÿ™ŸÜÿØ</p>
                        <p><strong>Ÿáÿ¥ÿØÿßÿ±:</strong> ŸÖÿ±ÿßŸÇÿ® ÿ®ÿßÿ¥€åÿØ ⁄©Ÿá ŸÅÿßÿ¥ ŸÜ⁄©ŸÜ€åÿØ "ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá" Ÿáÿ≥ÿ™€åÿØ - ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá ŸÖŸÖ⁄©ŸÜ ÿßÿ≥ÿ™ ÿßÿ≤ ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜÿØ!</p>
                    </div>

                    <h3>üéØ ŸÖÿ≥ÿ™ŸÇŸÑ (€± ÿ®ÿßÿ≤€å⁄©ŸÜ)</h3>
                    
                    <div class="role-help independent">
                        <h4>üîÆ ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥</h4>
                        <p><strong>ŸÅÿßÿ≤ ŸÖÿπÿßÿ±ŸÅŸá:</strong> ÿØÿ± ÿßÿ®ÿ™ÿØÿß€å ÿ®ÿßÿ≤€å ÿ®Ÿá €≥ ÿ®ÿßÿ≤€å⁄©ŸÜ ÿßÿ¥ÿßÿ±Ÿá ⁄©ŸÜ€åÿØ. ÿ±ÿßŸà€å ÿ®Ÿá ÿ¥ŸÖÿß ŸÖ€å‚Äå⁄ØŸà€åÿØ ⁄ÜŸÜÿØ ŸÖÿßŸÅ€åÿß ÿ®€åŸÜ ÿ¢ŸÜ €≥ ŸÜŸÅÿ± Ÿáÿ≥ÿ™ŸÜÿØ</p>
                        <p><strong>ŸÇŸàÿßŸÜ€åŸÜ ÿßŸÜÿ™ÿÆÿßÿ® ÿ™€åŸÖ:</strong></p>
                        <ul style="margin-top: 5px; margin-bottom: 10px;">
                            <li>ÿß⁄Øÿ± €∞ €åÿß €± ŸÖÿßŸÅ€åÿß ÿ®€åŸÜ €≥ ŸÜŸÅÿ±ÿ™ÿßŸÜ ÿ®ÿßÿ¥ÿØ: ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ Ÿáÿ± ÿ≥ÿß€åÿØ€å ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ (ŸÖÿßŸÅ€åÿß €åÿß ÿ¥Ÿáÿ±ŸàŸÜÿØ)</li>
                            <li>ÿß⁄Øÿ± €≤ €åÿß €≥ ŸÖÿßŸÅ€åÿß ÿ®€åŸÜ €≥ ŸÜŸÅÿ±ÿ™ÿßŸÜ ÿ®ÿßÿ¥ÿØ: ÿ®ÿß€åÿØ ÿ®Ÿá ÿ≤Ÿàÿ± ÿ®Ÿá ÿ≥ÿß€åÿØ ŸÖÿßŸÅ€åÿß ÿ®Ÿæ€åŸàŸÜÿØ€åÿØ (ÿßÿ¨ÿ®ÿßÿ±€åÿå ÿ®ÿØŸàŸÜ ÿßŸÜÿ™ÿÆÿßÿ®) ⁄ÜŸàŸÜ ÿ™ÿπÿØÿßÿØ ÿ≤€åÿßÿØ€å ÿßÿ≤ ÿ¢ŸÜ‚ÄåŸáÿß ÿ±ÿß ÿ¥ŸÜÿßÿ≥ÿß€å€å ⁄©ÿ±ÿØŸá‚Äåÿß€åÿØ</li>
                        </ul>
                        <p><strong>ŸÖÿµŸàŸÜ€åÿ™:</strong> ÿ®ÿß ÿ¥ÿßÿ™ ÿ¥ÿ® ⁄©ÿ¥ÿ™Ÿá ŸÜŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå ÿØÿ± ÿ™ÿ≠ŸÇ€åŸÇÿßÿ™ ŸáŸÖ€åÿ¥Ÿá ÿ®€å‚Äå⁄ØŸÜÿßŸá ÿ®Ÿá ŸÜÿ∏ÿ± ŸÖ€å‚Äåÿ±ÿ≥€åÿØ</p>
                        <p><strong>ŸÜŸÇÿ∑Ÿá ÿ∂ÿπŸÅ:</strong> ŸÅŸÇÿ∑ ÿ®ÿß ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá ⁄©ÿ¥ÿ™Ÿá ŸÖ€å‚Äåÿ¥Ÿà€åÿØ</p>
                        <p><strong>ŸáÿØŸÅ:</strong> ÿ™ÿß ÿ¢ÿÆÿ± ÿ®ÿß ÿ™€åŸÖ ÿßŸÜÿ™ÿÆÿßÿ®€å (€åÿß ÿßÿ¨ÿ®ÿßÿ±€å) ÿÆŸàÿØ ÿ≤ŸÜÿØŸá ÿ®ŸÖÿßŸÜ€åÿØ ÿ™ÿß ÿ®ÿ±ŸÜÿØŸá ÿ¥Ÿà€åÿØ</p>
                    </div>

                    <h3>üÉè ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿ≠ÿ±⁄©ÿ™ ÿ¢ÿÆÿ±</h3>
                    <p>ŸàŸÇÿ™€å ÿ®ÿß ÿ±ÿß€å‚Äå⁄Ø€åÿ±€å ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥Ÿà€åÿØÿå ŸÇÿ®ŸÑ ÿßÿ≤ ÿÆÿ±Ÿàÿ¨ €å⁄© ⁄©ÿßÿ±ÿ™ ÿßŸÜÿ™ÿÆÿßÿ® ŸÖ€å‚Äå⁄©ŸÜ€åÿØ. ÿ±ÿßŸà€å ÿßÿ´ÿ± ⁄©ÿßÿ±ÿ™ ÿ±ÿß ÿßÿ¨ÿ±ÿß ŸÖ€å‚Äå⁄©ŸÜÿØ.</p>
                    
                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üîí ⁄©ÿßÿ±ÿ™ ÿØÿ≥ÿ™ÿ®ŸÜÿØ</h4>
                        <p><strong>ÿßÿ´ÿ±:</strong> €å⁄© ÿ®ÿßÿ≤€å⁄©ŸÜ ÿ±ÿß ŸáÿØŸÅ ÿ®⁄Ø€åÿ±€åÿØ - ÿ™ŸàÿßŸÜÿß€å€å/ŸÇÿØÿ±ÿ™ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ±ÿß€å ÿ¥ÿ® ÿ¢€åŸÜÿØŸá ÿßÿ≤ ÿØÿ≥ÿ™ ŸÖ€å‚ÄåÿØŸáÿØ.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üé≠ ⁄©ÿßÿ±ÿ™ ÿ™ÿ∫€å€åÿ± ⁄ÜŸáÿ±Ÿá</h4>
                        <p><strong>ÿßÿ´ÿ±:</strong> ŸÜŸÇÿ¥ ÿ±ÿß ÿ®ÿß ÿ®ÿßÿ≤€å⁄©ŸÜ ÿØ€å⁄Øÿ±€å ÿπŸàÿ∂ ⁄©ŸÜ€åÿØ Ÿà ÿ®Ÿá ÿ®ÿßÿ≤€å ÿ®ÿ±⁄Øÿ±ÿØ€åÿØ! ÿ¢ŸÜ‚ÄåŸáÿß ÿ®ÿ±ÿß€å ŸáŸÖ€åÿ¥Ÿá ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàŸÜÿØ (ÿ≠ÿ™€å ŸÜ€åŸÖ‚ÄåŸÖÿ±ÿØŸá ŸÜ€åÿ≥ÿ™ŸÜÿØ). ÿ™ŸÖÿßŸÖ ŸÜŸÇÿ¥ÿå ÿ™ŸàÿßŸÜÿß€å€å‚ÄåŸáÿß Ÿà ÿ™€åŸÖ ÿ¢ŸÜ‚ÄåŸáÿß ÿ±ÿß ŸÖ€å‚Äå⁄Ø€åÿ±€åÿØ. ŸÇÿßÿ®ŸÑ ÿßÿ≠ÿ∂ÿßÿ± ŸÜ€åÿ≥ÿ™.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>ü§ê ⁄©ÿßÿ±ÿ™ ÿ≥⁄©Ÿàÿ™ ÿ®ÿ±Ÿá‚ÄåŸáÿß</h4>
                        <p><strong>ÿßÿ´ÿ±:</strong> ÿ®ÿßÿ≤€å⁄©ŸÜÿßŸÜ ÿßŸÜÿ™ÿÆÿßÿ®€å ÿ±ÿß ÿ®ÿ±ÿß€å ⁄©ŸÑ ÿ±Ÿàÿ≤ ÿ®ÿπÿØ ÿ≥ÿß⁄©ÿ™ ⁄©ŸÜ€åÿØ. ŸÅŸÇÿ∑ ŸÖ€å‚Äåÿ™ŸàÿßŸÜŸÜÿØ ÿ±ÿß€å ÿ®ÿØŸáŸÜÿØÿå ÿ®ÿØŸàŸÜ ÿµÿ≠ÿ®ÿ™ €åÿß ÿ≠ÿ±⁄©ÿ™.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üéØ ⁄©ÿßÿ±ÿ™ ÿßŸÅÿ¥ÿß€å ŸáŸà€åÿ™</h4>
                        <p><strong>ÿßÿ´ÿ±:</strong> ÿ±ÿßŸà€å ŸÜŸÇÿ¥ ÿØŸÇ€åŸÇ ÿ®ÿßÿ≤€å⁄©ŸÜ ŸáÿØŸÅ ÿ±ÿß ŸÅÿßÿ¥ ŸÖ€å‚Äå⁄©ŸÜÿØ Ÿà ÿßÿ≤ ÿ®ÿßÿ≤€å ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ.</p>
                    </div>

                    <div class="role-help" style="border-right-color: #667eea;">
                        <h4>üß† ⁄©ÿßÿ±ÿ™ ÿ∞ŸáŸÜ ÿ≤€åÿ®ÿß</h4>
                        <p><strong>ÿßÿ´ÿ±:</strong> ÿ≥ÿπ€å ⁄©ŸÜ€åÿØ ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ ÿ±ÿß ÿ¥ŸÜÿßÿ≥ÿß€å€å ⁄©ŸÜ€åÿØ. ÿß⁄Øÿ± ÿØÿ±ÿ≥ÿ™ ÿ®ÿßÿ¥ÿØÿå ÿ≠ÿ∞ŸÅ ŸÖ€å‚Äåÿ¥ŸàÿØ Ÿà ÿ¥ŸÖÿß ÿ™ÿ®ÿØ€åŸÑ ÿ®Ÿá ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥ ÿ¨ÿØ€åÿØ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ!</p>
                    </div>

                    <h3>üí° ŸÜ⁄©ÿßÿ™ ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å⁄©</h3>
                    <ul>
                        <li><strong>ŸæÿØÿ±ÿÆŸàÿßŸÜÿØŸá:</strong> ÿßÿ≤ ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ ÿ®ÿß ÿØŸÇÿ™ ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ - ŸÇÿØÿ±ÿ™ŸÖŸÜÿØÿ™ÿ±€åŸÜ ÿßÿ®ÿ≤ÿßÿ± ÿ¥ŸÖÿßÿ≥ÿ™</li>
                        <li><strong>ŸÖÿßÿ™ÿßÿØŸàÿ±:</strong> ŸÜŸÇÿ¥‚ÄåŸáÿß€å ⁄©ŸÑ€åÿØ€å ŸÖÿ´ŸÑ ÿØ⁄©ÿ™ÿ± Ÿàÿßÿ™ÿ≥ŸàŸÜ €åÿß ŸÑÿ¶ŸàŸÜ ÿ±ÿß ŸÖÿ≥ÿØŸàÿØ ⁄©ŸÜ€åÿØ</li>
                        <li><strong>ŸÑÿ¶ŸàŸÜ:</strong> ŸÅŸÇÿ∑ €≤ ÿ¥ŸÑ€å⁄© ÿØÿßÿ±€åÿØ - ⁄©ÿßŸÖŸÑÿßŸã ŸÖÿ∑ŸÖÿ¶ŸÜ ÿ®ÿßÿ¥€åÿØ Ÿà⁄Øÿ±ŸÜŸá ÿÆŸàÿØÿ™ÿßŸÜ ŸÖ€å‚ÄåŸÖ€åÿ±€åÿØ!</li>
                        <li><strong>ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ:</strong> Ÿáÿ±⁄Øÿ≤ ŸÜ⁄ØŸà€å€åÿØ "ŸÖŸÜ ŸÅŸÇÿ∑ €å⁄© ÿ¥Ÿáÿ±ŸàŸÜÿØ ÿ≥ÿßÿØŸá‚ÄåÿßŸÖ" - ŸáÿØŸÅ ÿ≠ÿ≥ ÿ¥ÿ¥ŸÖ ŸÖ€å‚Äåÿ¥Ÿà€åÿØ</li>
                        <li><strong>ŸÜŸàÿ≥ÿ™ÿ±ÿßÿØÿßŸÖŸàÿ≥:</strong> ÿßŸÜÿ™ÿÆÿßÿ® ÿ™€åŸÖÿ™ÿßŸÜ ŸÖ€å‚Äåÿ™ŸàÿßŸÜÿØ ⁄©ŸÑ ÿ®ÿßÿ≤€å ÿ±ÿß ÿ™ÿπ€å€åŸÜ ⁄©ŸÜÿØ</li>
                        <li><strong>ŸáŸÖŸá:</strong> ⁄©ÿßÿ±ÿ™‚ÄåŸáÿß€å ÿ≠ÿ±⁄©ÿ™ ÿ¢ÿÆÿ± ŸÖ€å‚Äåÿ™ŸàÿßŸÜŸÜÿØ ŸáŸÖŸá ⁄Ü€åÿ≤ ÿ±ÿß ÿ™ÿ∫€å€åÿ± ÿØŸáŸÜÿØ - ÿßÿ≥ÿ™ÿ±ÿßÿ™⁄ò€å⁄© ÿßÿ≥ÿ™ŸÅÿßÿØŸá ⁄©ŸÜ€åÿØ!</li>
                    </ul>
                `;
            }
        }

        function startGame() {
            const playerCount = parseInt(document.getElementById('playerCount').value);
            const errorMsg = document.getElementById('errorMsg');
            
            if (!playerCount || playerCount < 6 || playerCount > 15) {
                errorMsg.textContent = currentLang === 'en' 
                    ? 'Please enter a number between 6 and 15' 
                    : 'ŸÑÿ∑ŸÅÿßŸã ÿπÿØÿØ€å ÿ®€åŸÜ €∂ ÿ™ÿß €±€µ Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                errorMsg.classList.remove('hidden');
                return;
            }
            
            errorMsg.classList.add('hidden');
            
            const teamSize = calculateTeamSize(playerCount);
            
            // Create role array based on calculated team sizes
            let roleArray = [];
            
            // Add Mafia roles
            for (let i = 0; i < teamSize.godfather; i++) roleArray.push('godfather');
            for (let i = 0; i < teamSize.matador; i++) roleArray.push('matador');
            for (let i = 0; i < teamSize.saul; i++) roleArray.push('saul');
            
            // Add Citizen roles
            for (let i = 0; i < teamSize.watson; i++) roleArray.push('watson');
            for (let i = 0; i < teamSize.leon; i++) roleArray.push('leon');
            for (let i = 0; i < teamSize.kane; i++) roleArray.push('kane');
            for (let i = 0; i < teamSize.constantine; i++) roleArray.push('constantine');
            for (let i = 0; i < teamSize.citizen; i++) roleArray.push('citizen');
            
            // Add Independent role
            for (let i = 0; i < teamSize.nostradamus; i++) roleArray.push('nostradamus');
            
            // Shuffle and assign
            playerRoles = shuffleArray(roleArray);
            currentPlayerIndex = 0;
            
            // Initialize card deck
            availableCards = [...cardDeck[currentLang]];
            drawnCard = null;
            
            document.getElementById('setupSection').classList.add('hidden');
            document.getElementById('gameSection').classList.remove('hidden');
            
            // Hide back-to-home button during game
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
            
            showPlayerReveal();
        }

        function showPlayerReveal() {
            const rolesContainer = document.getElementById('rolesContainer');
            const newGameBtn = document.getElementById('newGameBtn');
            const t = translations[currentLang];
            
            if (currentPlayerIndex >= playerRoles.length) {
                if (!gameCountIncremented) {
                    incrementGlobalCounter();
                    gameCountIncremented = true;
                }
                
                const cardsLeft = availableCards.length;
                const cardDisplay = drawnCard ? `
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);">
                        <h3 style="margin: 0 0 10px 0; color: white;">${t.cardDrawn}</h3>
                        <p style="font-size: 1.3em; font-weight: 700; margin: 10px 0; color: white;">${drawnCard.name}</p>
                        <p style="margin: 10px 0 0 0; opacity: 0.95; color: white;">${drawnCard.description}</p>
                    </div>
                ` : '';
                
                rolesContainer.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üéâ</div>
                        <h2 style="color: #333; margin-bottom: 15px;">${t.allAssigned}</h2>
                        <p style="color: #666; font-size: 1.1em; margin-bottom: 30px;">${t.gameBegin}</p>
                        
                        <div style="margin-top: 30px;">
                            ${cardDisplay}
                            <button class="btn btn-secondary" onclick="drawCard()" id="drawCardBtn" ${cardsLeft === 0 ? 'disabled' : ''} style="${cardsLeft === 0 ? 'opacity: 0.5; cursor: not-allowed;' : ''}">
                                ${cardsLeft > 0 ? t.drawCard + ` (${cardsLeft} ${t.cardsRemaining})` : t.noCardsLeft}
                            </button>
                        </div>
                    </div>
                `;
                newGameBtn.classList.remove('hidden');
                return;
            }
            
            newGameBtn.classList.add('hidden');
            
            rolesContainer.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <div id="instructionBox" style="background: #f8f9fa; border-radius: 15px; padding: 30px; margin-bottom: 20px;">
                        <div style="font-size: 2.5em; margin-bottom: 15px;">üë§</div>
                        <h2 style="color: #333; margin-bottom: 10px;">${t.playerLabel} ${currentPlayerIndex + 1}</h2>
                        <p style="color: #666;">${currentLang === 'en' ? 'Click the button below to see your role' : 'ÿ±Ÿà€å ÿØ⁄©ŸÖŸá ÿ≤€åÿ± ⁄©ŸÑ€å⁄© ⁄©ŸÜ€åÿØ ÿ™ÿß ŸÜŸÇÿ¥ ÿÆŸàÿØ ÿ±ÿß ÿ®ÿ®€åŸÜ€åÿØ'}</p>
                    </div>
                    
                    <div id="roleRevealArea"></div>
                    
                    <button class="btn" id="showRoleBtn" onclick="revealRole()">${t.showRoleBtn}</button>
                </div>
            `;
        }

        function revealRole() {
            document.getElementById('instructionBox').style.display = 'none';
            document.getElementById('showRoleBtn').style.display = 'none';
            
            const roleKey = playerRoles[currentPlayerIndex];
            const role = roles[currentLang][roleKey];
            const t = translations[currentLang];
            
            let teamBadge = '';
            let teamColor = '';
            if (role.team === 'mafia') {
                teamBadge = currentLang === 'en' ? 'üòà Mafia Team' : 'üòà ÿ™€åŸÖ ŸÖÿßŸÅ€åÿß';
                teamColor = '#ee3d72';
            } else if (role.team === 'citizen') {
                teamBadge = currentLang === 'en' ? 'üòá Citizens Team' : 'üòá ÿ™€åŸÖ ÿ¥Ÿáÿ±ŸàŸÜÿØÿßŸÜ';
                teamColor = '#4facfe';
            } else if (role.team === 'independent') {
                teamBadge = currentLang === 'en' ? 'üéØ Independent' : 'üéØ ŸÖÿ≥ÿ™ŸÇŸÑ';
                teamColor = '#9b59b6';
            }
            
            const roleRevealArea = document.getElementById('roleRevealArea');
            roleRevealArea.innerHTML = `
                <div class="role-card ${role.class}" style="margin-bottom: 20px; cursor: default;">
                    <div style="text-align: ${currentLang === 'fa' ? 'right' : 'left'};">
                        <div style="display: inline-block; background: ${teamColor}; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 10px; font-weight: 600;">
                            ${teamBadge}
                        </div>
                        <div class="role-name" style="font-size: 1.8em; margin-bottom: 15px;">
                            ${role.name}
                        </div>
                        <div class="role-description" style="font-size: 1.05em; line-height: 1.8;">
                            ${role.description}
                        </div>
                    </div>
                </div>
                <button class="btn" onclick="nextPlayer()" style="margin-top: 20px;">${t.sawRoleBtn}</button>
            `;
        }

        function nextPlayer() {
            currentPlayerIndex++;
            showPlayerReveal();
        }

        function drawCard() {
            if (availableCards.length === 0) {
                return; // No cards left
            }
            
            // Draw a random card
            const randomIndex = Math.floor(Math.random() * availableCards.length);
            drawnCard = availableCards[randomIndex];
            
            // Remove the drawn card from available cards
            availableCards.splice(randomIndex, 1);
            
            // Refresh the display
            showPlayerReveal();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function resetGame() {
            currentPlayerIndex = 0;
            playerRoles = [];
            gameCountIncremented = false;
            availableCards = [];
            drawnCard = null;
            document.getElementById('setupSection').classList.remove('hidden');
            document.getElementById('gameSection').classList.add('hidden');
            document.getElementById('rolesContainer').innerHTML = '';
            document.getElementById('newGameBtn').classList.add('hidden');
            
            // Show back-to-home button when returning to setup
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
        }

        function cancelGame() {
            document.getElementById('confirmModal').classList.remove('hidden');
        }

        function confirmCancel() {
            closeConfirm();
            resetGame();
        }

        function closeConfirm() {
            document.getElementById('confirmModal').classList.add('hidden');
        }

        function showHelp() {
            document.getElementById('helpModal').classList.remove('hidden');
            // Hide back-to-home button when showing help
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.add('hidden');
            // Show back-to-home button when closing help
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
        }

        function showFeedback() {
            document.getElementById('feedbackModal').classList.remove('hidden');
            // Hide back-to-home button when showing feedback
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'none';
        }

        function closeFeedback() {
            document.getElementById('feedbackModal').classList.add('hidden');
            // Show back-to-home button when closing feedback
            const backHomeBtn = document.querySelector('.back-home-btn');
            if (backHomeBtn) backHomeBtn.style.display = 'inline-flex';
            setTimeout(() => {
                document.getElementById('feedbackForm').reset();
                document.getElementById('feedbackStatus').classList.add('hidden');
            }, 300);
        }

        function updateGlobalCounter() {
            if (!database) {
                const t = translations[currentLang];
                document.getElementById('gameCounter').textContent = t.gamesPlayed + ' ' + (currentLang === 'en' ? 'Setup Required' : 'ŸÜ€åÿßÿ≤ ÿ®Ÿá ÿ™ŸÜÿ∏€åŸÖ');
                return;
            }

            const counterRef = database.ref('godfatherGameCounter');
            counterRef.on('value', (snapshot) => {
                const count = snapshot.val() || 0;
                const t = translations[currentLang];
                document.getElementById('gameCounter').textContent = t.gamesPlayed + ' ' + count.toLocaleString(currentLang === 'fa' ? 'fa-IR' : 'en-US');
            });
        }

        function incrementGlobalCounter() {
            if (!database) return;

            const counterRef = database.ref('godfatherGameCounter');
            counterRef.transaction((currentValue) => {
                return (currentValue || 0) + 1;
            });
        }

        function submitFeedback(event) {
            event.preventDefault();
            
            const name = document.getElementById('feedbackName').value.trim();
            const email = document.getElementById('feedbackEmail').value.trim();
            const message = document.getElementById('feedbackMessage').value.trim();
            const submitBtn = document.getElementById('submitFeedbackBtn');
            const statusEl = document.getElementById('feedbackStatus');
            
            if (!message) {
                statusEl.textContent = currentLang === 'en' ? '‚ö†Ô∏è Please enter a message' : '‚ö†Ô∏è ŸÑÿ∑ŸÅÿßŸã Ÿæ€åÿßŸÖ€å Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ';
                statusEl.style.background = '#fff3cd';
                statusEl.style.color = '#856404';
                statusEl.classList.remove('hidden');
                return;
            }
            
            submitBtn.disabled = true;
            const sendingText = currentLang === 'en' ? 'üì§ Sending...' : 'üì§ ÿØÿ± ÿ≠ÿßŸÑ ÿßÿ±ÿ≥ÿßŸÑ...';
            submitBtn.querySelector('span').textContent = sendingText;
            
            if (database) {
                const counterRef = database.ref('godfatherFeedbackCounter');
                counterRef.transaction((currentValue) => {
                    return (currentValue || 0) + 1;
                }).then((result) => {
                    const feedbackNumber = result.snapshot.val();
                    
                    const feedbackRef = database.ref('godfatherFeedback');
                    return feedbackRef.push({
                        number: feedbackNumber,
                        name: name || 'Anonymous',
                        email: email || 'Not provided',
                        message: message,
                        language: currentLang,
                        timestamp: new Date().toISOString(),
                        date: new Date().toLocaleString()
                    }).then(() => feedbackNumber);
                })
                .then((feedbackNumber) => {
                    if (EMAILJS_PUBLIC_KEY !== 'YOUR_PUBLIC_KEY') {
                        emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                            feedback_number: feedbackNumber,
                            from_name: name || 'Anonymous',
                            from_email: email || 'Not provided',
                            message: message + '\n\nLanguage: ' + currentLang,
                            to_email: 'contact.ehm@gmail.com'
                        }).catch((error) => {
                            console.error('EmailJS error:', error);
                        });
                    }
                    
                    statusEl.textContent = currentLang === 'en' ? '‚úÖ Thank you! Your feedback has been sent successfully!' : '‚úÖ ŸÖÿ™ÿ¥⁄©ÿ±€åŸÖ! ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ ÿ¥ŸÖÿß ÿ®ÿß ŸÖŸàŸÅŸÇ€åÿ™ ÿßÿ±ÿ≥ÿßŸÑ ÿ¥ÿØ!';
                    statusEl.style.background = '#d4edda';
                    statusEl.style.color = '#155724';
                    statusEl.classList.remove('hidden');
                    
                    document.getElementById('feedbackForm').reset();
                    
                    setTimeout(() => {
                        closeFeedback();
                    }, 2000);
                })
                .catch((error) => {
                    console.error('Error submitting feedback:', error);
                    statusEl.textContent = currentLang === 'en' ? '‚ùå Error sending feedback. Please try again.' : '‚ùå ÿÆÿ∑ÿß ÿØÿ± ÿßÿ±ÿ≥ÿßŸÑ ÿ®ÿßÿ≤ÿÆŸàÿ±ÿØ. ŸÑÿ∑ŸÅÿßŸã ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.';
                    statusEl.style.background = '#f8d7da';
                    statusEl.style.color = '#721c24';
                    statusEl.classList.remove('hidden');
                })
                .finally(() => {
                    submitBtn.disabled = false;
                    submitBtn.querySelector('span').textContent = translations[currentLang].sendBtn;
                });
            } else {
                statusEl.textContent = currentLang === 'en' ? '‚ùå Firebase not configured.' : '‚ùå Firebase Ÿæ€å⁄©ÿ±ÿ®ŸÜÿØ€å ŸÜÿ¥ÿØŸá ÿßÿ≥ÿ™.';
                statusEl.style.background = '#f8d7da';
                statusEl.style.color = '#721c24';
                statusEl.classList.remove('hidden');
                submitBtn.disabled = false;
                submitBtn.querySelector('span').textContent = translations[currentLang].sendBtn;
            }
        }

        // Close modals when clicking outside
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('helpModal').addEventListener('click', function(e) {
                if (e.target === this) closeHelp();
            });
            
            document.getElementById('feedbackModal').addEventListener('click', function(e) {
                if (e.target === this) closeFeedback();
            });
            
            document.getElementById('confirmModal').addEventListener('click', function(e) {
                if (e.target === this) closeConfirm();
            });

            // Initialize
            updateLanguage();
            updateGlobalCounter();
        });
    </script>
</body>
</html>
